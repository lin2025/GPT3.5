<!--	:::Support Chinese-Simplified and English. Change Language in the web page: "Settings" > "Language"  -->
<!--	:::You can search for "Editable" in the code to find the most frequently modified code.   -->
<!--	:::Modifying the default language in the code (change to English): Please search for "Default language" in the code for quick location.   -->
<!--	:::How to add a new language in the code: Please search for "settingsLanguage" and "settingsLanguageOptions" in the code, and then modify them. (When searching, please skip the CSS style part first.)  -->

<!--	:::网页显示报错：打开网页/网站后，对话框和部分按钮显示为{{x.msg}}、{{x.msg}}、{{sentext}}... :::	 -->
<!--		1. 4月23日之前的版本不排除CDN挂掉导致无法加载Vue.js的可能，之后的版本备有国内外3条CDN线路（如果Vue加载失败会弹出提醒） -->
<!--		2. 未提示Vue.js加载失败，说明Vue已成功加载，这种情况还出现错误，说明是因为使用淘汰的浏览器/设备老旧/浏览器多年未更新，不支持当前版本的Vue，请换浏览器或更新浏览器版本。淘汰的浏览器：比如IE11(Internet Explorer 11)。设备老旧：如十年前旧款iPad因无法更新浏览器而导致无法支持新协议、新版Vue  -->
<!--	:::小白如何改代码？ :::	 -->
<!--		小白萌新在编辑代码时搜索“可修改”来查看可以修改的部分。-->
<!--	:::Mac复制网页源码后如何粘贴代码？:::	 -->
<!--		1.打开“文本编辑”App，菜单选“文件”>“新建”，然后菜单选“格式”>“制作纯文本”。  -->
<!--		2.粘贴全部HTML代码。 -->
<!--		3.菜单选“文件”>“存储”，文件名为“index.html”，下拉框“纯文本编码”选“Unicode(UTF-8)”，然后点击存储（保存）。 -->
<!--	:::Mac如何修改扩展名为html的文件？:::	 -->
<!--		1.打开“文本编辑”App，菜单选“文件”>“打开”，找到html文件，单击选中，先别打开。 -->
<!--		2.点击对话框底部的“显示选项”/“选项”，然后打勾选中“忽略多信息文本命令”，现在可以点击“打开”，即可编辑html文件。 -->
<!--	:::Mac电脑:::	 -->
<!--		使用[文本编辑APP]修改网页的，保存时有个[纯文本编码]下拉框，选[Unicode(UTF-8)] -->
<!--	:::Windows电脑:::	 -->
<!--		使用[记事本]来修改网页的，保存时在[编码]下拉框中选[UTF-8]。扩展名如果是.txt，需要改为.html  另外，编辑代码时，建议在菜单栏的“格式”里关闭掉“自动换行” -->
<!--	:::关于文件名:::	 -->
<!--		1.电脑上使用，文件名随意，但扩展名必须是.html  2.如需上传至虚拟主机、服务器、GitHub、Gitee，文件名改为英文，默认主页的文件名为：index.html  -->

<!--	:::欢迎来以下评论区留言交流:::	 -->
<!--		抖音：@林同学不姓林	B站：@林同学不姓林  https://space.bilibili.com/3493262545389917    小站 http://lin2025.gitee.io   -->
<!--		当前版本 v7.05 - 大更新，新增重要功能。 Major update, introducing significant new features.  最新更新 https://github.com/lin2025/gpt3.5/  国内线路：https://gitee.com/lin2025/gpt3.5/   -->


<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<!-- 可修改 Editable - 默认不屏蔽搜索引擎机器人，想屏蔽的请去除注释。 Default allow search engine robots. -->
<!-- <meta name="ROBOTS" content="noindex,nofllow"> -->
<!-- 可修改 Editable - 网页标题 -->
<title>LinGPT - GPT3.5</title>
<meta name="description" content="LinGPT - A GPT-3.5 Webpage with Just a Single HTML File." />
<!-- 网页在手机/平板上的显示比例  默认缩放80%（ initial-scale=0.8 ） -->
<meta name="viewport" content="width=device-width,initial-scale=0.8,minimum-scale=0.5,maximum-scale=2,user-scalable=no,viewport-fit=cover">
<link rel="shortcut icon" href="https://openai.com/favicon.ico">
<!-- 可修改 Editable - iPhone/iPad将网页添加到主屏幕后显示的Logo  默认为ChatGPT的Logo  *小白不需要改。需要传网页到Github/Gitee/静态网页托管平台/主机/服务器的同学，才需要设置。  简单点快速设置：任意格式的正方形图片。  推荐参考设置：png格式 180x180  -->
<link rel="apple-touch-icon" href="https://openai.com/favicon.ico">

<!-- Vue首选CDN(线路1) Vue是一款用于构建用户界面的JavaScript框架，网页常用技术  -->
<!-- 20230520 tips: 不要使用3.2.47的prod版本，会偶尔产生错误，影响使用。 Do not use the prod version of 3.2.47, as I have found it to occasionally produce errors with unknown causes. -->
<!-- 20230603 tips: 使用3.3.4的prod版本两周了，非常稳定，没有再报错，很棒的版本。  I've been using the prod version of 3.3.4 for two weeks now and it has been very stable, without any errors. It's a great version.  -->
<script src="https://unpkg.com/vue@3.3.4/dist/vue.global.prod.js"></script>
<!-- Vue备选CDN(线路2) 首选CDN失效后，自动加载备选CDN，确保vue的正确加载。 unescape()括号里的是一种编码，转义尖括号(<>)，非乱码。在线解码工具 https://tool.ip138.com/escape/   -->
<script> !window.Vue && document.write(unescape('%3Cscript src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"%3E%3C/script%3E') ) </script>



<!-- 以下为css样式 已压缩，可自行使用工具格式化展开  *压缩后位于末尾的属性会省略掉分号';' -->
<!-- CSS格式化工具1: https://tool.ip138.com/css/ -->
<!-- CSS格式化工具2: http://www.ab173.com/gongju/format/css.php  -->
<style> 

#loading-mask{background-color:#ededed;z-index:900999}
#loading-mask div{text-align:center;font-size:12px;color:#b4b4b4}
::-webkit-scrollbar{width:7px;height:7px}
::-webkit-scrollbar-thumb{background-color:#e1e1e1;border-radius:10px}
::-webkit-scrollbar-thumb:hover{background-color:#cdcdcd}
body::-webkit-scrollbar-thumb{background-color:#e1e1e1;border-radius:10px}
body::-webkit-scrollbar-thumb:hover{background-color:#cdcdcd}
body::-webkit-scrollbar-track{background-color:#ededed}
body::-webkit-scrollbar-track:hover{background-color:#ededed}
body::-webkit-scrollbar-corner{background-color:#ededed}
.dialog-wrapper .dialog-scroll::-webkit-scrollbar-thumb{background-color:#d2d2d2;border-radius:10px}
.dialog-wrapper .dialog-scroll::-webkit-scrollbar-thumb:hover{background-color:#c3c3c3}
.dialog-wrapper .dialog-scroll::-webkit-scrollbar-track{background-color:#ededed}
.dialog-wrapper .dialog-scroll::-webkit-scrollbar-track:hover{background-color:#ededed}
.dialog-wrapper .dialog-scroll::-webkit-scrollbar-corner{background-color:#ededed}
.notification-wrapper .dialog-scroll::-webkit-scrollbar-thumb{background-color:#e8eb95;border-radius:10px}
.notification-wrapper .dialog-scroll::-webkit-scrollbar-thumb:hover{background-color:#dadd8b}
.notification-wrapper .dialog-scroll::-webkit-scrollbar-track{background-color:#fdffb4}
.notification-wrapper .dialog-scroll::-webkit-scrollbar-track:hover{background-color:#fdffb4}
.notification-wrapper .dialog-scroll::-webkit-scrollbar-corner{background-color:#fdffb4}
body{margin-bottom:0px;margin-top:8px;overflow-y:scroll;background-color:#ededed;font-family:Helvetica Neue,Helvetica,Hiragino Sans GB,"SF Pro SC",Microsoft YaHei,"PingFang SC",Arial,sans-serif}
.bottom-position{height:95px}
.newcontext-hr{height:1px;background-color:#cfcfcf;border:none;width:92%;margin-top:16px;margin-bottom:20px}
.wechatstyle-datetime{display:block;font-size:13px;text-align:center;color:#bbbbbb;margin-top:20px;margin-bottom:17px}
.msgdatetimediv{position:relative}
.usermsg-datetime{font-size:12px;color:#bbbbbb;bottom:auto;left:auto;right:54px;top:-14px;position:absolute}
.aimsg-datetime{font-size:12px;color:#bbbbbb;bottom:auto;left:57px;right:auto;top:-14px;position:absolute}
.userinfo{display:flex;flex-direction:row-reverse;align-items:flex-start;padding-right:2px;margin-top:17px;animation:oneshow 0.8s ease 1}
.usermsg{color:#191919;display:flex;flex-direction:column;justify-content:center;padding:9px 13px;border-radius:6px;overflow-x:auto;overflow-y:hidden;scrollbar-width:thin;margin-right:11px;background-color:#95eb6c}
.aiinfo{display:flex;flex-direction:row;align-items:flex-start;margin-left:7px;margin-top:17px;animation:oneshow 0.8s ease 1}
.aimsg{color:#191919;display:flex;flex-direction:column;justify-content:center;padding:9px 13px;border-radius:6px;overflow-x:auto;overflow-y:hidden;scrollbar-width:thin;margin-left:11px;background-color:#ffffff}
.aiinfo .msgdiv::before{content:"";display:block;position:absolute;border:12px solid transparent;border-right-color:rgba(255,255,255,1);left:-7px;top:8px}
.userinfo .msgdiv::before{content:"";display:block;position:absolute;border:12px solid transparent;border-left-color:#95eb6c;right:-7px;top:8px}
.msgcopydiv{width:auto;max-width:76%}
.chat-img{border-radius:6px;height:2.3rem;width:2.3rem;color:rgba(255,255,255);background-color:#f5f5f5;display:flex;flex-direction:row;justify-content:center;align-items:center}
.chat-img img{height:100%;width:100%;object-fit:cover;border-radius:6px}
.chat-green-svg{background: linear-gradient(to bottom, #17c882, #14b482);}
.chat-img-border{box-shadow:0 0 2px 1px rgba(56,82,56,0.3);-webkit-box-shadow:0 0 2px 1px rgba(56,82,56,0.3);-moz-box-shadow:0 0 2px 1px rgba(56,82,56,0.3)}
.chat-img-bg{background-image:radial-gradient(#fff,rgb(245,245,245) 40%,#e6e6e6);background-image:-webkit-radial-gradient(#fff,rgb(245,245,245) 40%,#e6e6e6);background-image:-moz-radial-gradient(#fff,rgb(245,245,245) 40%,#e6e6e6)}
.update-img-size{margin-right:4px !important;height:33px;width:33px}
.flex-column-center{display:flex;flex-direction:column;justify-content:center;align-items:flex-start;position:fixed;bottom:0px;width:100%;left:0px;background-color:#f6f6f6;border-top:0.8px solid #dddddd}
.justify-end{display:flex;flex-direction:row;justify-content:flex-start;align-items:right;bottom:0px}
.panelrow{display:flex;flex-direction:row;justify-content:space-between;align-items:flex-end;width:100%;height:30px}
.dh-input{font-size:14px;color:#191919;width:100%;height:25px;border-radius:6px;padding-left:10px;padding-right:10px;margin-left:10px;margin-right:4px;border:1px solid #DDD;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;scrollbar-width: thin;}
.dh-input:disabled{border:1px solid #DDD;color:#cccccc !important}
.dh-input:read-only{border:1px solid #DDD;color:#cccccc !important}
.textareaSPReadOnly:read-only{color:#555555 !important;background-color:#ededed !important;overflow:scroll}
input[type=text],input[type=password],textarea{outline:none}
input[type=text]:focus,input[type=password]:focus,textarea:focus{border:1px solid #17a316 !important;box-shadow:inset 0 1px 2px rgba(0,0,0,.075),0 0 5px rgba(81,167,232,.5)}
input:focus{z-index:2}
.dropdown{-webkit-appearance:none;-moz-appearance:none;appearance:none;flex-shrink:0;width:auto;height:25px;align-items:center;justify-content:center;margin:0;padding:0 10px;border-radius:6px;border:none;font-weight:400;font-size:12px;overflow:hidden;outline:none;cursor:pointer;color:#FFF;background:#1aad19;background: linear-gradient(to bottom, #1ac83c, #1aa819);-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}
.btn{display:flex;flex-shrink:0;width:auto;height:25px;align-items:center;justify-content:center;padding:0 10px;margin-right:7px;background-color:#1aad19;border-color:#1aad19;background: linear-gradient(to bottom, #1ac83c, #1aa819);color:#FFF;border-radius:6px;border:none;outline:none;font-weight:400;font-size:12px;text-decoration:none;text-align:center;line-height:25px;cursor:pointer;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-transition-property:all;transition-property:all;-webkit-transition-duration:.3s;transition-duration:.3s}
.btn *,.copybtn *{align-items:center;justify-content:center;display:flex}
.btn:visited,.dropdown:visited{color:#FFF}
.btn:hover,.btn:focus,.dropdown:hover{background-color:#25c524;border-color:#25c524;background: linear-gradient(to bottom, #24dc46, #24b423);color:#FFF}
.dropdown:active, .dropdown:focus{background:#0fb9af;background-color:#0fb9af;border-color:#0fb9af;color:#f5feff}
.dropdown option:disabled {color: #0c8b6e;}
.btn:active{background-color:#17a316;border-color:#17a316;background: linear-gradient(to bottom, #17be39, #179616);color:#f9fff5;}
.btn:disabled,.dropdown:disabled,.bluebtn:disabled{border:1px solid #DDD !important;background-color:#F5F5F5 !important;background: linear-gradient(to bottom, #fcfcfc, #f0f0f0) !important;color:#1aad19 !important}
.minibtn{width:14px;height:14px;line-height:12px;padding:1px;font-size:12px;flex-shrink:0;display:inline-block;vertical-align:middle;border-radius:50%;margin-bottom:1px !important;transform:scale(0.85);-ms-transform:scale(0.85);-webkit-transform:scale(0.85);-moz-transform:scale(0.85);-o-transform:scale(0.85)}
.minibtn-default{width:auto;height:16px;padding:2px 7px;border-radius:4px}
.bluebtn,.bluedropdown{background-color:#1ca5c2;border-color:#1ca5c2;background: linear-gradient(to bottom, #1cbec8, #1c9bc3);}
.bluebtn:hover,.bluebtn:focus{background-color:#22b9d9;border-color:#22b9d9;background: linear-gradient(to bottom, #26d2d2, #26afcd);color:#FFF}
.bluebtn:active{background-color:#1ca5c2;border-color:#1ca5c2;background: linear-gradient(to bottom, #19b4c5, #1991c0);color:#effcff}
.bluedropdown:hover,.bluedropdown:focus{background-color:#22b9d9;border-color:#22b9d9;background:#22b9d9;color:#FFF}
.redbtn{background-color:#dd3838;border-color:#dd3838;background: linear-gradient(to bottom, #f34d2d, #eb0505);box-shadow:0 0 3px 0 rgba(221,56,56,0.55)}
.redbtn:hover,.redbtn:focus{background-color:#ff4040;border-color:#ff4040;background: linear-gradient(to bottom, #fd5f4b, #eb1919);color:#FFF}
.redbtn:active{background-color:#c73737;border-color:#c73737;background: linear-gradient(to bottom, #ea4607, #ea0002);color:#fff5f0}
.orangeredbtn,.orangereddropdown{background-color:#f44400;border-color:#f44400;background: linear-gradient(to bottom, #ff7800, #f74900);box-shadow:0 0 2px 0 rgba(241,64,14,0.55)}
.orangeredbtn:hover,.orangeredbtn:focus{background-color:#ff4f00;border-color:#ff4f00;background: linear-gradient(to bottom, #ff8c0a, #fe580a);color:#FFF}
.orangeredbtn:active{background-color:#da3600;border-color:#da3600;background: linear-gradient(to bottom, #fc6e00, #f13a00);color:#fff9f6}
.orangereddropdown:hover,.orangereddropdown:focus{background-color:#ff4f00;border-color:#ff4f00;background:#ff4f00;color:#FFF}
.btnzoom-a{transition:all 0.5s;cursor:pointer}
.btnzoom-a:hover{transform: scale(1.18)}
.btnzoom-b{transition:all 0.2s}
.btnzoom-b:hover{transform: scale(1)}
.btnzoom-c{transition:all 0.2s}
.btnzoom-c:hover{transform: scale(1.1)}
.btnzoom-d{transition:all 0.2s}
.btnzoom-d:hover{transform: scale(0.95)}
.usermsg *,.aimsg *{margin:0;word-wrap:break-word}
/* white-space:normal去除上下空行（高度）（ blockquote 单独写）+ 列表后排除换行的可能  */
.usermsg ul,.usermsg ol,.aimsg ul,.aimsg ol{white-space:normal;margin:5px 0;padding-left:28px}
.usermsg p,.usermsg span,.aimsg p,.aimsg span{line-height:1.6;margin-top:3px}
/* li: break-all 截断 */
.usermsg li,.aimsg li{word-break:break-all}
/* code 字体 */
.usermsg code,.aimsg code{font-size:12px;font-family:Consolas,Monaco,monospace}
/* 行内代码 除了pre>code之外的代码块 */
.aimsg code:not(pre code){color:#27282c;white-space:pre-wrap;word-break:break-word;margin:0;border-radius:6px;padding:1px 5px;background-color:#efefef}
.usermsg code:not(pre code){color:#27282c;white-space:pre-wrap;word-break:break-word;margin:0;border-radius:6px;padding:1px 5px;background-color:#a9f289}
/* 表格 table code */
.usermsg table code:not(pre code),.aimsg table code:not(pre code){color:#27282c;white-space:pre-wrap;word-break:break-word;margin:0;border-radius:6px;padding:1px 5px;background-color:#e3e3d4}
/* 代码块 */
/* tokyo-night-dark color:#9aa5ce ; */
/* tokyo-night-dark background: #1a1b26; */
/* panda-syntax-dark color:#e6e6e6 ; */
/* panda-syntax-dark background: #2a2c2d; */
.usermsg pre,.aimsg pre{margin:5px 0;width:100%;min-width:100px;white-space:pre;border-radius:6px;box-sizing:border-box;color:#e6e6e6;background:#2a2c2d}
.usermsg pre > code,.aimsg pre > code{display:block;padding:1em;-moz-tab-size:4;tab-size:4;overflow-x:auto;white-space:pre;word-break:normal;scrollbar-width:thin}
.usermsg img:not(.clippy),.aimsg img:not(.clippy){margin:5px 0;max-width:100%}
.usermsg table img,.aimsg table img{max-width:300px}
/* white-space:normal 去除上下空行（高度）*/
.usermsg blockquote{white-space:normal;margin:8px 14px;max-width:100%;color:#373737;border-left:1px solid #6eac4e;padding:0 0 0 8px}
.aimsg blockquote{white-space:normal;margin:8px 14px;max-width:100%;color:#57606a;border-left:1px solid #c8c8c8;padding:0 0 0 8px}
.usermsg blockquote *,.aimsg blockquote *{margin-top:0px;margin-bottom:0px}
.usermsg h1,.usermsg h2,.usermsg h3,.usermsg h4,.usermsg h5,.usermsg h6,.usermsg ul,.usermsg ol,.usermsg blockquote,.usermsg ul p,.usermsg ol p,.usermsg blockquote p,.aimsg h1,.aimsg h2,.aimsg h3,.aimsg h4,.aimsg h5,.aimsg h6,.aimsg ul,.aimsg ol,.aimsg blockquote,.aimsg ul p,.aimsg ol p,.aimsg blockquote p{line-height:1.5}
.usermsg h1,.usermsg h2,.usermsg h3,.usermsg h4,.usermsg h5,.usermsg h6,.aimsg h1,.aimsg h2,.aimsg h3,.aimsg h4,.aimsg h5,.aimsg h6{margin-top:5px}
.usermsg h1,.aimsg h1{font-size:1.4em;margin:0 0 0.5em 0;padding:1em 0 0.5em;border-bottom:1px solid #7dc35a}
.usermsg h2,.aimsg h2{font-size:1.25em;margin:0.5em 0;padding:0.2em 0 0.3em;border-bottom:1px solid #7dc35a}
.aimsg h1{border-bottom:1px solid #b4b4b4}
.aimsg h2{border-bottom:1px solid #b4b4b4}
.usermsg h3,.aimsg h3{font-size:1.125em}
.usermsg h4,.aimsg h4{font-size:1em}
.usermsg h5,.aimsg h5{font-size:.875em}
.usermsg h6{font-size:.85em;color:#373737}
.aimsg h6{font-size:.85em;color:#57606a}
.usermsg hr{height:1px;border:none;background-color:#7dc35a;margin:0.6em 0 0.7em 0}
.aimsg hr{height:1px;border:none;background-color:#b4b4b4;margin:0.6em 0 0.7em 0}
.usermsg table,.aimsg table{margin:5px 0;border-spacing:0;border-collapse:collapse;display:table;max-width:100%;overflow:auto;color:rgb(40,40,40);word-break:break-all}
.usermsg td,.usermsg th,.aimsg td,.aimsg th{padding:0}
.usermsg table th,.aimsg table th{font-weight:600}
.usermsg table th,.usermsg table td,.aimsg table th,.aimsg table td{padding:5px 8px;border:1px solid #e4e6d0}
.usermsg table tr,.aimsg table tr{background-color:#f6f9f1;border-top:1px solid}
.usermsg table tr:nth-child(2n),.aimsg table tr:nth-child(2n){background-color:#edf1e5}
.usermsg table img,.aimsg table img{background-color:transparent}
/* 以下 一键复制相关 pre=snippet, button=copybtn ,svg/img(svg)=clippy */
.clippy{margin:4px;position:relative}
.copybtn[disabled] .clippy{opacity:.3}
.snippet,.msgcopydiv{position:relative;overflow:visible}
.snippet .copybtn,.msgcopydiv .copybtn,.msgcopydiv .copybtn,.panelrow .copybtn,.notification-content .copybtn{-webkit-transition:opacity .3s ease-in-out;-o-transition:opacity .3s ease-in-out;transition:opacity .3s ease-in-out;opacity:0;padding:0;position:absolute;right:4px;top:4px;display:inline-block;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-appearance:none}
.snippet:hover > .copybtn,.snippet > .copybtn:focus,.msgcopydiv:hover > .copybtn,.msgcopydiv > .copybtn:focus{opacity:1}
@media screen and (max-width:768px){
.snippet > .copybtn{opacity:0.4}
.msgcopydiv > .copybtn{}
}
.userinfo > .msgcopydiv{margin-left:30px}
.aiinfo > .msgcopydiv{margin-right:30px}
.userinfo > .msgcopydiv > .copybtn{top:auto;bottom:4px;left:-30px;right:auto}
.aiinfo > .msgcopydiv > .copybtn{top:auto;bottom:4px;left:auto;right:-30px}
/* 以下copybtn (btn) by https://primer.style/css/components/tooltips https://clipboardjs.com/bower_components/primer-css/css/primer.css */
.copybtn:focus{text-decoration:none;border-color:#51a7e8;outline:none;box-shadow:0 0 5px rgba(81,167,232,.5)}
.copybtn:focus:hover,.copybtn.selected:focus{border-color:#51a7e8}
.copybtn:hover,.copybtn:active{text-decoration:none;background-color:#ddd;background-image:linear-gradient(#eee,#ddd);border-color:#ccc}
.copybtn:active,.copybtn.selected{background-color:#dcdcdc;background-image:none;border-color:#b5b5b5;box-shadow:inset 0 2px 4px rgba(0,0,0,.15)}
.copybtn.selected:hover{background-color:#cfcfcf}
.copybtn:disabled,.copybtn:disabled:hover,.copybtn.disabled,.copybtn.disabled:hover{color:rgba(102,102,102,.5);cursor:default;background-color:rgba(229,229,229,.5);background-image:none;border-color:rgba(197,197,197,.5);box-shadow:none}
/* 以上 copybtn (btn)  */
.snippet .tooltipped-w:after{background:#6e7681}
.snippet .tooltipped-w:before{border-left-color:#6e7681}
/* 以下 Tooltips by https://primer.style/css/components/tooltips https://clipboardjs.com/bower_components/primer-css/css/primer.css */
.tooltipped{position:relative}
.tooltipped:after{position:absolute;z-index:1000000;display:none;padding:5px 8px;font:normal normal 11px/1.5 Helvetica,arial,nimbussansl,liberationsans,freesans,clean,sans-serif,"Segoe UI Emoji","Segoe UI Symbol";color:#fff;text-align:center;text-decoration:none;text-shadow:none;text-transform:none;letter-spacing:normal;word-wrap:break-word;white-space:pre;pointer-events:none;content:attr(aria-label);background:rgba(0,0,0,.8);border-radius:3px;-webkit-font-smoothing:subpixel-antialiased}
.tooltipped:before{position:absolute;z-index:1000001;display:none;width:0;height:0;color:rgba(0,0,0,.8);pointer-events:none;content:"";border:5px solid transparent}
.tooltipped:hover:before,.tooltipped:hover:after,.tooltipped:active:before,.tooltipped:active:after,.tooltipped:focus:before,.tooltipped:focus:after{display:inline-block;text-decoration:none}
.tooltipped-n:after,.tooltipped-ne:after,.tooltipped-nw:after{right:50%;bottom:100%;margin-bottom:5px}
.tooltipped-n:before,.tooltipped-ne:before,.tooltipped-nw:before{top:-5px;right:50%;bottom:auto;margin-right:-5px;border-top-color:rgba(0,0,0,.8)}
.tooltipped-ne:after{right:auto;left:50%;margin-left:-15px}
.tooltipped-nw:after{margin-right:-15px}
.tooltipped-n:after{-webkit-transform:translateX(50%);-ms-transform:translateX(50%);transform:translateX(50%)}
.tooltipped-w:after{right:100%;bottom:50%;margin-right:5px;-webkit-transform:translateY(50%);-ms-transform:translateY(50%);transform:translateY(50%)}
.tooltipped-w:before{top:50%;bottom:50%;left:-5px;margin-top:-5px;border-left-color:rgba(0,0,0,.8)}
.tooltipped-e:after{bottom:50%;left:100%;margin-left:5px;-webkit-transform:translateY(50%);-ms-transform:translateY(50%);transform:translateY(50%)}
.tooltipped-e:before{top:50%;right:-5px;bottom:50%;margin-top:-5px;border-right-color:rgba(0,0,0,.8)}
/* 以上 Tooltips */
/* 以上 一键复制相关 */
#app{display:flex;flex-flow:column;margin:1;white-space:pre-wrap}
/* 以下 弹窗 */
.dialog-wrapper{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:900100}
.dialog-wrapper-hide{display:none}
/* .dialog{width:95%;max-width:800px;height:auto;max-height:82%;overflow:scroll;border-radius:10px;z-index:900101;position:fixed;top:calc(50% - 14.5px);left:calc(50% - 0.5px);transform: translate(calc(-50% + 0.5px), calc(-50% + 0.5px));background-color:#ededed;box-shadow:0px 0px 10px rgba(0,0,0,0.3)} */
.dialog{width:95%;max-width:800px;height:78%;max-height:1000px;overflow:hidden;border-radius:10px;z-index:900101;position:fixed;background-color:#ededed;box-shadow:0px 0px 10px rgba(0,0,0,0.3)}
.dialog-header{position:relative;height:40px;line-height:40px;padding:0 20px;background-color:#f5f5f5;border-top-left-radius:10px;border-top-right-radius:10px}
.dialog-bottom{position:relative;height:15px;line-height:15px;border-bottom-left-radius:10px;border-bottom-right-radius:10px}
.dialog-close{line-height:20px;color:#333333;position:absolute;top:10px;right:10px;width:20px;height:20px;cursor:pointer}
.dialog-title{font-size:14px;line-height:20px;color:#333333;position:absolute;top:10px;align-items:center;justify-content:center;display:flex}
.dialog-scroll{position: relative; width: 100%; height: calc(100% - 54.5px); overflow: auto;scrollbar-width:thin;}
.dialog-content{padding:20px;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center}
.dialog-content .btn,.dialog-content .dh-input{margin:0 2px}
.dialog-content .panelrow{height:26px;margin-bottom:4px}
.dialog-content .panelrow >:last-child{margin-right:2px}
.dialog-content .panelgroup{width:100%;box-shadow: 1px 2px 9px 2.5px rgba(201, 201, 201, 0.6);padding:5px 6px 4px 8px;border-radius:6px;margin-bottom:12px}
.dialog-content .panelgroup-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;padding-bottom:1px;border-bottom:1px solid rgb(220,220,220,0.5)}
.dialog-content .panelgroup-head > span{color:#666666;font-size:12px}
.dialog-content .panelgroup-shadow{box-shadow: 1px 1.5px 7.5px 2.5px rgba(201, 201, 201, 0.66);}
.dialog-content span{font-size:12px;color:#333333;margin-left:4px;line-height:18px}
.dialog-mask{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);z-index:-1}
.panelgroup-chatdata-selected{box-shadow: 0 0 0.5px 1px rgba(26, 168, 50, 0.8 ) !important;background: linear-gradient(rgba(26, 168, 50, 0.015), rgba(26, 168, 50, 0.15));}
.control-container{width:auto;margin-right:6px}
.control-bg{padding:2px 5px;width:auto;height:auto;background:#fcfcfc;border-radius:5px;display:flex}
.slider{-webkit-appearance:none !important;-moz-appearance:none;appearance:none;width:100%;height:2px;margin:9px 4px;padding:0px 2px;background: linear-gradient(to bottom, #17d51e, #179e16);border:none;border-radius:2px;outline:none;-webkit-transition:.2s;transition:opacity .2s}
.slider::-webkit-slider-thumb{-webkit-appearance:none !important;appearance:none;width:12px;height:17px;border:none;background: linear-gradient(to bottom, #17d51e, #179e16);border-radius:4px;cursor:pointer}
.slider::-moz-range-thumb{-webkit-appearance:none !important;-moz-appearance:none !important;appearance:none;width:12px;height:17px;border:none;background: linear-gradient(to bottom, #17d51e, #179e16);border-radius:4px;cursor:pointer}
.slider::-ms-thumb{-webkit-appearance:none !important;appearance:none;width:12px;height:17px;border:none;background: linear-gradient(to bottom, #17d51e, #179e16);border-radius:4px;cursor:pointer}
.slider::-webkit-slider-thumb:hover,.slider::-webkit-slider-thumb:focus{background: linear-gradient(to bottom, #1ac83c, #179b16);outline:none}
.slider::-moz-range-thumb:hover,.slider::-moz-range-thumb:focus{background: linear-gradient(to bottom, #1ac83c, #179b16);outline:none}
.slider::-ms-thumb:hover,.slider::-ms-thumb:focus{background: linear-gradient(to bottom, #1ac83c, #179b16);outline:none}
.slider::-webkit-slider-thumb:active{background: linear-gradient(to bottom, #1ac83c, #179b16);}
.slider::-moz-range-thumb:active{background: linear-gradient(to bottom, #1ac83c, #179b16);}
.slider::-ms-thumb:active{background: linear-gradient(to bottom, #1ac83c, #179b16);}
@media only screen and (max-width:768px){.slider::-webkit-slider-thumb{width:25px;height:18px}
.slider::-moz-range-thumb{width:25px;height:18px}
.slider::-ms-thumb{width:25px;height:18px}
}
.slider:disabled::-webkit-slider-thumb{background: linear-gradient(to bottom, #d7ebd7, #c3d6c2);cursor:not-allowed}
.slider:disabled::-moz-range-thumb{background: linear-gradient(to bottom, #d7ebd7, #c3d6c2);cursor:not-allowed}
.slider:disabled::-ms-thumb{background: linear-gradient(to bottom, #d7ebd7, #c3d6c2);cursor:not-allowed}
.slider:disabled{background: linear-gradient(to bottom, #d7ebd7, #c3d6c2);cursor:not-allowed}
#dialog-settings .dh-input,#dialog-promptgenerator .dh-input{font-size:12px;color:#333333;background-color:#fcfcfc}
#dialog-promptgenerator .dh-input{font-size:13px}
#loading-mask button{margin:30px;display:inline-block;padding:8px 16px;font-size:14px;text-align:center;color:#333;background-color:#fdffb4;border:3px solid #555;border-radius:10px;cursor:pointer}
/* 以上 弹窗 */
/* 以下 消息通知 tooltips */
.notification{position:relative;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:900900}
.notification-wrapper{max-width:600px;overflow:hidden;position:fixed;transform:translate(calc(-50% + 0.5px), calc(-50% + 0.5px));background-color:#fdffb4;box-shadow:0 0 8px rgba(191,169,16,0.3);border:1px solid rgba(166,152,27,0.45);z-index:900902}
.notification-content{color:#664909;font-size:13px;line-height:1.6}
.notification-content-center{display:block;text-align:start;padding-left:6px;margin:5px 10px 0px 10px;word-break:break-word}
.notification-content-bottom{display:flex;text-align:center;padding-left:0;margin:5px 11px 5px 11px;word-break:break-word}
.notification-center{width:82%;min-width:160px;bottom:auto;left:50%;top:50%;right:auto;border-radius:10px}
.notification-bottom{width:auto;min-width:45px;bottom:calc(0% + 4.5px);left:50%;top:auto;right:auto;border-radius:6px;animation:slideIn 0.4s ease-out forwards}
.notification-mask{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.65);z-index:900901}
@keyframes slideIn{from{transform:translate(-50%,-3px);opacity:0}
to{transform:translate(-50%,-18px);opacity:1}
}
/* 以上 消息通知 tooltips */
</style>
<!-- 以上为css样式  -->
</head>


<body>
<!-- #app -->  
<div id="app">

	<!-- 加载网页时的遮罩 Page Loading - Mask -->  
	<div id="loading-mask" class="dialog-wrapper" style="z-index: 999999;">
		<div>加载中<br>Loading</div>
	</div>
	
	<!-- 主界面-聊天对话 Main interface - Chat  -->  
	<div style="width:100%;">
		<div>
			<div v-for="(x,i) in msgList" :key="i">
				<!-- Me / User WechatStyleDatetime -->
				<span v-if="x.my" class="wechatstyle-datetime" :style="{ display: (settingsTime_WechatStyle && x.wechatstyledatetime != null) ? 'block' : 'none', marginBottom: settingsTime_Message == 3 ? '27px' : '17px', fontSize: settingsFontSize * 0.9 + 'px' }">{{x.wechatstyledatetime}}</span>
				
				<!-- Me / User Message Datetime -->
				<div v-if="x.my" :data-hr="x.hr" class="msgdatetimediv" :style="{ display: settingsTime_Message == 1 ? 'none' : 'block' }" ><span class="usermsg-datetime">{{x.datetime}}</span></div>
				
				<!-- AI Message Datetime -->
				<div v-if="!x.my" :data-hr="x.hr" class="msgdatetimediv" :style="{ display: settingsTime_Message == 1 ? 'none' : 'block' }" ><span class="aimsg-datetime">{{x.datetime}}</span></div>
				
				<!-- Me / User Message -->
				<div v-if="x.my" class="userinfo" :style="{ marginTop : settingsTime_Message == 3 ? '27px' : '17px' }" >
					<div class="chat-img btnzoom-a" @click="isShowDialog_ChatList = true">
						<img :src="userAvatarURL">
					</div>	
					<div class="justify-end msgcopydiv msgdiv">
						<div v-html="x.msg" class="usermsg" :style="{ fontSize: settingsFontSize + 'px' }">
						</div>
					</div>
				</div>
				
				<!-- AI Message -->
				<div v-if="!x.my" class="aiinfo" :style="{ marginTop : settingsTime_Message == 3 ? '27px' : '17px' }" >
					<div class="chat-img btnzoom-a" :style="{ display: isgptGreenSvgShow ? 'none' : 'flex' }" @click="isShowDialog_ChatList = true">
						<img :src="gptAvatarURL">
					</div>
					<div class="chat-img chat-green-svg btnzoom-a" :style="{ display: isgptGreenSvgShow ? 'flex' : 'none'}" @click="isShowDialog_ChatList = true">
						<svg width="27" height="27" viewBox="0 0 41 41" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="1.5"  role="img">
							<path d="M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z" fill="currentColor">
							</path>
						</svg>
					</div>
					<div class="msgcopydiv msgdiv">
						<div  v-html="x.msg" class="aimsg" :style="{ fontSize: settingsFontSize + 'px' }">
						</div>
					</div>
				</div>
			</div>
			
			<!-- 空白块 布局/定位用 For position -->
			<div class="bottom-position"></div>
		</div>
	</div>
	<!-- End: 主界面-聊天对话 Main interface - Chat -->


	<!-- 主界面-底部  Main interface - Bottom  -->
	<div  class="flex-column-center">
		<!-- First row -->
		<div class="panelrow" style="margin-top: 6px;height: 40px;">
			<button @click="isShowDialog_PromptGenerator = true" class="btn" :class="{ 'orangeredbtn': !(gptSystemPromptReadOnly.trim() == '') }" :disabled="(gptSystemPrompt_hidden.trim() != '')" :title="gptSystemPrompt_hidden.trim() == '' ? '' : (settingsLanguage == 'cn' ? '功能已被禁用' : 'The feature has been disabled') " style="margin-left:12px;margin-right:-1px;border-radius: 6px 0px 0px 6px;line-height: 38px; width: 27px;height: 38px;padding: 0 8px;z-index: 900001;">
				<div>
					<svg xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
						<path clip-rule="evenodd" d="M14.526 6.10576C15.0265 6.33917 15.2667 6.88343 15.0625 7.3214L9.88541 18.4237C9.68118 18.8616 9.10985 19.0275 8.60931 18.7941C8.10877 18.5607 7.86857 18.0164 8.0728 17.5784L13.2499 6.47616C13.4541 6.03819 14.0254 5.87235 14.526 6.10576Z" fill="currentColor" fill-rule="evenodd" /></svg>
					</svg>
				</div>
			</button>
			<textarea @click="scrollToBottomViewClick"  @blur="textareaChatInputBox_blur" @focus="textareaChatInputBox_focus"  @keydown.enter.exact="textareaEnter"  @keydown.ctrl.enter.exact="newLine" @keydown.meta.enter.exact="newLine"  v-model="msg"  type="text"  class="dh-input textareachatinputbox" style="margin-left:0px;height: 38px;min-height: 38px;max-height: 38px;border-radius: 0px 6px 6px 0px; z-index:900000" placeholder="" enterkeyhint="send" ></textarea>
			<button @click="sendMsg();" :disabled="btnDisabledState_Sending" class="btn" style="line-height: 38px; height: 38px;font-size: 14px;padding: 0 15px;" >{{sentext}}</button> 
		</div>
	
		<!-- Second row - Left -->
		<div class="panelrow" style="margin-bottom: 7px;">
		  	<button  @click="clearContext" :disabled="btnDisabledState_Clear"  class="btn" style="margin-left:12px;margin-right: 4px;">
				<div>
					<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
						<polyline points="3 6 5 6 21 6"></polyline>
						<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
						<line x1="10" y1="11" x2="10" y2="17"></line>
						<line x1="14" y1="11" x2="14" y2="17"></line>
					</svg>	
				</div>
				<span v-if="settingsLanguage == 'cn' " :style="{ display: isShowQACountLabel ? 'flex' : 'none' }" >&nbsp;记忆</span>
				<span v-else :style="{ display: isShowQACountLabel ? 'flex' : 'none' }" >&nbsp;Context</span>
				<span>:&nbsp;{{succQA_Count}}</span>
			</button>
			<button  disabled class="btn" style="margin-right:-10px;margin-left: 0px;padding-right: 15px;border-radius: 6px 0px 0px 6px;">
				<div :style="{ display: isShowTotaltokensSVG ? 'flex' : 'none' }" >
					<svg xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="25" height="18"  viewBox="0 0 25 19"  fill="currentColor" stroke-width="0.02"  stroke="currentColor"  stroke-linecap="round" stroke-linejoin="round">
							<path d="m10.62109,1.66441c-1.05095,-0.60518 -2.43437,-0.9385 -3.89526,-0.9385c-1.46093,0 -2.84426,0.33332 -3.89526,0.9385c-1.12359,0.64701 -1.74652,1.53053 -1.75767,2.49024l-0.00051,0l0,10.75701c0,1.91873 2.48327,3.42172 5.65344,3.42172c3.17018,0 5.65349,-1.50299 5.65349,-3.42172l0,-10.74381l-0.00023,0c-0.00557,-0.96482 -0.62926,-1.85344 -1.758,-2.50345zm0.77473,6.82194c0,1.32648 -2.13857,2.44712 -4.66998,2.44712c-2.53136,0 -4.66994,-1.12064 -4.66994,-2.44712l0,-0.18096c1.01002,0.8957 2.70835,1.47278 4.66994,1.47278c1.96163,0 3.65992,-0.57714 4.66998,-1.47278l0,0.18096zm0,2.13876c0,1.32652 -2.13857,2.44716 -4.66998,2.44716c-2.53136,0 -4.66994,-1.12068 -4.66994,-2.44716l0,-0.18092c1.01002,0.89565 2.70835,1.47278 4.66994,1.47278c1.96163,0 3.65992,-0.57713 4.66998,-1.47278l0,0.18092zm-9.33992,1.95788c1.01002,0.8957 2.70835,1.47278 4.66993,1.47278c1.96164,0 3.65992,-0.57713 4.66998,-1.47283l0,0.18102c0,1.32647 -2.13857,2.44711 -4.66998,2.44711c-2.53136,0 -4.66993,-1.12064 -4.66993,-2.44711l0,-0.18097zm9.33992,-6.23549c0,1.32647 -2.13857,2.44711 -4.66998,2.44711c-2.53137,0.00005 -4.66994,-1.12063 -4.66994,-2.44711l0,-0.22269c1.01002,0.88937 2.70835,1.46238 4.66993,1.46238c1.96164,0 3.65992,-0.57306 4.66998,-1.46238l0,0.22269l0,0zm-8.07442,-3.83077c0.90403,-0.52061 2.11309,-0.80727 3.40444,-0.80727c1.29139,0 2.50046,0.28671 3.40449,0.80727c0.80423,0.46309 1.2655,1.06963 1.2655,1.66405c0,1.31336 -2.13857,2.4229 -4.66998,2.4229c-2.53136,0 -4.66994,-1.10954 -4.66994,-2.4229c0,-0.59441 0.46127,-1.20095 1.26549,-1.66405zm3.40444,14.83319c-2.53136,0 -4.66993,-1.11656 -4.66993,-2.43826l0,-0.18982c1.01002,0.89566 2.70835,1.47279 4.66993,1.47279c1.96164,0 3.65992,-0.57713 4.66998,-1.47279l0,0.18987c0,1.32166 -2.13862,2.43822 -4.66998,2.43822z"/>
							<path d="m24.01826,10.37334c-0.00347,-0.9667 -0.62739,-1.85725 -1.75804,-2.50833c-1.05095,-0.60519 -2.43437,-0.9385 -3.89531,-0.9385c-1.46088,0 -2.84426,0.33332 -3.89526,0.9385c-1.1338,0.65286 -1.75818,1.54655 -1.75818,2.51633c0,0.00023 0,0.00047 0,0.00075l0,0l0,4.32772c0,1.91086 2.48326,3.40772 5.65344,3.40772c3.17018,0 5.65349,-1.49686 5.65349,-3.40772l0,-4.33653l-0.00014,0l0,0.00005zm-0.98337,2.17477c0,1.32648 -2.13857,2.44717 -4.66999,2.44717c-2.53137,0 -4.66993,-1.12065 -4.66993,-2.44717l0,-0.22269c1.01002,0.88937 2.7083,1.46238 4.66993,1.46238s3.65992,-0.57301 4.66999,-1.46238l0,0.22269zm-8.07442,-3.83077c0.90403,-0.52061 2.11309,-0.80727 3.40444,-0.80727c1.29135,0 2.50046,0.28672 3.40449,0.80727c0.80423,0.46309 1.2655,1.06964 1.2655,1.66405c0,1.31336 -2.13857,2.4229 -4.66999,2.4229c-2.53137,0 -4.66993,-1.10954 -4.66993,-2.4229c0.00005,-0.59441 0.46127,-1.20096 1.2655,-1.66405zm3.40444,8.41673c-2.53137,0 -4.66993,-1.11014 -4.66993,-2.42421l0,-0.20386c1.01002,0.89565 2.7083,1.47277 4.66993,1.47277s3.65992,-0.57708 4.66998,-1.47277l0,0.20386c0,1.31407 -2.13857,2.42421 -4.66998,2.42421z" />
					</svg>
				</div>
				<span v-if="settingsLanguage == 'cn' " :style="{ display: isShowTotaltokensLabel ? 'flex' : 'none' }" >&nbsp;Token用量</span>
				<span v-else :style="{ display: isShowTotaltokensLabel ? 'flex' : 'none' }" >&nbsp;Tokens</span>
				<span>:&nbsp;{{totaltokens}}</span>
			</button>
			<!-- 简化聊天记录 1111111111 Chat Simplifier Shortcut  --> 
			<button disabled title="压缩上下文。待开发 Under development" class="btn" style="margin-right:auto;padding-left:9px;border-radius: 0px 6px 6px 0px;">
				<div>
					<svg  xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" stroke="currentColor" stroke-width="0.1" stroke-linecap="round" stroke-linejoin="round">
					  <path d="m9.58259,6.35354c0.15086,0 0.26579,-0.05745 0.41661,-0.19392l2.39193,-2.22672c0.12211,-0.10776 0.18678,-0.23705 0.18678,-0.40226c0,-0.2945 -0.22266,-0.50999 -0.52437,-0.50999c-0.14364,0 -0.28011,0.06463 -0.39505,0.17239l-0.93378,0.93378l-0.61774,0.64649l0.05027,-1.20675l0,-2.3704c0,-0.30168 -0.26576,-0.55308 -0.57465,-0.55308c-0.30886,0 -0.56744,0.2514 -0.56744,0.55308l0,2.3704l0.0431,1.20675l-0.61774,-0.64649l-0.93378,-0.93378c-0.10776,-0.10776 -0.2514,-0.17239 -0.39508,-0.17239c-0.30886,0 -0.52434,0.21548 -0.52434,0.50999c0,0.16521 0.06463,0.2945 0.19392,0.40226l2.38478,2.22672c0.15082,0.13647 0.27294,0.19392 0.41658,0.19392zm-6.04805,5.46626l12.09611,0c1.19951,0 2.03274,-0.8117 2.03274,-1.91786l0,-0.73268c0,-1.10617 -0.83323,-1.91783 -2.03274,-1.91783l-12.09611,0c-1.19236,0 -2.03277,0.81167 -2.03277,1.91783l0,0.73268c0,1.10617 0.84041,1.91786 2.03277,1.91786zm0.15086,-1.08463c-0.64649,0 -1.04154,-0.431 -1.04154,-1.01283l0,-0.37349c0,-0.58182 0.39505,-1.01283 1.04154,-1.01283l11.79446,0c0.64639,0 1.04154,0.431 1.04154,1.01283l0,0.37349c0,0.58183 -0.39514,1.01283 -1.04154,1.01283l-11.79446,0zm5.8972,7.69295c0.30889,0 0.57465,-0.2514 0.57465,-0.55308l0,-2.37039l-0.05027,-1.20671l0.61774,0.64645l0.93378,0.93378c0.11493,0.10776 0.2514,0.17239 0.39505,0.17239c0.30171,0 0.52437,-0.20831 0.52437,-0.50998c0,-0.16521 -0.06466,-0.28732 -0.18678,-0.40223l-2.39193,-2.22675c-0.15082,-0.13647 -0.26576,-0.18674 -0.41661,-0.18674c-0.14365,0 -0.26576,0.05027 -0.41658,0.18674l-2.38478,2.22675c-0.12929,0.1149 -0.19392,0.23702 -0.19392,0.40223c0,0.30168 0.21549,0.50998 0.52434,0.50998c0.14368,0 0.28732,-0.06463 0.39508,-0.17239l0.93378,-0.93378l0.61774,-0.64645l-0.0431,1.20671l0,2.37039c0,0.30168 0.25858,0.55308 0.56744,0.55308z" />
					</svg>
				</div>
			</button>
			
			<!-- Second row - Right -->
		 	<button @click="undo" :disabled="btnDisabledState_Undo" class="btn" style="margin-left:auto;margin-right:4px;width:45px;"  >
				<div>
					<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="23px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" >
						<path d="M5 9.5C8.5 9.5 11.5 9.5 15 9.5C15.1615 9.5 19 9.5 19 13.5C19 18 15.2976 18 15 18C12 18 10 18 7 18"/>
						<path d="M8.5 13C7.13317 11.6332 6.36683 10.8668 5 9.5C6.36683 8.13317 7.13317 7.36683 8.5 6" />
					</svg>
				</div>
			</button>
			<button @click="retry" :disabled="btnDisabledState_Undo"  class="btn"  style="margin-right:4px;width:45px;">
				<div>
					<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round">
						<path d="M17 2.1l4 4-4 4"/>
						<path d="M3 12.2v-2a4 4 0 0 1 4-4h12.8M7 21.9l-4-4 4-4"/>
						<path d="M21 11.8v2a4 4 0 0 1-4 4H4.2"/>
					</svg>
				</div>
			</button>
			<button @click="openDialogTodo_Settings" class="btn" :class="{ 'redbtn': !btnDisabledState_CheckAPI }" style="margin-right:4px;width:45px;" >
				<div>
					<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<circle cx="12" cy="12" r="3"></circle>
						<path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
					</svg>
				</div>
			</button>
			<button @click="openDialog_Help" class="btn bluebtn" style="width:45px;" >
				<div>
					<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<circle cx="12" cy="12" r="10"></circle>
						<path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
						<line x1="12" y1="17" x2="12.01" y2="17"></line>
					</svg>
				</div>
			</button>
		</div>
	</div>
	<!-- End: 主界面-底部  Main interface - Bottom  -->



	<!-- dialog-wrapper A: 设置 Settings -->  
	<div id="dialog-settings" class="dialog-wrapper" v-show="isShowDialog_Settings">
		<!-- A: dialog -->  
		<div class="dialog">
	
			<!-- A: 标题 header -->  
			<div class="dialog-header">
				<div class="dialog-title" style="justify-content: space-between;width: calc(95% - 27px);" >
					<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle>
					<path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
					</svg>
					{{ settingsLanguage == 'cn' ? '&nbsp;设置' : '&nbsp;Settings' }}
					<select @change="changeSimpleMode(true)" class="dropdown minibtn minibtn-default bluedropdown btnzoom-b" v-model="isSimpleMode" :style="{ marginLeft: settingsLanguage == 'cn' ? '5px' : '5px',marginTop: settingsLanguage == 'cn' ? '0.5px' : '1.5px', width: settingsLanguage == 'cn' ? ( isSimpleMode ? '64px' : '77px' ) : ( isSimpleMode ? '91px' : '111px' )}">
						<option v-if="settingsLanguage == 'cn'" v-for="option in simpleModeOptions_cn" :value="option.state">{{ option.label }}</option>
						<option v-else v-for="option in simpleModeOptions_en" :value="option.state">{{ option.label }}</option>
					</select>
					<span style="margin-left:auto">LinGPT v7.05&nbsp;&nbsp;</span>
					<button  class="btn btnzoom-a" style="margin: 0px; padding: 0 3px;background: #fff;height: 20px;width: 20px; box-shadow: 0 0 0px 0.5px rgba(80, 80, 80, 0.08);" >
						<a href="https://github.com/lin2025/gpt3.5/" target="_blank">
							<svg xmlns="http://www.w3.org/2000/svg" width="14" viewBox="0 0 16 16"  fill="#1f2328"> 
								<path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path>
							</svg>
						</a>
					</button>
					<button  class="btn btnzoom-a" style="margin-left: 5px; padding: 0 3px;background: #fff;height: 20px;width: 20px; box-shadow: 0 0 0px 0.5px rgba(80, 80, 80, 0.08);" >
						<a href="https://gitee.com/lin2025/gpt3.5/" target="_blank">
							<svg xmlns="http://www.w3.org/2000/svg" width="14" viewBox="0 0 24 24" fill="#c61d22">
								<path d="m11.984,0a12,12 0 0 0 -11.984,12a12,12 0 0 0 12,12a12,12 0 0 0 12,-12a12,12 0 0 0 -12,-12a12,12 0 0 0 -0.016,0zm6.09,5.333c0.328,0 0.593,0.266 0.592,0.593l0,1.482a0.594,0.594 0 0 1 -0.593,0.592l-8.296,0c-0.982,0 -1.778,0.796 -1.778,1.778l0,5.63c0,0.327 0.266,0.592 0.593,0.592l5.63,0c0.982,0 1.778,-0.796 1.778,-1.778l0,-0.296a0.593,0.593 0 0 0 -0.592,-0.593l-4.15,0a0.592,0.592 0 0 1 -0.592,-0.592l0,-1.482a0.593,0.593 0 0 1 0.593,-0.592l6.815,0c0.327,0 0.593,0.265 0.593,0.592l0,3.408a4,4 0 0 1 -4,4l-8.741,0a0.593,0.593 0 0 1 -0.593,-0.593l0,-8.296a4.444,4.444 0 0 1 4.445,-4.444l8.296,0l0,-0.001z"/>
							</svg>
						</a>
					</button> 
				</div>
			
				<div class="dialog-close" @click="isShowDialog_Settings = false">
					<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="fill: none; stroke: #333; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;">
						<path d="M6 18L18 6M6 6l12 12"></path>
					</svg>
				</div>
			</div>
		
			<!-- A: 滚动框架 scroll -->
			<div class="dialog-scroll">
			<!-- A: 主体内容 content -->  
			<div class="dialog-content">
 
				<!-- panelgroup: 接口密钥 API-Key --> 
				<div class="panelgroup panelgroup-shadow">
					<div class="panelgroup-head">
						<span>{{ settingsLanguage == 'cn' ? 'OpenAI 接口密钥 / API-Key ' : 'OpenAI API-Key ' }}</span>
						<button  @click="showMiniHelp('A-CheckAPIKey')"  class="btn minibtn bluebtn btnzoom-b" :style="{ marginRight: btnDisabledState_CheckAPI ? 'auto' : '2px' }"  >?</button>
						<span :style="{ display: btnDisabledState_CheckAPI ? 'none' : 'block' }"  style="margin-right: auto;color: #e63214;font-size: 11px;">{{ settingsLanguage == 'cn' ? '*必填' : '*Required' }}</span>
						<!-- 待开发。。。。。11111111111 display:none; --> 
						<button  class="btn minibtn minibtn-default bluebtn btnzoom-b" style="display:none;">{{ settingsLanguage == 'cn' ? '点击我: 获取免费的体验密钥' : 'Click me: Free trial key' }}</button>
					</div>
				
					<div class="panelrow"> 
						<!-- 一键复制api-key  Cpoy api-key --> 
						<button class="copybtn btncopyapikey" data-clipboard-nextelementsibling="" style="opacity:1;position:relative;flex-shrink: 0;height: 25px;top:0;right:0;margin-right:-4px;border-radius: 6px 0px 0px 6px;border: 1px solid #DDD;width: 25px" >
							<div>
								<svg width="14" height="17" class="clippy" fill="currentColor">
									<path d="m2.36373,12.61912l4.12233,0l0,1.03058l-4.12233,0l0,-1.03058zm5.15291,-6.18349l-5.15291,0l0,1.03058l5.15291,0l0,-1.03058zm2.06116,3.09174l0,-2.06116l-3.09174,3.09174l3.09174,3.09174l0,-2.06116l5.15291,0l0,-2.06116l-5.15291,0zm-4.63761,-1.03058l-2.57645,0l0,1.03058l2.57645,0l0,-1.03058zm-2.57645,3.09174l2.57645,0l0,-1.03058l-2.57645,0l0,1.03058zm9.27523,1.03058l1.03058,0l0,2.06116c-0.0161,0.28985 -0.11272,0.53139 -0.30595,0.72463s-0.43478,0.28985 -0.72463,0.30595l-10.30581,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058l0,-11.33639c0,-0.5636 0.46698,-1.03058 1.03058,-1.03058l3.09175,0c0,-1.1433 0.91786,-2.06116 2.06116,-2.06116s2.06116,0.91786 2.06116,2.06116l3.09174,0c0.5636,0 1.03058,0.46698 1.03058,1.03058l0,5.15291l-1.03058,0l0,-3.09174l-10.30581,0l0,9.27523l10.30581,0l0,-2.06116zm-9.27523,-8.24465l8.24465,0c0,-0.5636 -0.46698,-1.03058 -1.03058,-1.03058l-1.03058,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058s-0.46698,-1.03058 -1.03058,-1.03058s-1.03058,0.46698 -1.03058,1.03058s-0.46698,1.03058 -1.03058,1.03058l-1.03058,0c-0.5636,0 -1.03058,0.46698 -1.03058,1.03058z">
									</path>
								</svg>
							</div>
						</button>
						<!-- 隐藏的API-key，这个可被复制内容  hide : Function: Data can be read by "Copy Btn" --> 
						<input class="inputghostforcopyapikey" type="text" v-model="api" style="opacity:0;height:1px;width:1px;overflow:hidden;margin:0;padding:0;border:none;" />
						<!-- API-key输入框。 因为type="password" ，不可被复制。 Because type="password", it cannot be copied by "Copy Btn". --> 	
						<input @blur="inputapiblur" @focus="inputapifocus"  @input="inputapichange(false)" :style="{ color: btnDisabledState_CheckAPI ? '#cccccc' : '#191919' }" v-model="api" type="password"  class="dh-input inputapikey"  style="border-radius: 0px;"  :placeholder="settingsLanguage == 'cn' ? 'API-key粘贴到这里' : 'Paste your API-Key here.' " />
						<!-- 验证API-key Check API-key --> 	
						<button @click="checkAPIbtn" :disabled="btnDisabledState_CheckAPI" class="btn" :class="{ 'redbtn': !btnDisabledState_CheckAPI }" style="border-radius: 0px 6px 6px 0px;margin-left:-3px;"  >{{apibtntext}}</button>
						<!-- 查询OpenAI API余额 Check OpenAI API balances --> 	
						<button  onclick="sendRequest()" :disabled="!btnDisabledState_CheckAPI" class="btn" style="padding: 0 8px;">
							<div>
								<svg xmlns="http://www.w3.org/2000/svg" width="21px" height="20px" viewBox="0 0 24 24" fill="none"  stroke="currentColor" stroke-width="1.75" stroke-miterlimit="10">  
									<circle cx="9.5106" cy="9.42613" r="7.64"/>
									<path d="m6.6506,12.28613l3.34,0a1.43,1.43 0 0 0 1.43,-1.43l0,0a1.43,1.43 0 0 0 -1.43,-1.43l-0.95,0a1.44,1.44 0 0 1 -1.39,-1.44l0,0a1.44,1.44 0 0 1 1.44,-1.43l3.34,0"/>
									<line x1="9.5106" x2="9.5106" y1="4.64613" y2="6.55613"/><line x1="9.5106" x2="9.5106" y1="12.28613" y2="14.19613"/><line transform="rotate(90 18.2202 18.6877)" x1="14.70164" x2="21.73886" y1="22.20633" y2="15.16912"/>  
								</svg>
							</div>
						</button>
					</div>
				</div>


				<!-- panelgroup: API设置  API Settings --> 
				<div class="panelgroup panelgroup-shadow">
					<div class="panelgroup-head">
						<span>{{ settingsLanguage == 'cn' ? 'API设置' : 'API Settings' }}</span>
						<button  @click="showMiniHelp('A-APISettings')"  class="btn minibtn bluebtn btnzoom-b"  style="margin-right: auto;">?</button>
						<button  @click="showMiniHelp('A-SmartMaxTokens')"  class="btn minibtn orangeredbtn btnzoom-c" style="width: 12px; height: 12px;" :style="{ display: openSmartMaxTokens  ? 'block' : 'none', marginRight: settingsLanguage == 'cn' ? '-7px' : '-9px'}">?</button>
						<select @change="changeSmartMaxTokens" class="dropdown minibtn minibtn-default btnzoom-d" :class="{ 'orangereddropdown': openSmartMaxTokens }" v-model="openSmartMaxTokens" :style="{ marginRight: settingsLanguage == 'cn' ? '-9px' : '-13px'}">
								<option v-if="settingsLanguage == 'cn'" v-for="option in smartMaxTokensOptions_cn" :value="option.state">{{ option.label }}</option>
								<option v-else v-for="option in smartMaxTokensOptions_en" :value="option.state">{{ option.label }}</option>
						</select>
						<button  @click="restoreDefault_APISettings"  class="btn minibtn minibtn-default bluebtn btnzoom-b" :style="{ marginRight: settingsLanguage == 'cn' ? '-2px' : '-4px'}">{{ settingsLanguage == 'cn' ? '恢复默认' : 'Restore Default' }}</button>
					</div>

					<div class="panelrow" style="align-items: start; height:auto;">
						<!--温度/随机性/创造力 temperature --> 
						<div class="control-container" style="width:108px;flex-shrink: 0;">
							<div>
								<span>temperature: {{apitemperature}}</span>
							</div>
							<div class="control-bg" >
								<input @change="changeTemperature" type="range" class="slider" v-model.number="apitemperature"  min="0.0" max="2.0" step="0.1" value="0.7" >
							</div>
						</div>
						<!-- 单次 最大令牌数量 max_tokens (4095 4096 4097  gpt-3.5 gpt-4 gpt3.5 gpt4) --> 
						<div class="control-container" style="flex: 1 1 0%;">
							<div>
								<span>max_tokens(1~4096): {{apiMaxTokens}}</span>
							</div>
							<div class="control-bg">
								<input @change="changeMaxTokens" type="range" :disabled="openSmartMaxTokens" class="slider" v-model.number="apiMaxTokens"  min="1" max="4096" step="1" value="2048" >
							</div>
						</div>
					</div>	
	
					<div class="panelrow" style="align-items: start; height:auto;">
						<!-- GPT模型 GPT Model --> 
						<div class="control-container" style="width:156px;flex-shrink: 0;">
							<div>
								<span>model: {{apiGPTModel}}</span>
							</div>
							<select class="dropdown" v-model="apiGPTModel" style="width: 100%;height: 24px;">
								<option v-for="option in gptModelOptions" :value="option.model">{{ option.label }}</option>
								<option v-if="settingsLanguage == 'cn' "  disabled value=""> - 暂时只支持GPT3.5</option>
								<option v-else disabled value=""> - Only supports GPT3.5 for now</option>
							</select>
						</div>
	
						<!-- 单次最大令牌数量（精细调节 1～300） max_tokens（Fine 1～300）  --> 
						<div class="control-container" style="flex: 1 1 0%;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? 'max_tokens(微调)' : 'max_tokens(Fine)' }}</span>
							</div>
							<div class="control-bg">
								<input @change="changeMaxTokens" type="range" :disabled="openSmartMaxTokens" class="slider" v-model.number="apiMaxTokens"  min="1" max="300" step="1" value="2048" >
							</div>
						</div>
	
						<!-- 显示专业设置 Show more settings (Professional API Settings) --> 
						<div class="control-container">
							<div>
								<span>{{ settingsLanguage == 'cn' ? ' 更多' : ' More' }}</span>
							</div>
							<button  @click="showProConfig"  class="btn bluebtn btnzoom-c" style="margin: 0;padding: 0 4px;">
								<div>
									PRO
								</div>
							</button>
						</div>
					</div>
				</div>

				<!-- panelgroup: API专业设置  Professional API Settings --> 
				<div class="panelgroup panelgroup-shadow" :style="{ display: isShowProConfig ? 'block' : 'none'}">
					<div class="panelgroup-head">
						<span>{{ settingsLanguage == 'cn' ? 'API专业设置' : 'Professional API Settings' }}</span>
						<button  @click="showMiniHelp('A-ProfessionalAPISettings')"  class="btn minibtn bluebtn btnzoom-b" style="margin-right: auto;">?</button>
						<button  @click="restoreDefault_ProfessionalAPISettings"  class="btn minibtn minibtn-default bluebtn btnzoom-b" :style="{ marginRight: settingsLanguage == 'cn' ? '-2px' : '-4px'}">{{ settingsLanguage == 'cn' ? '恢复默认' : 'Restore Default' }}</button>
					</div>
				
					<!-- 接口网址 API URL / API Endpoint  --> 
					<div class="panelrow" style="align-items: start; height:auto;">
						<span style="line-height: 25px;font-size: 12px;flex-shrink: 0;">
							{{ settingsLanguage == 'cn' ? '接口网址 :' : 'API URL :' }} 
						</span>
						<input type="text" @input="inputApiURLChange" v-model="inputApiURL" class="dh-input" style="border-radius:6px 0px 0px 6px;"  :placeholder="settingsLanguage == 'cn' ? '清空后保存 可重置为OpenAI官方接口' : 'Clear and save, can be reset to OpenAI API endpoint.' "  />
						<button @click="saveApiURL" :disabled="btnDisabledState_SaveApiURL" class="btn" style="border-radius: 0px 6px 6px 0px;margin-left:-3px;"  >
							{{ settingsLanguage == 'cn' ? '保存' : 'Save' }} 
						</button>	
						<select @change="updateInputApiURL" :disabled="btnDisabledState_ApiURL" class="dropdown" v-model="selectedApiURL" style="width:45px;">
							<option disabled value="">&nbsp;&nbsp;▼&nbsp;&nbsp;&nbsp;{{ settingsLanguage == 'cn' ? '预设选项：官方接口 和 第三方接口' : 'Default presets: OpenAI API and Third-party API ' }}</option>
							<option v-if="settingsLanguage == 'cn'" v-for="option in apiURLOptions_cn" :value="option.url">{{ option.label }}</option>
							<option v-else v-for="option in apiURLOptions_en" :value="option.url">{{ option.label }}</option>
							<option disabled value="">{{ settingsLanguage == 'cn' ? ' - 第三方接口来源网络，无法保证隐私安全和实效性' : ' - Third-party APIs can be unsafe or unreliable.' }}</option>
						</select>		
					</div>
	
					<div class="panelrow" style="align-items: start; height:auto;">
						<!-- top_p --> 
						<div class="control-container" style="flex: 1 1 0%;">
							<div>
								<span style="font-size: 11px;">top_p: {{apiTopP}}</span>
							</div>
							<div class="control-bg" >
								<input type="range" class="slider" v-model.number="apiTopP"  min="0.0" max="1" step="0.1" value="1" >
							</div>
						</div>
	
						<!-- presence_penalty --> 
						<div class="control-container" style="width: 48%;flex: 1 1 15%;">
							<div>
								<span style="font-size: 11px;">presence_penalty: {{apiPresencePenalty}}</span>
							</div>
							<div class="control-bg" >
								<input type="range" class="slider" v-model.number="apiPresencePenalty"  min="-2.0" max="2.0" step="0.1" value="0" >
							</div>
						</div>
	
						<!-- frequency_penalty --> 
						<div class="control-container" style="width: 48%;flex: 1 1 15%;">
							<div>
								<span style="font-size: 11px;">frequency_penalty: {{apiFrequencyPenalty}}</span>
							</div>
							<div class="control-bg" >
								<input type="range" class="slider" v-model.number="apiFrequencyPenalty"  min="-2.0" max="2.0" step="0.1" value="0" >
							</div>
						</div>
					</div>
				</div>

				<!-- panelgroup: 常规设置 General Settings --> 
				<div class="panelgroup panelgroup-shadow">
					<div class="panelgroup-head">
						<span>{{ settingsLanguage == 'cn' ? '常规设置' : 'General Settings' }}</span>
						<button  @click="showMiniHelp('A-GeneralSettings')"  class="btn minibtn bluebtn btnzoom-b" style="margin-right: auto;">?</button>
						<button  @click="restoreDefault_GeneralSettings"  class="btn minibtn minibtn-default bluebtn btnzoom-b" :style="{ marginRight: settingsLanguage == 'cn' ? '-2px' : '-4px'}">{{ settingsLanguage == 'cn' ? '恢复默认' : 'Restore Default' }}</button>
					</div>
				
					<div class="panelrow" style="align-items: start; height:auto;flex-wrap: wrap;justify-content: stretch;">
						<!-- 语言切换 中/英 Language --> 
						<div class="control-container" style="min-width: 80px;max-width: 180px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? 'Language &#127464;&#127475;' : '语言 &#x1F1EC;&#x1F1E7;' }}</span>
							</div>
							<select @change="changeLanguage" :disabled="btnDisabledState_Language" class="dropdown" v-model="settingsLanguage" style="width: 100%;height: 24px;">
								<option v-for="option in settingsLanguageOptions" :value="option.lang">{{ option.label }}</option>
							</select>
						</div>
						<!-- 字体大小 Font Size --> 
						<div class="control-container" style="min-width: 65px;max-width: 165px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '字体大小' : 'Font Size' }}</span>
							</div>
							<select @change="changeStyle_FontSize" class="dropdown" v-model="settingsFontSize" style="width: 100%;height: 24px;">
								<option v-for="option in settingsFontSizeOptions" :value="option.fontsize">{{ option.label }}</option>
							</select>
						</div>
						<!-- 显示时间(微信样式)  Display time (WeChat style) --> 
						<div class="control-container" style="min-width: 125px;max-width: 225px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '仿微信时间' : 'Time (WeChat style)' }}</span>
							</div>
							<select @change="changeStyle_Time_WechatStyle" class="dropdown" v-model="settingsTime_WechatStyle" style="width: 100%;height: 24px;">
								<option v-if="settingsLanguage == 'cn'" v-for="option in settingsTimeWechatStyleOptions_cn" :value="option.displaytime">{{ option.label }}</option>
								<option v-else v-for="option in settingsTimeWechatStyleOptions_en" :value="option.displaytime">{{ option.label }}</option> 
							</select>
						</div>
						<!-- 显示消息时间  Display message time.  --> 
						<div class="control-container" style="min-width: 105px;max-width: 205px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '消息时间' : 'Time (Message)' }}</span>
							</div>
							<select @change="changeStyle_Time" class="dropdown" v-model="settingsTime_Message" style="width: 100%;height: 24px;">
								<option v-if="settingsLanguage == 'cn'" v-for="option in settingsTimeMessageOptions_cn" :value="option.displaytime">{{ option.label }}</option>
								<option v-else v-for="option in settingsTimeMessageOptions_en" :value="option.displaytime">{{ option.label }}</option>
							</select>
						</div>
						<!-- 显示分割线 记忆分割线/上下文分割线 Display divider line --> 
						<div class="control-container" style="min-width: 125px;max-width: 225px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '记忆分割线' : 'Context Divider Line' }}</span>
							</div>
							<select @change="changeStyle_DividerLine" class="dropdown" v-model="settingsDividerLine" style="width: 100%;height: 24px;">
								<option v-if="settingsLanguage == 'cn'" v-for="option in settingsDividerLineOptions_cn" :value="option.displaydividerline">{{ option.label }}</option>
								<option v-else v-for="option in settingsDividerLineOptions_en" :value="option.displaydividerline">{{ option.label }}</option>
							</select>
						</div>
			
			
						<!-- 记忆模式 / 上下文模式  Contextual Mode --> 
						<div class="control-container" style="min-width: 110px;max-width: 210px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '记忆模式' : 'Contextual Mode' }}</span>
							</div>
							<select @change="changeContextualMode" :disabled="btnDisabledState_ContextualMode" class="dropdown" v-model="settingsContextualMode" style="width: 100%;height: 24px;">
								<option v-if="settingsLanguage == 'cn'" v-for="option in settingsContextualModeOptions_cn" :value="option.mode">{{ option.label }}</option>
								<option v-else v-for="option in settingsContextualModeOptions_en" :value="option.mode">{{ option.label }}</option>
								<option disabled value="">更多:待开发  More:Under development</option>
							</select>
						</div>
	
						<!-- 验证API-Key 快捷键 Check API-Key Shortcut  --> 
						<div class="control-container" style="min-width: 150px;max-width: 260px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '[验证API-Key]快捷键' : '[Check API-Key] Shortcut' }}</span>
							</div>
							<select class="dropdown" v-model="settingsShortcut_CheckApiKey" style="width: 100%;height: 24px;">
								<option v-if="settingsLanguage == 'cn'" v-for="option in settingsShortcutCheckApiKeyOptions_cn" :value="option.shortcut">{{ option.label }}</option>
								<option v-else v-for="option in settingsShortcutCheckApiKeyOptions_en" :value="option.shortcut">{{ option.label }}</option>
							</select>
						</div>
		
						<!-- 清空快捷键 Clear Context Shortcut--> 
						<div class="control-container" style="min-width: 140px;max-width: 250px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '[清空]快捷键' : '[Clear Context] Shortcut' }}</span>
							</div>
							<select class="dropdown" v-model="settingsShortcut_Clear" style="width: 100%;height: 24px;">
								<option v-if="settingsLanguage == 'cn'" v-for="option in settingsShortcutClearOptions_cn" :value="option.shortcut">{{ option.label }}</option>
								<option v-else v-for="option in settingsShortcutClearOptions_en" :value="option.shortcut">{{ option.label }}</option>
							</select>
						</div>
	
						<!-- 撤销快捷键 Undo Shortcut --> 
						<div class="control-container" style="min-width: 95px;max-width: 195px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '[撤销]快捷键' : '[Undo] Shortcut' }}</span>
							</div>
							<select class="dropdown" v-model="settingsShortcut_Undo" style="width: 100%;height: 24px;">
								<option v-if="settingsLanguage == 'cn'" v-for="option in settingsShortcutUndoOptions_cn" :value="option.shortcut">{{ option.label }}</option>
								<option v-else v-for="option in settingsShortcutUndoOptions_en" :value="option.shortcut">{{ option.label }}</option>
							</select>
						</div>
	
						<!-- 重问快捷键 Retry Shortcut --> 
						<div class="control-container" style="min-width: 95px;max-width: 195px;flex: 1 1 0%;margin: 0px 3px;">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '[重问]快捷键' : '[Retry] Shortcut' }}</span>
							</div>
							<select class="dropdown" v-model="settingsShortcut_Retry" style="width: 100%;height: 24px;">
								<option v-if="settingsLanguage == 'cn'" v-for="option in settingsShortcutRetryOptions_cn" :value="option.shortcut">{{ option.label }}</option>
								<option v-else v-for="option in settingsShortcutRetryOptions_en" :value="option.shortcut">{{ option.label }}</option>
							</select>
						</div>
					</div>

					<!-- 用户头像 user Avatar  -->
					<div class="panelrow" style="height:36px;">
						<select class="dropdown" v-model="selectedImageUrl" @change="updateSelectedImage('user')" :style="{ width: settingsLanguage == 'cn' ? '72px' : '87px' }" style="flex-shrink: 0;height: 24px;margin-right: 4px;margin-left: 3px;">
							<option value="">{{ settingsLanguage == 'cn' ? '用户头像' : 'User Avatar' }}</option>
							<option value="uploadimage">{{ settingsLanguage == 'cn' ? '0) 点击右侧头像 可上传图片' : '0) Click the "Avatar" to upload an image' }}</option>
							<option :value="userAvatarUp_blobUrl">{{ settingsLanguage == 'cn' ? (userAvatarUp_blobUrl == '' ? '1) 最近上传的用户头像 (您还没上传小于350KB的头像)' : '1) 最近上传的用户头像 (可用)') : (userAvatarUp_blobUrl == '' ? '1) Uploaded User Avatar (No uploaded avatar within 350KB)' : '1) Uploaded User Avatar (Available)') }}</option>
							<option v-for="image in userpresetImages" :value="image.url">{{image.name}}</option>
						</select>
						<span style="line-height: 25px; font-size: 12px; flex-shrink: 0;">{{ settingsLanguage == 'cn' ? '或 URL:' : 'or URL' }}</span>
						<input type="text" v-model="inputUserImageUrl" @input="inputImageUrlChange('user')" class="dh-input" style="flex: 1 1 0%;border-radius:6px 0px 0px 6px;" :placeholder="settingsLanguage == 'cn' ? '输入图片的网址（本地运行.html网页时支持电脑中图片的本地路径）' : 'Image URL. (Local image paths are supported when running *.html from PC/Mac.)' " >
						<button @click="updateAvatar('user')" :disabled="btnDisabledState_updateUserImageUrl" class="btn" :style="{ width: settingsLanguage == 'cn' ? '68px' : '85px' }" style="flex-shrink: 0;border-radius: 0px 6px 6px 0px;margin-left:-3px;margin-right: 4px;"  >{{ settingsLanguage == 'cn' ? '更换 >>' : 'Update >>' }}</button>
						<div id="div-upload-userAvataror" class="chat-img chat-img-bg chat-img-border update-img-size btnzoom-a">
							<img :src="userAvatarURL">
						</div>
					</div> 
					<!-- GPT头像 gpt Avatar  -->
					<div class="panelrow" style="height:35px;">
						<select class="dropdown" v-model="selectedImageUrl" @change="updateSelectedImage('gpt')" :style="{ width: settingsLanguage == 'cn' ? '72px' : '87px' }" style="flex-shrink: 0;height: 24px;margin-right: 4px;margin-left: 3px;">
							<option value="">{{ settingsLanguage == 'cn' ? 'GPT头像' : 'GPT Avatar' }}</option>
							<option value="uploadimage">{{ settingsLanguage == 'cn' ? '0) 点击右侧头像 可上传图片' : '0) Click the "Avatar" to upload an image' }}</option>
							<option v-for="image in gptpresetImages" :value="image.url">{{image.name}}</option>
						</select>
						<span style="line-height: 25px; font-size: 12px; flex-shrink: 0;">{{ settingsLanguage == 'cn' ? '或 URL:' : 'or URL' }}</span>
						<input type="text" v-model="inputGPTImageUrl" @input="inputImageUrlChange('gpt')" class="dh-input" style="flex: 1 1 0%;border-radius:6px 0px 0px 6px;" :placeholder="settingsLanguage == 'cn' ? '输入图片的网址（本地运行.html网页时支持电脑中图片的本地路径）' : 'Image URL. (Local image paths are supported when running *.html from PC/Mac.)' ">
						<button @click="updateAvatar('gpt')" :disabled="btnDisabledState_updateGPTImageUrl" class="btn" :style="{ width: settingsLanguage == 'cn' ? '68px' : '85px' }" style="flex-shrink: 0;border-radius: 0px 6px 6px 0px;margin-left:-3px;margin-right: 4px;"  >{{ settingsLanguage == 'cn' ? '更换 >>' : 'Update >>' }}</button>
						<div id="div-upload-gptAvataror" class="chat-img chat-img-bg chat-img-border update-img-size btnzoom-a" :style="{ display: isgptGreenSvgShow ? 'none' : 'flex' }">
							<img :src="gptAvatarURL">
						</div>
						<div id="div-upload-gptAvataror-SVG" class="chat-img chat-img-border chat-green-svg update-img-size btnzoom-a" :style="{ display: isgptGreenSvgShow  ? 'flex' : 'none' }">
							<svg width="27" height="27" viewBox="0 0 41 41" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="1.5"  role="img">
								<path d="M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z" fill="currentColor">
							</svg>
						</div>
					</div>
				</div>

				<!-- panelgroup: 打开对话列表 open Chat List   打开提示词窗口 open Prompt Generator   下载聊天记录 Export chat history. --> 
				<div class="panelgroup panelgroup-shadow">
					<div class="panelrow" style="align-items: center; height:auto;flex-wrap: wrap;justify-content: stretch;">
						<div class="control-container" style=" flex: 1 1 0%;" :style="{ minWidth: settingsLanguage == 'cn' ? '119px' : '129px',maxWidth: settingsLanguage == 'cn' ? '179px' : '199px' }">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '对话列表' : 'Chat List' }}</span>
								<button @click="showMiniHelp('C-ChatList')"  class="btn minibtn bluebtn btnzoom-b">?</button>
							</div>
							<button  @click="clickOpenChatList" class="btn bluebtn" style="width:100%;margin: 2px 0px 4px 0px;justify-content: start;">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
								</svg>&nbsp;{{ settingsLanguage == 'cn' ? '打开对话列表' : 'Open Chat List' }}
							</button>
						</div>
						<div class="control-container" style=" flex: 1 1 0%;" :style="{ minWidth: settingsLanguage == 'cn' ? '130px' : '179px',maxWidth: settingsLanguage == 'cn' ? '190px' : '239px' }">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '提示词窗口' : 'Prompt Generator' }}</span>
							</div>
							<button  @click="clickOpenPromptGenerator" class="btn bluebtn" style="width:100%;margin: 2px 0px 4px 0px;justify-content: start;">
								<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0.6" stroke-linecap="round" stroke-linejoin="round">
									<path d="M19.7,23.5H4.3c-2.1,0-3.8-1.7-3.8-3.8V4.3c0-2.1,1.7-3.8,3.8-3.8h15.3c2.1,0,3.8,1.7,3.8,3.8v15.3    C23.5,21.8,21.8,23.5,19.7,23.5z M4.3,1.5c-1.6,0-2.8,1.3-2.8,2.8v15.3c0,1.6,1.3,2.8,2.8,2.8h15.3c1.6,0,2.8-1.3,2.8-2.8V4.3    c0-1.6-1.3-2.8-2.8-2.8H4.3z"/>
									<path d="M10.4,19.2H7.3c-0.3,0-0.5-0.2-0.5-0.5V5.3c0-0.3,0.2-0.5,0.5-0.5h9.3c0.3,0,0.5,0.2,0.5,0.5v8.5c0,0.3-0.2,0.5-0.5,0.5    h-5.7v4.4C10.9,19,10.7,19.2,10.4,19.2z M7.8,18.2h2.1v-4.4c0-0.3,0.2-0.5,0.5-0.5h5.7V5.8H7.8V18.2z M13.6,11.2h-3.2    c-0.3,0-0.5-0.2-0.5-0.5V8.4c0-0.3,0.2-0.5,0.5-0.5h3.2c0.3,0,0.5,0.2,0.5,0.5v2.3C14.1,11,13.9,11.2,13.6,11.2z M10.9,10.2h2.2    V8.9h-2.2V10.2z"/>
								</svg>&nbsp;{{ settingsLanguage == 'cn' ? '打开提示词窗口' : 'Open Prompt Generator' }}
							</button>
						</div>
						<div class="control-container" style=" flex: 1 1 0%;" :style="{ minWidth: settingsLanguage == 'cn' ? '130px' : '179px' }">
							<div>
								<span>{{ settingsLanguage == 'cn' ? '导出聊天记录' : 'Export Chat History' }}</span>
								<button  @click="showMiniHelp('A-ExportChatHistory')"  class="btn minibtn bluebtn btnzoom-b" style="margin-right: auto;">?</button>
							</div>
							<select @change="changeSelectedExportChatHistory" :disabled="btnDisabledState_Export" class="dropdown" v-model="selectedExportChatHistory" style="width: 100%; height: 25px; margin: 2px 0px 4px;">
								<option value="">{{ settingsLanguage == 'cn' ? '当前对话ID: #' + ( this.chatid == null ? '' : (this.chatid.toString().length > 18 ? (this.chatid.toString().slice(0, 18) + " ...") : this.chatid.toString().slice(0, 18))  ) : 'Current Chat ID: #' + ( this.chatid == null ? '' : (this.chatid.toString().length > 18 ? (this.chatid.toString().slice(0, 18) + " ...") : this.chatid.toString().slice(0, 18))  ) }}</option>
								<option disabled value="help1">{{ settingsLanguage == 'cn' ? ' - 导出当前对话的文本内容' : ' - Export the text content of the current chat' }}</option>
								<option v-if="settingsLanguage == 'cn'" v-for="option in selectedExportChatHistoryOptions_cn" :value="option.type">{{ option.label }}</option>
								<option v-else v-for="option in selectedExportChatHistoryOptions_en" :value="option.type">{{ option.label }}</option>
								<option v-if="!isSimpleMode" disabled value="help2">{{ settingsLanguage == 'cn' ? ' - 导出为纯文本，不可用于导入' : ' - Export to Plain Text, Not available for import' }}</option>
								<option v-if="!isSimpleMode" disabled value="help3">{{ settingsLanguage == 'cn' ? ' - 文本内容使用Markdown格式' : ' - Plain text is formatted using Markdown' }}</option>
							</select>
						</div>
					</div>
				</div>

				<!-- panelgroup: 数据管理与隐私 Data Privacy and Management. --> 
				<div class="panelgroup panelgroup-shadow">
					<div class="panelgroup-head">
						<span>{{ settingsLanguage == 'cn' ? '数据管理与隐私 ' : 'Data Privacy and Management ' }}</span>
						<button  @click="showMiniHelp('A-DataPrivacyAndManagement')"  class="btn minibtn bluebtn btnzoom-b" :class="{ 'orangeredbtn': (isLocalStorageSupported && !isSimpleMode) ,'redbtn': !isLocalStorageSupported }" :style="{ marginRight: isLocalStorageSupported ? '2px' : '2px' }" >?</button>
						<span :style="{ color: isLocalStorageSupported ? '#f94000' : '#e63214'}" style="display:block; margin-right: auto;font-size: 12px;">{{ isLocalStorageSupported ? ( isSimpleMode ? '' : (settingsLanguage == 'cn' ? '已启用自动保存，用户数据仅存储在浏览器的缓存中' : 'Autosave has been enabled. User data is stored solely in the browser’s local storage.') ) : (settingsLanguage == 'cn' ? '自动保存不可用，当前浏览器或浏览器模式不支持"浏览器本地存储"' : 'Autosave is not available. LocalStorage is not supported in this browser or browser mode.') }}</span>
					</div>
					
					<div class="panelrow" style="align-items: start; height:auto;flex-wrap: wrap;justify-content: stretch;">
						<select @change="changeSelectedDeleteLocalStorageData" class="dropdown" v-model="selectedDeleteLocalStorageData" style="width: auto;height: 24px; flex: 1 1 0%; margin: 4px 3px 1px 0px;" :style="{ minWidth: settingsLanguage == 'cn' ? '73px' : '92px' }">
							<option value="">{{ settingsLanguage == 'cn' ? '删除数据' : 'Delete Data' }}</option>
							<option v-if="!isSimpleMode" disabled value="help">{{ settingsLanguage == 'cn' ? ' - 删除后不可恢复，重要数据请先做好备份' : ' - Deletion is irreversible. Please backup important data beforehand' }}</option>
							<option v-if="settingsLanguage == 'cn'" v-for="option in selectedDeleteLocalStorageDataOptions_cn" :value="option.type">{{ option.label }}</option>
							<option v-else v-for="option in selectedDeleteLocalStorageDataOptions_en" :value="option.type">{{ option.label }}</option>
						</select>
						<select @change="changeSelectedExportLocalStorageData" :disabled="!isLocalStorageSupported" class="dropdown" v-model="selectedExportLocalStorageData" style="width: auto;height: 24px; flex: 1 1 0%; margin: 4px 3px 1px 3px;" :style="{ minWidth: settingsLanguage == 'cn' ? '87px' : '99px' }">
							<option value="">{{ settingsLanguage == 'cn' ? '导出 (.json)' : 'Export (.json)' }}</option>
							<option v-if="!isSimpleMode" disabled value="help1">{{ settingsLanguage == 'cn' ? ' - 导出的JSON文件，可再次导入到LinGPT' : ' - Export as JSON File for Re-import into LinGPT' }}</option>
							<option v-if="!isSimpleMode" disabled value="help2">{{ settingsLanguage == 'cn' ? ' - 用途：迁移数据、分享给他人、备份数据' : ' - Use: Data Transfer, Share with Others, Backup' }}</option>
							<option v-if="settingsLanguage == 'cn'" v-for="option in selectedExportLocalStorageDataOptions_cn" :value="option.type">{{ option.label }}</option>
							<option v-else v-for="option in selectedExportLocalStorageDataOptions_en" :value="option.type">{{ option.label }}</option>
							<option v-if="!isSimpleMode" disabled value="help3">{{ settingsLanguage == 'cn' ? ' - 如果只想导出单个对话，请在[对话列表]窗口中点击[•••]' : ' - To export a single chat data: Click [•••] in the [Chat List] window' }}</option>
						</select>
						<button @click="importLocalStorageData" :disabled="!isLocalStorageSupported" class="btn" style="justify-content: start;width: auto;height: 24px; flex: 1 1 0%; margin: 4px 3px 1px 3px;" :style="{ minWidth: settingsLanguage == 'cn' ? '88px' : '102px' }">
							{{ settingsLanguage == 'cn' ? '导入 (.json)' : 'Import (.json)' }}
						</button>
						<button  @click="getLocalStorageSize" :disabled="!isLocalStorageSupported" class="btn" style="padding: 0px 4px; height: 24px; line-height: 24px; margin: 4px 2px 1px 3px;">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.2 7.8l-7.7 7.7-4-4-5.7 5.7"/><path d="M15 7h6v6"/>
							</svg>
						</button>
					</div>
				</div>
			
  
			<!-- End:  A: 主体内容 content -->  
			</div>
			<!-- End:  A: 滚动框架 scroll --> 
			</div>

			<!-- dialog-bottom -->
			<div class="dialog-bottom">
			</div>
		
	  	<!-- End:  A: dialog -->  
		</div>
	
		<!-- dialog-mask -->
		<div class="dialog-mask" @click="isShowDialog_Settings = false">
		</div>
	
	<!-- End:  dialog-wrapper A: 设置 Settings -->  
	</div>
 
 
 
	<!-- dialog-wrapper B: 提示词 Prompt Generator -->  
	<div id="dialog-promptgenerator" class="dialog-wrapper" v-show="isShowDialog_PromptGenerator">
		<!-- B: dialog -->  
		<div class="dialog" style="max-width: 95%;">
			<!-- B: 标题 header -->  
			<div class="dialog-header">
				<div class="dialog-title" >
					<svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0.6" stroke-linecap="round" stroke-linejoin="round">
						<path d="M19.7,23.5H4.3c-2.1,0-3.8-1.7-3.8-3.8V4.3c0-2.1,1.7-3.8,3.8-3.8h15.3c2.1,0,3.8,1.7,3.8,3.8v15.3    C23.5,21.8,21.8,23.5,19.7,23.5z M4.3,1.5c-1.6,0-2.8,1.3-2.8,2.8v15.3c0,1.6,1.3,2.8,2.8,2.8h15.3c1.6,0,2.8-1.3,2.8-2.8V4.3    c0-1.6-1.3-2.8-2.8-2.8H4.3z"/>
						<path d="M10.4,19.2H7.3c-0.3,0-0.5-0.2-0.5-0.5V5.3c0-0.3,0.2-0.5,0.5-0.5h9.3c0.3,0,0.5,0.2,0.5,0.5v8.5c0,0.3-0.2,0.5-0.5,0.5    h-5.7v4.4C10.9,19,10.7,19.2,10.4,19.2z M7.8,18.2h2.1v-4.4c0-0.3,0.2-0.5,0.5-0.5h5.7V5.8H7.8V18.2z M13.6,11.2h-3.2    c-0.3,0-0.5-0.2-0.5-0.5V8.4c0-0.3,0.2-0.5,0.5-0.5h3.2c0.3,0,0.5,0.2,0.5,0.5v2.3C14.1,11,13.9,11.2,13.6,11.2z M10.9,10.2h2.2    V8.9h-2.2V10.2z"/>
					</svg>
					{{ settingsLanguage == 'cn' ? '&nbsp;提示词&nbsp;' : '&nbsp;Prompt Generator&nbsp;' }}
					<button @click="changePromptGeneratorLayout"  class="btn bluebtn" style="width: 23px; padding: 0px 1px; height: 20px;" >
						<div>
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
						</div>
					</button>	
				</div>
				<div class="dialog-close" @click="isShowDialog_PromptGenerator = false">
					<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="fill: none; stroke: #333; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;">
						<path d="M6 18L18 6M6 6l12 12"></path>
					</svg>
				</div>
			</div>
			
	  		<!-- B: 滚动框架 scroll -->
			<div class="dialog-scroll">
			<!-- B: 主体内容 content -->  
			<div class="dialog-content" :style="styleDialogLayout">
		
				<!-- panelgroup: 当前系统提示词  Current System Prompt --> 
				<div class="panelgroup">
					<div class="panelgroup-head">
						<span>{{ settingsLanguage == 'cn' ? '当前系统提示词 ( system prompt )' : 'Current System Prompt' }} </span>
						<button  @click="showMiniHelp('B-CurrentSystemPrompt')"  class="btn minibtn bluebtn btnzoom-b" style="margin-right: 4px;">?</button>
						<span style="color:#f94000; display:block; margin-right: auto;font-size: 12px;">{{ settingsLanguage == 'cn' ? '对话ID: #' + ( this.chatid == null ? '' : (this.chatid.toString().length > 20 ? (this.chatid.toString().slice(0, 20) + " ...") : this.chatid.toString().slice(0, 20))  ) : 'Chat ID: #' + ( this.chatid == null ? '' : (this.chatid.toString().length > 20 ? (this.chatid.toString().slice(0, 20) + " ...") : this.chatid.toString().slice(0, 20))  ) }}</span>
					</div>
				
					<div class="panelrow" style="align-items: end; height:auto;flex-wrap: wrap;">
						<!-- 复制到编辑区 --> 
						<button @click="copySystemPromptToEditor" class="btn" style="margin-left: 5px;">
							{{ settingsLanguage == 'cn' ? '复制到编辑框' : 'Copy To Editor' }}
						</button>	
						<!-- 展开 -->
						<button @click="changeElementHeight('textareaSPReadOnly')" class="btn bluebtn" style="width: 25px;padding: 0px 2px;">
							<svg xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10">
								<path d="m28,30l-24,0c-1.1,0 -2,-0.9 -2,-2l0,-24c0,-1.1 0.9,-2 2,-2l24,0c1.1,0 2,0.9 2,2l0,24c0,1.1 -0.9,2 -2,2z" id="svg_1"></path>
								<line id="svg_2" x1="20" x2="20" y1="2" y2="30"></line><polyline points="27,24 25,26 23,24 "></polyline><polyline points="23,8 25,6 27,8 "></polyline><line x1="6" x2="16" y1="9" y2="9"></line><line x1="6" x2="12" y1="13" y2="13"></line><line x1="6" x2="12" y1="17" y2="17"></line>
							</svg>
						</button>
						<!-- 换行视图 -->
						<button @click="changeElementLineBreak('textareaSPReadOnly')" class="btn bluebtn" style="margin-right: auto;width: 25px;padding: 0px 2px;">
							<svg xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10">
								<path d="m2,28l0,-24c0,-1.1 0.9,-2 2,-2l24,0c1.1,0 2,0.9 2,2l0,24c0,1.1 -0.9,2 -2,2l-24,0c-1.1,0 -2,-0.9 -2,-2z" id="svg_1"/></path>
								<line x1="30" x2="2" y1="20" y2="20"/></line><polyline points="8,27 6,25 8,23 "/></polyline><polyline points="24,23 26,25 24,27 "/></polyline><line x1="6" x2="16" y1="9" y2="9"/></line><line x1="6" x2="12" y1="13" y2="13"/></line>
							</svg>
						</button>	
						<!-- 一键复制api-key  Cpoy api-key --> 
						<button class="copybtn" data-clipboard-nextelementsibling="" style="opacity: 1;position: relative;flex-shrink: 0;top: auto;right: auto;margin:0 5px 0 0 ;">
							<div>
								<svg width="14" height="17" class="clippy" fill="currentColor">
									<path d="m2.36373,12.61912l4.12233,0l0,1.03058l-4.12233,0l0,-1.03058zm5.15291,-6.18349l-5.15291,0l0,1.03058l5.15291,0l0,-1.03058zm2.06116,3.09174l0,-2.06116l-3.09174,3.09174l3.09174,3.09174l0,-2.06116l5.15291,0l0,-2.06116l-5.15291,0zm-4.63761,-1.03058l-2.57645,0l0,1.03058l2.57645,0l0,-1.03058zm-2.57645,3.09174l2.57645,0l0,-1.03058l-2.57645,0l0,1.03058zm9.27523,1.03058l1.03058,0l0,2.06116c-0.0161,0.28985 -0.11272,0.53139 -0.30595,0.72463s-0.43478,0.28985 -0.72463,0.30595l-10.30581,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058l0,-11.33639c0,-0.5636 0.46698,-1.03058 1.03058,-1.03058l3.09175,0c0,-1.1433 0.91786,-2.06116 2.06116,-2.06116s2.06116,0.91786 2.06116,2.06116l3.09174,0c0.5636,0 1.03058,0.46698 1.03058,1.03058l0,5.15291l-1.03058,0l0,-3.09174l-10.30581,0l0,9.27523l10.30581,0l0,-2.06116zm-9.27523,-8.24465l8.24465,0c0,-0.5636 -0.46698,-1.03058 -1.03058,-1.03058l-1.03058,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058s-0.46698,-1.03058 -1.03058,-1.03058s-1.03058,0.46698 -1.03058,1.03058s-0.46698,1.03058 -1.03058,1.03058l-1.03058,0c-0.5636,0 -1.03058,0.46698 -1.03058,1.03058z">
									</path>
								</svg>
							</div>
						</button> 
				 
						<!-- 输入框(只读) - 当前系统提示词 --> 
						<textarea readonly v-model="gptSystemPromptReadOnly"  type="text"  class="dh-input textareaSPReadOnly" style="flex: 0 0 100%;margin: 4px 0 0 0;height:100px;min-height:80px;max-height: 1000px;" placeholder=""></textarea>		
					</div>
				</div>			
			
				<!-- panelgroup: 提示词编辑区  Edit Prompts -->
				<div class="panelgroup">
					<div class="panelgroup-head">
						<span>{{ settingsLanguage == 'cn' ? '提示词编辑区' : 'Prompt Editor' }}</span>
						<button  @click="showMiniHelp('B-PromptEditor')"  class="btn minibtn bluebtn btnzoom-b" style="margin-right: auto;">?</button>
					</div>
				
					<div class="panelrow" style="align-items: end; height:auto;flex-wrap: wrap;">
						<!-- 保存为系统提示词 更新系统提示词 --> 
						<button @click="setSystemPrompt" :disabled="btnDisabledState_SetSystemPrompt" class="btn" style="margin-left: 5px;"  >
							{{ settingsLanguage == 'cn' ? '保存为系统提示词' : 'Save as System Prompt' }}
						</button>
					
						<!-- 展开 --> 
						<button @click="changeElementHeight('textareasystemprompt')" class="btn bluebtn" style="width: 25px;padding: 0px 2px;">
							<svg xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10">
								<path d="m28,30l-24,0c-1.1,0 -2,-0.9 -2,-2l0,-24c0,-1.1 0.9,-2 2,-2l24,0c1.1,0 2,0.9 2,2l0,24c0,1.1 -0.9,2 -2,2z" id="svg_1"></path>
								<line id="svg_2" x1="20" x2="20" y1="2" y2="30"></line><polyline points="27,24 25,26 23,24 "></polyline><polyline points="23,8 25,6 27,8 "></polyline><line x1="6" x2="16" y1="9" y2="9"></line><line x1="6" x2="12" y1="13" y2="13"></line><line x1="6" x2="12" y1="17" y2="17"></line>
							</svg>
						</button>
						<!-- 换行视图 --> 
						<button @click="changeElementLineBreak('textareasystemprompt')" class="btn bluebtn" style="margin-right: auto;width: 25px;padding: 0px 2px;">
							<svg xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10">
								<path d="m2,28l0,-24c0,-1.1 0.9,-2 2,-2l24,0c1.1,0 2,0.9 2,2l0,24c0,1.1 -0.9,2 -2,2l-24,0c-1.1,0 -2,-0.9 -2,-2z" id="svg_1"/></path>
								<line x1="30" x2="2" y1="20" y2="20"/></line><polyline points="8,27 6,25 8,23 "/></polyline><polyline points="24,23 26,25 24,27 "/></polyline><line x1="6" x2="16" y1="9" y2="9"/></line><line x1="6" x2="12" y1="13" y2="13"/></line>
							</svg>
						</button>	
						<!-- 一键复制api-key  Cpoy api-key --> 
						<button class="copybtn" data-clipboard-nextelementsibling="" style="opacity: 1;position: relative;flex-shrink: 0;top: auto;right: auto;margin:0 5px 0 0 ;">
							<div>
								<svg width="14" height="17" class="clippy" fill="currentColor">
									<path d="m2.36373,12.61912l4.12233,0l0,1.03058l-4.12233,0l0,-1.03058zm5.15291,-6.18349l-5.15291,0l0,1.03058l5.15291,0l0,-1.03058zm2.06116,3.09174l0,-2.06116l-3.09174,3.09174l3.09174,3.09174l0,-2.06116l5.15291,0l0,-2.06116l-5.15291,0zm-4.63761,-1.03058l-2.57645,0l0,1.03058l2.57645,0l0,-1.03058zm-2.57645,3.09174l2.57645,0l0,-1.03058l-2.57645,0l0,1.03058zm9.27523,1.03058l1.03058,0l0,2.06116c-0.0161,0.28985 -0.11272,0.53139 -0.30595,0.72463s-0.43478,0.28985 -0.72463,0.30595l-10.30581,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058l0,-11.33639c0,-0.5636 0.46698,-1.03058 1.03058,-1.03058l3.09175,0c0,-1.1433 0.91786,-2.06116 2.06116,-2.06116s2.06116,0.91786 2.06116,2.06116l3.09174,0c0.5636,0 1.03058,0.46698 1.03058,1.03058l0,5.15291l-1.03058,0l0,-3.09174l-10.30581,0l0,9.27523l10.30581,0l0,-2.06116zm-9.27523,-8.24465l8.24465,0c0,-0.5636 -0.46698,-1.03058 -1.03058,-1.03058l-1.03058,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058s-0.46698,-1.03058 -1.03058,-1.03058s-1.03058,0.46698 -1.03058,1.03058s-0.46698,1.03058 -1.03058,1.03058l-1.03058,0c-0.5636,0 -1.03058,0.46698 -1.03058,1.03058z">
									</path>
								</svg>
							</div>
						</button>
					
						<!-- 输入框 - 编辑提示词 --> 
						<textarea @input="btnDisabledState_SetSystemPrompt=false;" v-model="gptSystemPrompt"  type="text"  class="dh-input textareasystemprompt" style="flex: 0 0 100%;margin: 4px 0 0 0;height:100px;min-height:80px;max-height: 1000px;" :placeholder=" settingsLanguage == 'cn' ? '输入提示词，保存后生效。如需取消系统提示词，请清空输入框后点保存。' : 'Input prompt: Changes will take effect after saving. To cancel system prompt, clear the input field and save.' " ></textarea>		
					</div>
				</div>
 
 
	
			<!-- End:  B: 主体内容 content -->  
			</div>
			<!-- End:  B: 滚动框架 scroll --> 
			</div>
			
			<!-- dialog-bottom -->
			<div class="dialog-bottom">
			</div>
			
	  	<!-- End:  B: dialog -->  
		</div>
	
		<!-- dialog-mask -->
		<div class="dialog-mask" @click="isShowDialog_PromptGenerator = false">
		</div>
	
	<!-- End:  dialog-wrapper B: 设置 Settings -->  
	</div>



	<!-- dialog-wrapper C: 对话列表 Chat List -->  
	<div id="dialog-ChatList" class="dialog-wrapper" v-show="isShowDialog_ChatList">
		<!-- C: dialog -->  
		<div class="dialog">
			<!-- C: 标题 header -->  
			<div class="dialog-header">
				<div class="dialog-title" >
					<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
					</svg>
					{{ settingsLanguage == 'cn' ? '&nbsp;对话列表&nbsp;' : '&nbsp;Chat List&nbsp;' }}
					<button @click="showMiniHelp('C-ChatList')"  class="btn minibtn bluebtn btnzoom-b">?</button>	
					<button @click="chatList_addNewChatData(false)" class="btn" style="width: auto; padding: 0px 8px; height: 20px; line-height: 20px; border-radius: 5px; font-size: 13px; margin-left: 8px;">
						<div>
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h18v18H3zM12 8v8m-4-4h8"/>
							</svg>
						</div>
						{{ settingsLanguage == 'cn' ? '&nbsp;开始新的对话&nbsp;' : '&nbsp;Start a new chat' }}	
					</button>
				</div>
				<div class="dialog-close" @click="isShowDialog_ChatList = false">
					<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="fill: none; stroke: #333; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;">
						<path d="M6 18L18 6M6 6l12 12"></path>
					</svg>
				</div>
			</div>

			<!-- C: 滚动框架 scroll -->
			<div class="dialog-scroll">
			<!-- C: 主体内容 content -->  
			<div class="dialog-content">
		
				<!-- panelgroup: 单个对话 Chat Data --> 
				<div class="panelgroup" v-for="chatdata in chatDataList" :key="chatdata.chatcreatedtime" @click="chatList_ClickChatData(chatdata)" :class="{'panelgroup-chatdata-selected': chatdata.chatcreatedtime === selectedChatData.chatcreatedtime }">
					<div class="panelgroup-head">
						<!--  对话创建时间 Chat Creation Time -->
						<span style="margin-right: auto;color: #444444;">{{ (settingsLanguage == 'cn' ? '对话创建时间: ' : 'Chat Creation Time: ') +  (chatdata.chatcreatedtime === null ? (settingsLanguage == 'cn' ? '新对话' : 'New Chat') : chatdata.chatcreatedtime) }}</span>
						<!--  goto Top -->
						<button @click="gotoTop" class="btn minibtn btnzoom-c" :style="{ display:  (chatdata.chatcreatedtime === null || chatdata.chatcreatedtime !== selectedChatData.chatcreatedtime)  ? 'none' : 'flex'}"  style="width: 18px; height: 16px; padding: 0px; border-radius: 4px;">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 11l-5-5-5 5M17 18l-5-5-5 5"/>
							</svg>
						</button>
						<!--  goto Bottom  -->
						<button @click="gotoBottom" class="btn minibtn btnzoom-c" :style="{ display:  (chatdata.chatcreatedtime === null || chatdata.chatcreatedtime !== selectedChatData.chatcreatedtime)  ? 'none' : 'flex'}" style="width: 18px; height: 16px; padding: 0px; border-radius: 4px;margin-left: 1px;">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 13l5 5 5-5M7 6l5 5 5-5"/>
							</svg>
						</button>
						<!--  更多选项 More Options -->
						<select @change="changeSelectedChatListMoreOptions(chatdata)" class="dropdown minibtn minibtn-default btnzoom-c" v-model="selectedChatListMoreOptions" :style="{ display: chatdata.chatcreatedtime === null  ? 'none' : 'block' }" style="width:31px;">
								<option value="">•••</option>
								<option v-if="settingsLanguage == 'cn'" v-for="option in selectedChatListMoreOptions_Options_cn" :value="option.op">{{ option.label }}</option>
								<option v-else v-for="option in selectedChatListMoreOptions_Options_en" :value="option.op">{{ option.label }}</option>
						</select>
						<!--  删除 delete -->
						<button @click="deleteChatData(chatdata)" class="btn minibtn redbtn btnzoom-c" style="display: flex; width: 16px; height: 16px; padding: 0px; border-radius: 4px;">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
							</svg>
						</button>
					</div>
				
					<div class="panelrow" style="align-items: end; height:auto;flex-wrap: wrap;">
						<!-- ID *可修改 -->
						<button @click="chatList_EditChatID(chatdata)" class="btn btnzoom-c" style="width: auto;padding: 0px 8px;border: 1px solid #DDD !important; background: linear-gradient(to bottom, #fcfcfc, #f0f0f0) !important; color: #1aad19 !important;">
							<div>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
								</svg>
							</div>
							<span style="color: #1aad19;font-size: 13px;">&nbsp;{{ chatdata.chatid }}</span>
						</button>
						<!-- 上次活动时间 Last Activity Time -->
						<button disabled class="btn" style="margin-right: auto;width: auto;padding: 0px 8px;cursor:auto;" :style="{ display: chatdata.chatcreatedtime === null  ? 'none' : 'flex'}">
							<div>
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
								</svg>
							</div>
							<span style="color: #444444;">&nbsp;{{ (settingsLanguage == 'cn' ? '上次活动时间: ' : 'Last Activity Time: ') + (chatdata.chatlasttime === null ? (settingsLanguage == 'cn' ? '新对话' : 'New Chat') : chatdata.chatlasttime) }}</span>
						</button>
					</div>		
							
					<div class="panelrow" style="align-items: end; height:auto;flex-wrap: wrap;">
						<!-- 标题 备注 描述 Title-->
						<button @click="chatList_EditChatTitle(chatdata)" class="btn btnzoom-c" style="width: auto;padding: 0px 8px;border: 1px solid #DDD !important; background: linear-gradient(to bottom, #fcfcfc, #f0f0f0) !important; color: #1aad19 !important;">
							<div>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path><polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon>
								</svg>
							</div>
							<span :style="{ color: chatdata.chattitle == ''  ? '#cccccc' : '#444444'}">&nbsp;{{ chatdata.chattitle == '' ? (settingsLanguage == 'cn' ? '尚未写描述' : 'No description yet.') : chatdata.chattitle }}</span>
						</button>
					</div>
				</div>
				
				
			<!-- End:  C: 主体内容 content -->  
			</div>
			<!-- End:  C: 滚动框架 scroll --> 
			</div>

			<!-- dialog-bottom -->
			<div class="dialog-bottom">
			</div>
			
	  	<!-- End:  C: dialog -->  
		</div>
	
		<!-- dialog-mask -->
		<div class="dialog-mask" @click="isShowDialog_ChatList = false">
		</div>
	
	<!-- End:  dialog-wrapper C: 对话列表 Chat List -->  
	</div>
 


	<!-- Notification Z: 消息通知 Notification -->
	<div v-show="isShowNotification" class="notification">
		<div class="notification-wrapper" :class="{'notification-center': isNotificationHasMask, 'notification-bottom': !isNotificationHasMask }">
			<!-- Z: 标题 header :Only center -->  
			<div :style="{ display: isNotificationHasMask ? 'block' : 'none' }" style="position: relative;height: 30px;padding: 2px 16px;border-top-left-radius:10px;border-top-right-radius:10px;">
				<div class="dialog-title" style="color: #664909;font-weight:600;">
					{{setNotificationTitle}}
				</div>
				<div class="dialog-close" @click="hideNotification" style="color: #664909;width: 18px;height: 18px;">
					<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="fill: none; stroke: #333; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;">
						<path d="M6 18L18 6M6 6l12 12"></path>
					</svg>
				</div>
			</div>
		
			<!-- Z: 滚动框架 scroll -->
			<div class="dialog-scroll" :style="{ height: isNotificationHasMask ? 'calc(100% - 49.5px)' : 'auto', overflowX: isNotificationHasMask ? 'auto' : 'hidden', overflowY: isNotificationHasMask ? 'scroll' : 'hidden' }" >
			<!-- Z: 内容 content-->
			<div class="notification-content" :class="{'notification-content-center': isNotificationHasMask, 'notification-content-bottom': !isNotificationHasMask }">
				<!-- Z: 复制按钮 Copy btn -->  
				<button class="copybtn btncopynotification" :style="{ display: isNotificationHasMask ? 'block' : 'none' }" data-clipboard-nextelementsibling="" style="opacity: 1; position: fixed; flex-shrink: 0; top: 7px; right: 40px; width: 25px; height: 25px;color: #664909; border: 1px solid #cfd450; background-color: #e5e881; background-image: linear-gradient(#fdffb4, #e5e881);">
					<div>
						<svg width="14" height="17" class="clippy" fill="currentColor">
							<path d="m2.36373,12.61912l4.12233,0l0,1.03058l-4.12233,0l0,-1.03058zm5.15291,-6.18349l-5.15291,0l0,1.03058l5.15291,0l0,-1.03058zm2.06116,3.09174l0,-2.06116l-3.09174,3.09174l3.09174,3.09174l0,-2.06116l5.15291,0l0,-2.06116l-5.15291,0zm-4.63761,-1.03058l-2.57645,0l0,1.03058l2.57645,0l0,-1.03058zm-2.57645,3.09174l2.57645,0l0,-1.03058l-2.57645,0l0,1.03058zm9.27523,1.03058l1.03058,0l0,2.06116c-0.0161,0.28985 -0.11272,0.53139 -0.30595,0.72463s-0.43478,0.28985 -0.72463,0.30595l-10.30581,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058l0,-11.33639c0,-0.5636 0.46698,-1.03058 1.03058,-1.03058l3.09175,0c0,-1.1433 0.91786,-2.06116 2.06116,-2.06116s2.06116,0.91786 2.06116,2.06116l3.09174,0c0.5636,0 1.03058,0.46698 1.03058,1.03058l0,5.15291l-1.03058,0l0,-3.09174l-10.30581,0l0,9.27523l10.30581,0l0,-2.06116zm-9.27523,-8.24465l8.24465,0c0,-0.5636 -0.46698,-1.03058 -1.03058,-1.03058l-1.03058,0c-0.5636,0 -1.03058,-0.46698 -1.03058,-1.03058s-0.46698,-1.03058 -1.03058,-1.03058s-1.03058,0.46698 -1.03058,1.03058s-0.46698,1.03058 -1.03058,1.03058l-1.03058,0c-0.5636,0 -1.03058,0.46698 -1.03058,1.03058z">
							</path>
						</svg>
					</div>
				</button> 
		
				<!-- Z: 消息内容 提示框内容 Message -->  
				<span>{{setNotificationContent}}</span>
			
				<!-- Z: 小按钮 关闭  :Only bottom -->
				<div @click="hideNotification" :style="{ display: !isNotificationHasMask && isNotificationBottomShowCloseBtn ? 'block' : 'none' } " style="cursor: pointer; margin-left: 5px;margin-right: -3px; font-size: 12px;">×</div>
			</div>
			<!-- End:  Z: 滚动框架 scroll --> 
			</div>

			<!-- dialog-bottom -->
			<div class="dialog-bottom" :style="{ display: isNotificationHasMask ? 'block' : 'none' }">
			</div>
			
		</div>
  	
		<!-- Z: 遮罩 Mash :Only center -->  
		<div class="notification-mask" v-show="isNotificationHasMask" @click="hideNotification" ></div>
	<!-- End:  Notification Z: 消息通知 Notification --> 
	</div>


<!-- End:  #app -->  
</div>


<script>
	//Vue备选CDN(线路3) 再次检测，确保vue的正确加载。
	!window.Vue && document.write(unescape('%3Cscript src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"%3E%3C/script%3E') );
  
  	//*当用户使用过时的旧版本浏览器访问时，会出现不支持的情况（不支持新的js代码/不支持新版vue.js） When accessing with an old version of browser, it may not be supported (not supporting ES6 |  not supporting new version of Vue.js).
	//定时器：10秒后添加按钮  Add button after 10 seconds.
	var timermask = setTimeout(function() {
		var loadingMask = document.getElementById("loading-mask");
		if (loadingMask) {
			var maskfirstChild = loadingMask.firstChild;
			if (maskfirstChild) {
				loadingMask.removeChild(maskfirstChild);
			}
			var maskbutton = document.createElement("button");
			maskbutton.innerHTML = "页面加载时间较长，您可以尝试刷新页面或检查网络连接是否畅通。<br>[点击我]点击文本可以隐藏遮罩，查看网页。若出现布局错误或乱码，可能是因为浏览器或设备版本过旧，请尝试使用更新的浏览器版本。<br>Page loading is slow. Please refresh the page or check your internet connection.<br>Click [here] to hide the mask and view the webpage. If the layout is incorrect or displays gibberish, try using a newer browser version or device.";
			maskbutton.onclick = displaymaskbtn; 
			loadingMask.appendChild(maskbutton); 
		}
		clearTimeout(timermask);
	}, 10000);
	// 隐藏遮罩
	function displaymaskbtn() {
		var loadingMask = document.getElementById("loading-mask");
		if (loadingMask) {
			loadingMask.classList.add('dialog-wrapper-hide');
		}
	}
</script>

<script>
//一键复制按钮的提示框 Tooltips for Copy Button. by clipboardjs  https://clipboardjs.com/assets/scripts/tooltips.js
//这段js放前面：网页加载过快会导致添加监听事件失败。This JS code should be placed at the beginning: If the webpage loads too quickly, listener events may fail to be added.

	//当前语言 Current Language。 全局变量。 Global variable.
	window.currentlang = 'cn';
	
	function addEventListenerCopyBtnTooltip(btn) {
		btn.addEventListener('mouseleave', clearCopyBtnTooltip);
		btn.addEventListener('blur', clearCopyBtnTooltip);
	}
	function clearCopyBtnTooltip(e) {
		e.currentTarget.setAttribute('class', 'copybtn');
		e.currentTarget.removeAttribute('aria-label'); 
	}
	//提示框方向的样式 directionClass: https://primer.style/css/components/tooltips
	function showCopyBtnTooltip(elem, msg, directionClass) {
		elem.setAttribute('class', 'copybtn tooltipped ' + directionClass); 
		elem.setAttribute('aria-label', msg); 
	}
	function fallbackCopyBtnMessage(action) {
		let actionMsg = '';
		actionMsg = window.currentlang == 'cn' ? '无数据 ' : 'No data' ; //去除“不支持” Delete “No support”
		//actionMsg = window.currentlang == 'cn' ? '无数据 / 不支持' : 'No data / No support' ; 
		return actionMsg;
	}
</script>

<script>
	if(!window.Vue){ alert("错误：\r\nVue.js加载失败，将无法使用GPT！请检查网络后刷新页面。\r\n\r\nError:\r\nFailed to load plugin Vue.js. The GPT will be unavailable. Please check your network and refresh the page to try again.") };
	
	const { createApp } = Vue;
	createApp({
		data() {
			return {
			
				api: '',  //v7.05 开始，支持浏览器本地存储，不建议将api key写在代码中。 Starting from v7.05, local storage is supported in the browser. It is not recommended to write the API key in the code.
				//可修改 Editable - 单引号内可以留空，或填入默认的API-Key。  You can leave it blank or enter the default API key.
				//!!Reminder: If your project is hosted on GitHub, do not enter the plaintext OpenAI API key here! GitHub will trigger OpenAI to automatically invalidate the API key and generate a new one.
				//api修改提醒：html文件若要上传到GitHub，这里不能填api-key的明文！api-key会自动失效。原因如下：
				//     虚拟主机/服务器/Gitee等都可以填入api-key明文，只有GitHub不行，猜测原因是：GitHub被微软收购，微软亦是OpenAI的大股东，GitHub一旦检测到代码里有GPT的api-key，会联动OpenAI的后台取消这个key，并生成新key 。
				//api修改请注意：HTML代码没有加密。如果只是下载到电脑本地使用，那这里填写的API-Key不存在泄露风险。如果要上传网页到虚拟主机/服务器/Gitee免费托管，未加密的代码存在有泄漏API-Key的风险。

				btnDisabledState_Sending: true,
				btnDisabledState_CheckAPI: false,				
				btnDisabledState_Clear: true,
				btnDisabledState_Undo: true,
				sentext: '先验证API', // Check API first
				apibtntext:  '<< 验证', // Check API key
				timerId: null, // *是否曾验证过apikey有借用此变量进行判断
				
				btnDisabledState_Export: true,
				//settingsContextualMode 也与chat data相关，写在后面
				hasSystemPromptBeenSaved: false,
				userMsgTokensForRetry: 0, //int 临时记录重问时的tokens数据
				succQA_Count: 0, //int 当前有效的上下文数量，一问一答succQA_Count = 2 。 数量变化对应this.msgContent
				totaltokens: 0, //int
				chathistory: '# GPT聊天记录 / Chat History  \r\n\r\n',
				//gptSystemPromptReadOnly 也与chat data相关，写在后面
								
				btnDisabledState_SaveApiURL: true,
				btnDisabledState_ApiURL: false,
				btnDisabledState_Language: false,
				btnDisabledState_ContextualMode: false,
				btnDisabledState_updateUserImageUrl: true,
				btnDisabledState_updateGPTImageUrl: true,
				isRetry_RetryMessage: '', //重问时传递重问的内容，避免使用this.msg
				isfirstclickonchatinputbox: true, //是否首次点击聊天输入框，防止重复激活点击事件
				isShowTotaltokensSVG : true, //Total Tokens 图标
				isShowTotaltokensLabel : true, //Total Tokens 文字
				isShowQACountLabel: true, //Q&A Count  文字
				isSendingNow: false, //是否正在发送消息
				isCheckingApiKeyNow:false, //是否正在验证api-key
				is_Alert_Confirm_Prompt_Open:false, //是否有原生弹窗弹出
				
				
				
				//提示词窗口 Prompt Generator
				isShowDialog_PromptGenerator: false, //是否显示提示词窗口
				styleDialogLayout: { padding: '20px 20px 20px 20px' },
				
				gptSystemPromptReadOnly: '', //展示当前系统提示词(只读)
				btnDisabledState_SetSystemPrompt: false,
				gptPrompts: [{ 
					prompt: '',
					sort: -1,
					id: -1,	
					tag: '',	
					note: '',
					owner: 'me',
					other1: '',
					other2: ''
				}],
				
				
				
				//对话列表窗口 Chat List
				isShowDialog_ChatList: false,//是否显示对话列表窗口
				selectedChatListMoreOptions: '',
				selectedChatListMoreOptions_Options_cn: [
				  { label: '1) 导出/分享对话 (.json)', op: 'ExportChatData' },
				  { label: '2) 创建副本', op: 'CreateCopy' },
				  { label: '3) 清空记录（保留最近单轮记录）', op: 'ClearPrevious' },
				  { label: '4) 清空记录', op: 'ClearAll' }
				],
				selectedChatListMoreOptions_Options_en: [
				  { label: '1) Export & Share (.json)', op: 'ExportChatData' },
				  { label: '2) Creat a copy', op: 'CreateCopy' },
				  { label: '3) Clear the history (Keep the latest round)', op: 'ClearPrevious' },
				  { label: '4) Clear the history', op: 'ClearAll' }
				],



				//设置窗口 Settings
				isShowDialog_Settings: false, //是否显示设置窗口
				isShowProConfig:true, // 显示/隐藏 API专业设置 Show/Hide Professional API Settings			
				isSimpleMode: false,  //true=简约模式（默认模式），false=新用户模式。区别在于简约模式显示的"提示信息"会少些。 true=Simple Mode (Normal Mode), false=User Onboarding. The difference is that there will be more "help information" in User Onboarding.
				simpleModeOptions_cn: [
				  { label: '默认模式', state: true },
				  { label: '新用户模式', state: false }
				],
				simpleModeOptions_en: [
				  { label: 'Normal Mode', state: true },
				  { label: 'User Onboarding', state: false }
				],
				
				lastCheckApiTime: 0, // 记录上一次验证api-key的时间，4秒内只能发送一次验证请求
				//记录已验证的api-key、对应的接口url等，目前仅记录前3项，刷新网页后数据清空；未来可尝试：增加快捷切换'自有可用的key'的操作，与url搭配，实现不同组合随时切换；可增加共享key的功能，不会上传key，但可以通过链接追加网络key到本地数组里，owner=网络/共享。
				apiCheckedData: [{ 
					apikey: '',	
					apiurl: '',	
					date1: 0, //验证时间、上次时间
					date2: 0,
					date3: 0,
					level: 1,
					freq: 0,
					vpn: '',
					owner: 'me'
				}],
				
				apitemperature: 0.7, //（0.0～2.0）接口参数 temperature 默认0.7 (官方默认1.0) v-model.number
				apiMaxTokens:2048, //（1～4096）接口参数 max_tokens 默认2048 v-model.number (4095 4096 4097  gpt-3.5 gpt-4 gpt3.5 gpt4)
				apiTopP:1, // （0.0～1.0）接口参数 top_p 官方默认1 v-model.number
				apiPresencePenalty:0, //（-2.0～2.0）接口参数 presence_penalty 官方默认0 v-model.number
				apiFrequencyPenalty:0, //（-2.0～2.0）接口参数 frequency_penalty 官方默认0 v-model.number
				
				openSmartMaxTokens:true, // 智能max_tokens，通过估算调节。 Smart max_tokens
				smartMaxTokensOptions_cn: [
				  { label: '已启用 智能max_tokens', state: true },
				  { label: '已关闭 智能max_tokens', state: false }
				],
				smartMaxTokensOptions_en: [
				  { label: 'Smart max_tokens Enabled', state: true },
				  { label: 'Smart max_tokens Disabled', state: false }
				],
				isSendingNow_ForSmartMaxTokens: false, //是否正在发送消息 同isSendingNow。为了不改动isSendingNow的位置
				isFixingMaxTokens_SmartMaxTokens:false, //标记为“正在修复MaxTokens”时，本次不会执行修改max_tokens的动作
				isFirstRetry_SmartMaxTokens:true, //是否为首次自动重问
				
				apiGPTModel: 'gpt-3.5-turbo', // 接口参数 model 默认'gpt-3.5-turbo'
				gptModelOptions: [
				  { label: 'ChatGPT', model: 'gpt-3.5-turbo' },
				  { label: 'gpt-3.5-turbo-0301', model: 'gpt-3.5-turbo-0301' }
				],
				
				//仅支持/v1/chat/completions类型接口url。 接口与模型的关系 https://platform.openai.com/docs/models/model-endpoint-compatibility
				apiURL: 'https://api.openai.com/v1/chat/completions',  // 接口参数 接口网址 默认官方接口'https://api.openai.com/v1/chat/completions'
				inputApiURL: '',  //Input值
				selectedApiURL: '',  //selected值
				apiURLOptions_cn: [
				  { label: '官方  • GPT官方 需魔法 稳定 限制少', url: 'https://api.openai.com/v1/chat/completions' },
				  { label: '国内  • 第三方 免魔法 7月仍可用', url: 'https://api.openai-proxy.com/v1/chat/completions' }
				],
				apiURLOptions_en: [
				  { label: 'GPT  • OpenAI API. Official.', url: 'https://api.openai.com/v1/chat/completions' },
				  { label: '国内  • Third-party APIs. 免魔法 7月仍可用', url: 'https://api.openai-proxy.com/v1/chat/completions' }
				],
				
				//**常规设置第一排
				//语言设置 
				settingsLanguage: 'cn', //简体中文cn 英文en。 Chinese-Simplified = cn  English = en
				settingsLanguageOptions: [
					{ label: '中文', lang: 'cn' },
					{ label: 'English', lang: 'en' }
				],
				//字体大小设置 默认14px
				settingsFontSize: 14, //数字 数值型
				settingsFontSizeOptions: [
					{ label: '9', fontsize: 9 },
					{ label: '10', fontsize: 10 },
					{ label: '11', fontsize: 11 },
					{ label: '12', fontsize: 12 },
					{ label: '13', fontsize: 13 },
					{ label: '14', fontsize: 14 },
					{ label: '15', fontsize: 15 },
					{ label: '16', fontsize: 16 },
					{ label: '17', fontsize: 17 },
					{ label: '18', fontsize: 18 },
					{ label: '19', fontsize: 19 },
					{ label: '20', fontsize: 20 },
					{ label: '21', fontsize: 21 },
					{ label: '22', fontsize: 22 },
					{ label: '23', fontsize: 23 },
					{ label: '24', fontsize: 24 },
					{ label: '25', fontsize: 25 },
					{ label: '26', fontsize: 26 },
					{ label: '27', fontsize: 27 },
					{ label: '28', fontsize: 28 },
					{ label: '29', fontsize: 29 }
				],
				//是否显示时间(微信样式) 默认显示
				settingsTime_WechatStyle: true,
				settingsTimeWechatStyleOptions_cn: [
					{ label: '显示', displaytime: true },
					{ label: '不显示', displaytime: false }
				],
				settingsTimeWechatStyleOptions_en: [
					{ label: 'Show', displaytime: true },
					{ label: 'Hide', displaytime: false }
				],
				//是否显示时间(消息) 默认不显示
				settingsTime_Message: 1, // 数字，数值型 代表三种状态 state.  1:hide ; 2:show height:0 ; 3:show height:+10
				settingsTimeMessageOptions_cn: [
					{ label: '不显示', displaytime: 1 },
					{ label: '显示', displaytime: 2 },
					{ label: '显示(增大间距)', displaytime: 3 }
				],
				settingsTimeMessageOptions_en: [
					{ label: 'Hide', displaytime: 1 },
					{ label: 'Show', displaytime: 2 },
					{ label: 'Show(Increase Spacing)', displaytime: 3 }
				],
				//是否显示分割线 默认显示
				settingsDividerLine: true, 
				settingsDividerLineOptions_cn: [
					{ label: '显示', displaydividerline: true },
					{ label: '不显示', displaydividerline: false }
				],
				settingsDividerLineOptions_en: [
					{ label: 'Show', displaydividerline: true },
					{ label: 'Hide', displaydividerline: false }
				],
				
				//**常规设置第二排 
				//上下文模式 默认连续对话  待开发  目前只有：不限制  1. 0-不限制 ；2. 固定次数后自动清空 ； 3. 永远保留最后几条的记录
				settingsContextualMode: 0, // 数字，数值型 0代表连续对话，其他代表固定次数后会自动清空记忆，即 1 = 1*Q&A ; 2 = 2*Q&A *考虑如果只是次数到了自动清空，这个意义不是很大。最好是永远保留最后几次的上下文，这样的设置会更实用，能结合压缩上下文就更好了。这个功能待开发。。。
				settingsContextualModeOptions_cn: [
					{ label: '不限制', mode: 0 }
				],
				settingsContextualModeOptions_en: [
					{ label: 'No Limit', mode: 0 }
				],
				
				//是否开启验证API-KEY的快捷键 （电脑端使用） 默认开启
				settingsShortcut_CheckApiKey: true, 
				settingsShortcutCheckApiKeyOptions_cn: [
					{ label: 'F2', shortcut: true },
					{ label: '无', shortcut: false }
				],
				settingsShortcutCheckApiKeyOptions_en: [
					{ label: 'F2', shortcut: true },
					{ label: 'None', shortcut: false }
				],
				
				//是否开启 清空 的快捷键 （电脑端使用） 默认关闭
				settingsShortcut_Clear: false, 
				settingsShortcutClearOptions_cn: [
					{ label: 'F1', shortcut: true },
					{ label: '无', shortcut: false }
				],
				settingsShortcutClearOptions_en: [
					{ label: 'F1', shortcut: true },
					{ label: 'None', shortcut: false }
				],
				
				//是否开启 撤销 的快捷键 （电脑端使用） 默认关闭
				settingsShortcut_Undo: false, 
				settingsShortcutUndoOptions_cn: [
					{ label: 'F3', shortcut: true },
					{ label: '无', shortcut: false }
				],
				settingsShortcutUndoOptions_en: [
					{ label: 'F3', shortcut: true },
					{ label: 'None', shortcut: false }
				],
				
				//是否开启 重问 的快捷键 （电脑端使用） 默认开启
				settingsShortcut_Retry: true, 
				settingsShortcutRetryOptions_cn: [
					{ label: 'F4', shortcut: true },
					{ label: '无', shortcut: false }
				],
				settingsShortcutRetryOptions_en: [
					{ label: 'F4', shortcut: true },
					{ label: 'None', shortcut: false }
				],
				
				//**常规设置 头像  “Change-GPT-Green-SVG”是固定的，调用SVG的标识符。
				userAvatarURL: 'https://lin2025.github.io/img/me-bili.jpg',  // *可修改 Editable. 默认的用户头像 Default User Avatar. 
				inputUserImageUrl: 'https://lin2025.github.io/img/me-bili.jpg', // *可修改 Editable. 默认用户头像的url地址，和上面的"userAvatarURL"保持一致。这个是出现在编辑框的文本内容。 Will display in the input. ("inputUserImageUrl" & "userAvatarURL") Two URLs are consistent.
				gptAvatarURL: '',   // 当前GPT头像网址
				inputGPTImageUrl: '',  // GPT input文本
				selectedImageUrl: '',  // 预设头像库下拉框值
				userpresetImages: [
					{ name: '2) Bilibili', url: 'https://lin2025.github.io/img/me-bili.jpg' },
					{ name: '3) GPT:Black', url: 'https://openai.com/favicon.ico' } 
				],
				gptpresetImages: [
					{ name: '1) GPT:Green', url: 'Change-GPT-Green-SVG' },
					{ name: '2) GPT:Black', url: 'https://openai.com/favicon.ico' } //黑色头像没有将绿色SVG改色，而是选用官网的ico图标
				],
				isgptGreenSvgShow: true, //（显示<svg>的同时，隐藏<img>）或（隐藏<svg>时，显示<img>）。  (display<img> & hide<svg>) or (hide<img> & display<svg>)
				GPTGreenSVG_UrlText_cn: 'GPT-Green-SVG *无网址，仅通过[GPT头像]更新', // GPT绿色SVG头像对应的显示的文本 cn
				GPTGreenSVG_UrlText_en: 'GPT-Green-SVG *No URL, only updated through [GPT Avatar].', // GPT绿色SVG头像对应的显示的文本 en
				userAvatarUp_base64: '', //user - Upload avatar (<=350KB) base64
				userAvatarUp_blob: null, //user - Upload avatar (<=350KB) blob
				userAvatarUp_blobUrl: '', //user - Upload avatar (<=350KB) blob url	
				
				//**常规设置 本地缓存
				selectedDeleteLocalStorageData: '', 
				selectedDeleteLocalStorageDataOptions_cn: [
					{ label: '1) 一键删除所有数据', type: 'DeleteAllData' },
					{ label: '2) 删除所有[对话]数据', type: 'DeleteChatDataList' },
					{ label: '3) 删除所有[密钥 API-Key]数据', type: 'DeleteAPIKeyData' },
					{ label: '4) 删除所有[提示词]数据', type: 'DeletePromptsData' },
					{ label: '5) 删除[上传的用户头像]', type: 'DeleteUploadedUserAvatar' },
					{ label: '6) 删除所有[设置]数据', type: 'DeleteSettingsData' }
				],
				selectedDeleteLocalStorageDataOptions_en: [
					{ label: '1) Delete All Data with One Click', type: 'DeleteAllData' },
					{ label: '2) Delete All [Chat] Data', type: 'DeleteChatDataList' },
					{ label: '3) Delete All [API Key] Data', type: 'DeleteAPIKeyData' },
					{ label: '4) Delete All [Prompt Generator] Data', type: 'DeletePromptsData' },
					{ label: '5) Delete [Uploaded User Avatar]', type: 'DeleteUploadedUserAvatar' },
					{ label: '6) Delete All [Settings] Data', type: 'DeleteSettingsData' }
				],
				selectedExportLocalStorageData: '', 
				selectedExportLocalStorageDataOptions_cn: [
					{ label: '1) 一键导出所有数据', type: 'ExportAllData' },
					{ label: '2) 导出所有[对话]数据', type: 'ExportChatDataList' },
					{ label: '3) 导出所有[密钥 API-Key]数据', type: 'ExportAPIKeyData' },
					{ label: '4) 导出所有[提示词]数据', type: 'ExportPromptsData' },
					{ label: '5) 导出所有[设置]数据', type: 'ExportSettingsData' }
				],
				selectedExportLocalStorageDataOptions_en: [
					{ label: '1) Export All Data with One Click', type: 'ExportAllData' },
					{ label: '2) Export All [Chat] Data', type: 'ExportChatDataList' },
					{ label: '3) Export All [API Key] Data', type: 'ExportAPIKeyData' },
					{ label: '4) Export All [Prompt Generator] Data', type: 'ExportPromptsData' },
					{ label: '5) Export All [Settings] Data', type: 'ExportSettingsData' }
				],
				
				
				isLocalStorageSupported: true, //当前浏览器是否支持localStorage
				isLocalStorageAllowed: true, //是否允许使用本地存储。
				islocalStorageFirstLoad: true, //是否首次读取 用途：1) 首次读取时，需要重新生成头像的blob url
				localStorage_lastSaveTime : null,// 记录最近一次自动或手动备份操作发生时的时间戳（毫秒）
				localStorage_lastSaveTime_onblur : null,// 记录最近一次自动或手动备份操作发生时的时间戳（毫秒）*onblur 当前页面失去焦点的事件，触发频率较高
				chatcreatedtime: null, //对话的创建时间 *唯一值
				chatlasttime: null, //最后一次操作的时间
				chatid: null,  //ID *可重复
				chattitle: '', //标题
				chatDataList: [], //对话列表，包含所有对话和对话的所有记录。 由“chatdata”组合成的数组
				selectedChatData: {}, //当前被选中的chat data，主要用于html绑定列表+通过chatcreatedtime查找对比，其他数据非实时更新
				localStorageEvent_chatDataList_update_start: false,//事件状态
				
				//导出
				chatHistoryPromptOnlyUseBackticks: false , //导出的聊天记录中，系统提示词的markdown语法处理方式。 true:仅用"代码块"包裹  false:自动判断使用"引用"或者"代码块"包裹
				exportTXTFileName:"LinGPT_ChatHistory", //导出全部历史记录的文件名
				exportTXTFileName_SingleRound:"LinGPT_ChatHistory_SingleRound", //导出单轮历史记录的文件名
				exportJSONFileName:"LinGPT Data_",
				selectedExportChatHistory: '', 
				selectedExportChatHistoryOptions_cn: [
					{ label: '1) 导出聊天记录·单轮记忆 (.md)', type: 'ChatHistory_Single_MD' },
					{ label: '2) 导出聊天记录·单轮记忆 (.txt)', type: 'ChatHistory_Single_TXT' },
					{ label: '3) 导出聊天记录·全部 (.md)', type: 'ChatHistory_ALL_MD' },
					{ label: '4) 导出聊天记录·全部 (.txt)', type: 'ChatHistory_ALL_TXT' }
				],
				selectedExportChatHistoryOptions_en: [
					{ label: '1) Export Chat History for a Single Round (.md)', type: 'ChatHistory_Single_MD' },
					{ label: '2) Export Chat History for a Single Round (.txt)', type: 'ChatHistory_Single_TXT' },
					{ label: '3) Export All Chat History (.md)', type: 'ChatHistory_ALL_MD' },
					{ label: '4) Export All Chat History (.txt)', type: 'ChatHistory_ALL_TXT' }
				],
				
				
				//消息通知 tooltips弹窗 Notification tooltips
				isShowNotification: false, //是否显示通知 Show
				setNotificationContent: '', //通知的内容 Message
				isNotificationHasMask: false, //是否显示遮罩 Mask 
				isNotificationBottomShowCloseBtn: false,//bottom底部通知时，是否显示关闭按钮
				setNotificationPosition: 'center', //通知样式 center中心 or bottom底部
				setNotificationTitle: '', //标题文字  Title 通知 信息 警告 提醒 错误 ...
				notificationTimeoutId: 0, // 上一个通知的定时器id


							
				//可修改 Editable - 网页上的第一条信息/欢迎语，不属于上下文。 这条信息只会在网页中显示，不会回传给服务器，不属于聊天记录。 
				// 示范{ thefirstmessage: "hi~ ", }  提醒：1、不能换行，但可以使用换行符{ \r\n }； 2、支持Markdown语法。
				// The First Message, This message is out of context,
				// Example{ thefirstmessage: "hi~ ", }  Tips：1.No line breaks. You can use the line break characters{ \r\n }.  2.Supports Markdown.
				thefirstmessage: "### **LinGPT** ***v7.05*** \r\n##### **v7.05** 1.新增本地存储及数据管理功能; 2.新增多对话(点击头像)、自动保存、创建副本、数据同步、导出分享、导入还原对话等功能；2.修复Windows系统兼容性问题。\r\n###### 1.Added: local storage and data management. 2.Added: multiple chats (click avatar), auto-saving, copy creation, data synchronization, chat export and sharing, and chat import and restoration. 3.Bug fixes for Windows compatibility.\r\n\r\n_LinGPT - A GPT-3.5 Webpage with Just a Single HTML File_ \r\n###### _Change Language: [Settings] > [Language]_ \r\n```\r\nIf you like it, please give me a star on my GitHub repository.\r\n```\r\n[![](https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&logo=github&logoColor=white)](https://github.com/lin2025/gpt3.5/) [![](https://img.shields.io/badge/Gitee-C71D23?style=for-the-badge&logo=gitee&logoColor=white)](https://gitee.com/lin2025/gpt3.5/) " ,
				
				// v7.05 开始提示词不建议写在代码中。Starting from v7.05, it is advised not to write system prompts in the code. 
				// 系统提示词。不填的话，gptSystemPrompt后面单引号内留空{ gptSystemPrompt: '', }，填写后，会出现在“提示词编辑器中”，不会自动生效，需要手动保存后才会生效。
				// 下方这行设置gptSystemPrompt 是设置[默认的指令/提示词/人设]的第一种方法，指令写在单引号内。 如果默认指令写在这里，这个指令会显示在聊天界面的指令输入框中。 如果还设置有第二种隐形指令的话，以隐形指令为准，第一种会被忽略。
				// 保存到上下文数组msgContent中才能生效，不保存则不生效。
				// System Prompt(optional): Will be displayed in the "Prompt Editor". It needs to be saved before it takes effect.
				gptSystemPrompt: '', //v7.05 该变量是“提示词编辑器的内容”，不再是系统提示词。The variable is now "the content of the prompt editor" instead of the system prompt.
				
				//可修改 Editable - (一般不改，很少会用到隐形指令) 不填的话，单引号内留空，即： gptSystemPrompt_hidden: '',  
				// 下方这行设置gptSystemPrompt_hidden 是设置[默认的指令/提示词/人设]的第二种方法，指令写在单引号内。 第二种方法是[隐形指令/隐藏指令/隐形提示词/隐藏提示词]的写法。如果默认指令写在这里，这个指令不会显示在聊天界面的指令输入框中，指令是隐形的。 在本代码中搜索“隐形指令”可查看[添加 disabled 来禁止聊天界面上输入新指令]的方法。
				// 如果用第二种方法设置了[隐形指令]，那么GPT指令将以这里的[隐形指令]为准，会自动忽略聊天界面上的其他指令（包括空白的指令），不会叠加。
				// 设置隐形提示词后，提示词弹窗将被禁用，代码写在mounted()里
				// Hidden System Prompt, with the highest priority. Once set, the System Prompt will be based on the Hidden System Prompt, and the Prompt in the System Prompt input box will be invalid. 
				// If "gptSystemPrompt_hidden" is set, the Prompt Generator will be disabled. The judgment code is written in the mounted() method.
				gptSystemPrompt_hidden: '',
				
				

				//v-html 
				msgList: [{
					msg: "",   //默认空。这里不填内容！ Do not fill in!
					my: false,
					datetime: "2000-01-01 00:00:00", // 默认"2000-01-01 00:00:00"，用于判断，不要改
					wechatstyledatetime: null,
					hr: false
				}],
				
				//msgContent：上下文 context
				msgContent : [{role: "system", content: "" }] , 
				
				//msgTokens：对应msgContent记录每条消息的token数量 Synchronize updates with 'msgContent' and record tokens data for each message.  role: AI & user. 
				//completion_tokens：单条消息的tokens数量 Tokens for a single message.
				//total_tokens：截止当前消息的tokens总数 Current total tokens.
				//永远保留第一条记录[0]，对应msgContent[0]
				//role: AI & user. 
				msgTokens : [{role: "AI", completion_tokens: 0, total_tokens: 0 }] , //tokens:int
				
				msg: "", //输入的消息 message  聊天输入框 chat input box
				msgContentForMsgList_SingleRound : [{role: "system", content: "", datetime: "2000-01-01 00:00:00" }] , //（默认时间不要改） 与msgContent的不同点：1.会保留未撤销的发送失败的数据；2.数据与msgList的最后一轮对话对应；3.记录时间。 Differences from msgContent: 1. Failed messages that have not been undone will be retained; 2. Data corresponds to msgList (New Chat, Only single round); 3.Add datetime。
				

				
				//v1.7.05  User用户 Settings - 变量名单/变量列表/变量白名单/默认值。  Related to User - Variable list, variable whitelist, default value.
				//* 可修改 Editable.  默认的设置，默认参数，默认值。 Default settings, default parameters, default values.
				//* 一般不用修改，因为支持浏览器本地存储(localStorage)，直接在网页中修改即可，下次再打开时会加载上次的变量设置。
				//* Usually there is no need to modify it, as it supports browser local storage (localStorage), which can be directly modified in the [Settings] of the webpage.
				userVariables_default: {
					apitemperature: 0.7, //（0.0～2.0）接口参数 temperature 默认0.7 (官方默认1.0) v-model.number
					apiMaxTokens:2048, //（1～4096）接口参数 max_tokens 默认2048 v-model.number (4095 4096 4097  gpt-3.5 gpt-4 gpt3.5 gpt4)
					apiGPTModel: 'gpt-3.5-turbo', // 接口参数 model 默认'gpt-3.5-turbo'
					apiTopP:1, // （0.0～1.0）接口参数 top_p 官方默认1 v-model.number
					apiPresencePenalty:0, //（-2.0～2.0）接口参数 presence_penalty 官方默认0 v-model.number
					apiFrequencyPenalty:0, //（-2.0～2.0）接口参数 frequency_penalty 官方默认0 v-model.number
					apiURL: 'https://api.openai.com/v1/chat/completions',  // 接口参数 接口网址 默认官方接口'https://api.openai.com/v1/chat/completions'
					selectedApiURL: '',  //selected值
				
					settingsLanguage: 'cn', //默认语言 简体中文cn 英文en。 Default language. Chinese-Simplified = cn  English = en
					settingsFontSize: 14, //字体大小设置 默认14px 数字 数值型
					settingsTime_WechatStyle: true, //是否显示时间(微信样式) 默认显示
					settingsTime_Message: 1, //是否显示时间(消息) 默认不显示 数字，数值型 代表三种状态 state.  1:hide ; 2:show height:0 ; 3:show height:+10
					settingsDividerLine: true, //是否显示分割线 默认显示
					
					settingsShortcut_CheckApiKey: true, //是否开启验证API-KEY的快捷键 （电脑端使用） 默认开启
					settingsShortcut_Clear: false, //是否开启 清空 的快捷键 （电脑端使用） 默认关闭
					settingsShortcut_Undo: false, //是否开启 撤销 的快捷键 （电脑端使用） 默认关闭
					settingsShortcut_Retry: true, //是否开启 重问 的快捷键 （电脑端使用） 默认开启
					
					chatHistoryPromptOnlyUseBackticks: false , //导出的聊天记录中，系统提示词的markdown语法处理方式。 true:仅用"代码块"包裹  false:自动判断使用"引用"或者"代码块"包裹
					isShowProConfig:true, // 显示/隐藏 API专业设置 Show/Hide Professional API Settings
					isSimpleMode: false,  //true=简约模式（默认模式），false=新用户模式。区别在于简约模式显示的"提示信息"会少些。 true=Simple Mode (Normal Mode), false=User Onboarding. The difference is that there will be more "help information" in User Onboarding.
				},
				
				//v1.7.05  聊天相关 Chat Variables - 变量名单/变量列表/变量白名单/默认值。  Related to Chat Variables  - Variable list, variable whitelist, default value.
				// 不改动 Non-editable
				chatVariables_default: {
					btnDisabledState_Export: true,
					settingsContextualMode: 0, //上下文模式 默认连续对话  待开发。  数字，数值型 0代表连续对话，其他代表固定次数后会自动清空记忆，即 1 = 1*Q&A ; 2 = 2*Q&A *考虑如果只是次数到了自动清空，这个意义不是很大。最好是永远保留最后几次的上下文，这样的设置会更实用，能结合压缩上下文就更好了。这个功能待开发。。。
					hasSystemPromptBeenSaved: false,
					userMsgTokensForRetry: 0, //int 临时记录重问时的tokens数据
					succQA_Count: 0, //int 当前有效的上下文数量，一问一答succQA_Count = 2 。 数量变化对应this.msgContent
					totaltokens: 0, //int						
					chathistory: '# GPT聊天记录 / Chat History  \r\n\r\n',
					gptSystemPromptReadOnly: '',//仅展示
				},	
							
				//v1.7.05  聊天相关 Chat Data - 变量名单/变量列表/变量白名单/默认值。  Related to Chat Data - Variable list, variable whitelist, default value.
				// 不改动 Non-editable
				chatData_default: {
					//*单独手动加入 version: '1.7.05',  *需要排除
					chatcreatedtime: null,
					chatlasttime: null,
					chatid: null,
					chattitle: '',

					msgList: [{
						msg: "",
						my: false,
						datetime: "2000-01-01 00:00:00",
						wechatstyledatetime: null,
						hr: false
					}],
					msgContent : [{role: "system", content: "" }] , 
					msgTokens : [{role: "AI", completion_tokens: 0, total_tokens: 0 }] ,
					msgContentForMsgList_SingleRound : [{role: "system", content: "", datetime: "2000-01-01 00:00:00" }] ,
					msg: '',
					//*手动加入 chatVariables  *Chat Variables 需要排除
				},
							
				//v1.7.05  API Key数据 API Keys Data - 变量名单/变量列表/变量白名单/默认值。  Related to API key - Variable list, variable whitelist, default value.
				// 不改动 Non-editable
				apikeyData_default: {
					api: '', //不要改，默认等于thia.api, 写在mounted()
					timerId: null, 
					apiCheckedData: [], //数组 轮询key。不要改，默认等于thia.apiCheckedData, 写在mounted() 
				},
							
				//v1.7.05  提示词数据 Prompts Data - 变量名单/变量列表/变量白名单/默认值。  Related to Prompts - Variable list, variable whitelist, default value.
				// 不改动 Non-editable
				promptsData_default: {
					gptSystemPrompt: '', //不要改，默认等于thia.gptSystemPrompt, 写在mounted()
					gptPrompts: [], //数组 不要改，默认等于thia.gptPrompts, 写在mounted()
				}
			}
		},
		methods: {
			//按钮：导出所有对话 Export chat history  filetype:'markdown'(.md) or 'plain'(.txt)
			ExportData(filecontent, filename, filetype){
				// 创建Blob对象并生成下载链接
				const blob = new Blob([filecontent], { type: 'text/' + filetype });
				const urlObject = window.URL || window.webkitURL || window ;	
				const url = urlObject.createObjectURL(blob);
				// 创建下载链接并自动下载
				const downloadLink = document.createElement('a');
				downloadLink.href = url;
				const now = new Date();
				filename = filename + ' ' +  this.formatDateYYYYMMDDHHmmss(now,'.').slice(5) ; // like “10-14 10.23.45”
				filename = filetype == 'markdown' ? filename + '.md' : filename + '.txt';
				downloadLink.download = filename;
				downloadLink.click();
  			}, 
			//按钮：导出最后一轮  showtime是否导出时间  exportprompt是否导出提示词  onlyusebackticks提示词是否只使用反引号包裹  filetype:'markdown'(.md) or 'plain'(.txt)
			ExportData_SingleRound(showtime, exportprompt, onlyusebackticks, filetype){

				if (this.checkBusyStatus()) {
					// 如果返回 true，正在发送或正在验证
					return;
				} 
				//发送中的状态不允许导出，所以当上下文this.msgContent的长度>=3时，表示存在有效问答（单轮）
				if( this.msgContent.length < 3 ){
					//不存在发送成功的聊天记录
					let notif = this.settingsLanguage == 'cn' ? '导出本轮上下文记忆：当前不存在有效的聊天记录(单轮)，无数据可导出' : "Export current round's context: No valid context records found, no data available for export." ; //存在单引号
					setTimeout(() => { //之前有一个弹窗通知，这里需要延迟
						this.showNotification(notif, 'bottom', '', 7000);
					}, 1800);
					return;
				}
				let context = this.msgContentForMsgList_SingleRound ;
				let txt = '';
				let time = '';
				txt =  this.settingsLanguage == 'cn' ? '# GPT聊天记录\r\n\r\n' : '# Chat History\r\n\r\n';
	
				//如果需要导出提示词， 对提示词用markdown语法进行包裹， 语法自动选择用"引用"或者"代码块",
				//参数onlyusebackticks可以指定用代码块（导出后，若提示词很复杂导致了排版错乱，那么就可以设置onlyusebackticks为true）
				if ( exportprompt ) {
					const sys_prompt =  context[0]['content'].trim();  //context[0]与this.msgList[0]相同，同步更新。 context[0]['role'] = "system"
		
					//以下代码注释 详见addSystemPromptToChatHistory 
					let hasMultipleLines = /\r?\n\r?\n/.test(sys_prompt); 
					let backticks = this.findMaxBackticks(sys_prompt); 
					hasMultipleLines = backticks != '' ? true : hasMultipleLines ;
					backticks = backticks == '' ? '````' : backticks ; 
					if ( onlyusebackticks ) {
						hasMultipleLines = true;
					}
	
					let addMarkdownSyntaxStart = hasMultipleLines ? ( '\r\n' + backticks + '\r\n' ) : '\r\n> ' ;  // (> 后面有个空格)
					let addMarkdownSyntaxEnd = hasMultipleLines ? ( '\r\n' + backticks + '\r\n\r\n' ) : '\r\n\r\n' ; 
					let nullprompt = '';  //提示词为空的情况
					if( sys_prompt == '' ){
						nullprompt = this.settingsLanguage == 'cn' ? ': 空' : ': None' ; 
						addMarkdownSyntaxStart = '\r\n'; 
						addMarkdownSyntaxEnd = '\r\n' ;
					}
		
					const head = this.settingsLanguage == 'cn' ? '#### 系统提示词 system prompt ' : '#### #System Prompt ' ;
					txt += ( head + nullprompt + addMarkdownSyntaxStart + sys_prompt + addMarkdownSyntaxEnd );
				}
	
				//开始读取对话记录 
				for(let i = 1; i < context.length; i++) {
					if(context[i]['role'] === 'user') {
						if(i === context.length-1) {
							break; //最后一条记录，如果是user，说明是失败的，及没有[i+1],需要跳出循环
						}
						//排除掉发送失败的消息。判断下一条记录的role：发送失败的记录，下一条的role一定还是'user'；发送成功的记录，下一条的role一定是'assistant'。
						let nextRole = context[i+1]['role'];
						while(nextRole === 'user' && i+1 < context.length-1) {
							i++;
							nextRole = context[i+1]['role'];
						}
						if(nextRole === 'assistant') {
							//此时i是发送成功的user的消息 
							time = showtime ? (' _' + context[i]['datetime'] +  '_  \r\n') : ' \r\n';
							txt += this.settingsLanguage == 'cn' ? '**User**' : '**User**' ;
							txt += time;
							txt += context[i]['content'].replace(/\n/g, "\r\n") + '\r\n\r\n';
						}
					}else if(context[i]['role'] === 'assistant') {
						//gpt的回复
						time = showtime ? (' _' + context[i]['datetime'] +  '_  \r\n') : ' \r\n';
						txt += this.settingsLanguage == 'cn' ? '**GPT**' : '**GPT**' ;
						txt += time;
						txt += context[i]['content'].replace(/\n/g, "\r\n") + '\r\n\r\n';
					}
				}
		
				//导出 .md 或者 .txt
				this.ExportData(txt, this.exportTXTFileName_SingleRound, filetype);
			},
			
			//按钮：导出数据 JSON   
			ExportData_JSON(stringData, filename){
			

				// 创建Blob对象并生成下载链接
				const blob = new Blob([stringData], { type: 'application/json' });
				const url = URL.createObjectURL(blob);

				// 创建下载链接并自动下载
				const downloadLink = document.createElement('a');
				downloadLink.href = url;
				const now = new Date();
				filename = filename + ' ' +  this.formatDateYYYYMMDDHHmmss(now,'.').slice(5) + '.json' ; // like “10-14 10.23.45”
				downloadLink.download = filename; 
				downloadLink.click(); 
			},

  			
			//格式化时间  date时间 delimiter分隔符  分隔符为":"输出：2021-10-14 10:23:45  分隔符为"."输出：2021-10-14 10.23.45
			formatDateYYYYMMDDHHmmss(date,delimiter) {
				const year = date.getFullYear();
				const month = (date.getMonth() + 1).toString().padStart(2, '0');
				const day = date.getDate().toString().padStart(2, '0');
				const hour = date.getHours().toString().padStart(2, '0');
				const minute = date.getMinutes().toString().padStart(2, '0');
				const second = date.getSeconds().toString().padStart(2, '0');
				//ES6的写法：  return `${year}-${month}-${day} ${hour}${delimiter}${minute}${delimiter}${second}`;
				return year + '-' + month + '-' + day + ' ' + hour + delimiter + minute + delimiter + second; //兼容性更好。 Support more browsers.
			}, 
			//（6.20:改为DOM渲染之前判断）显示微信样式的时间。 判断时间间隔，跨度超过5分钟，返回当前时间戳，否则返回null。
			displayDatetime_WeChatStyle() {
					//直接获取倒数第1条记录的时间，无论是user还是ai。因为是在DOM渲染之前，所以是（length - 1）。最低为[0]
					//BUG日记：ios/macos, safari浏览器对new Date()存在兼容问题，safari不认"yyyy-MM-dd HH:mm:ss"格式的日期字符串，不识别“-”。
					let lastmsgdatetime = this.msgList[this.msgList.length - 1]["datetime"];
					lastmsgdatetime = lastmsgdatetime.replace(/-/g, "/") ;//转格式为yyyy/MM/dd HH:mm:ss ，兼容apple产品
					let lasttimestamp = new Date(lastmsgdatetime).getTime() / 1000 ; //获取指定时间lastmsgdatetime的时间戳，单位秒(s)
					let nowtimestamp = new Date().getTime() / 1000 ; //获取当前时间戳，单位秒(s)
				
					let min = (nowtimestamp - lasttimestamp) / 60;
					if( min > 5 ){
						return nowtimestamp;
					}else{
						return null;
					}
			},
			
			// 显示消息通知 通知提示框 tooltips	两种样式：position center or bottom			
			showNotification(content, position, title, bottomshowtime) {
			
				if (this.isShowNotification && this.notificationTimeoutId != -1) {
					clearTimeout(this.notificationTimeoutId);
					this.isShowNotification = false;
					this.notificationTimeoutId = -1;
				}

				//整体延时0.05秒 解决很多问题
				setTimeout(() => {
					this.setNotificationContent = content;
					this.setNotificationPosition = position;//其实可以用isNotificationHasMask直接代替setNotificationPosition
					this.isNotificationHasMask = position == 'center' ? true : false ; 
					this.notificationTimeoutId = position == 'center' ? -1 : this.notificationTimeoutId;
					if(title != null){
						this.setNotificationTitle = title.trim();
					}
					const notificationWrapper = document.querySelector('.notification-wrapper');
					notificationWrapper.style.height = 'auto';
					this.isShowNotification = true;
	  
					//Only bottom
					if (bottomshowtime == null){
						bottomshowtime = 1450; // 为空，默认显示1.45秒
					}	  
					this.isNotificationBottomShowCloseBtn = bottomshowtime > 2999 ? true : false ; //3秒或以上 显示关闭按钮
					if (position == 'bottom') {
						// 设置定时器并保存返回值给this.notificationTimeoutId
						this.notificationTimeoutId = setTimeout(() => {
								this.isShowNotification = false;
								this.notificationTimeoutId = -1;
							}, bottomshowtime);
					}
					if (position == 'center') { //动态设置原因：添加滚动层div后，如果notification-wrapper的height设为自动，滚动条会失效，找不到解决方法
						this.$nextTick(() => {
							const clientHeight = document.documentElement.clientHeight;
							const notificationWrapper = document.querySelector('.notification-wrapper');
							const notifHeight = notificationWrapper.offsetHeight;
							if( notifHeight > (clientHeight * 0.6)){
								notificationWrapper.style.height = '65%'; //内容多，设为65%高度，弹窗尺寸会跟随屏幕变化，滚动条有效
							}
							//else:  notificationWrapper.style.height = 'auto'; //内容少，设为自动高度，弹窗尺寸固定。弊端：无法显示滚动条
							//console.log('documentElement clientHeight:' + clientHeight + '\r\n\r\noffsetHeight:' + notifHeight );
						});
					}
				}, 50);
			},
			// 关闭 隐藏消息通知 通知提示框 tooltips		
			hideNotification() {
				clearTimeout(this.notificationTimeoutId);
				this.isShowNotification = false; 
			},
			//说明 帮助 小问号 mini Help
			showMiniHelp(position){
				let notif =  '';
				let title = '';
				let notifcn = '';
				let notifen = '';
				let text_help = this.settingsLanguage == 'cn' ? '帮助' : 'Help' ;
	
				switch(position) {
				  case 'B-CurrentSystemPrompt':
				  	notifcn = '展示当前对话的已生效的系统提示词，不可编辑。\r\n\r\n添加、修改、取消请在编辑区操作，保存后生效。\r\n\r\n取消方式：清空编辑区输入框的内容，然后保存，即可取消系统提示词。\r\n\r\n当前系统提示词属于对话数据，与对话一一对应，切换不同的对话，系统提示词会随之变化。';
					notifen = 'Display the system prompt that is in effect for the current chat and cannot be edited.\r\n\r\nTo add, modify, or cancel the system prompt, please operate in the [Prompt Editor] and save for changes to take effect.\r\n\r\nTo cancel the system prompt, clear the input box in the [Prompt Editor] and save.\r\n\r\nThe system prompt is part of the chat data and is associated with each individual chat. When switching to a different chat, the system prompt will change accordingly.';
				  	title = '';
					break;
				  case 'B-PromptEditor':
				  	notifcn = '可以在这里自由编辑提示词。\r\n\r\n未保存的提示词不会影响到[当前系统提示词]。\r\n\r\n提示词编辑器的草稿会存储在[提示词]数据中。它不属于[对话]数据，在对话列表中切换对话时，不会影响提示词编辑器中的内容。';
					notifen = 'You can freely edit the prompt.\r\n\r\nUnsaved changes will not affect the system prompt for the current chat.\r\n\r\nThe drafts in the Prompt Editor are saved in the Prompt Generator Data and do not belong to the Chat Data. Switching to a different chat in the Chat List will not affect the content in the Prompt Editor.';
				  	title = '';
					break;
				  case 'A-CheckAPIKey':
				  	notifcn = 'OpenAI API Key，即OpenAI的接口密钥，将密钥粘贴到输入框，然后开始验证。\r\n\r\n  • 验证成功后，开始聊天或查询API余额。';
					notifen = 'Enter OpenAI API Key and check.\r\n\r\n  • After checking, you can chat or check OpenAI API balance.';
				  	if(!this.isSimpleMode){
						notifcn += '\r\n\r\n  • API Key随时可改。\r\n\r\n  • API Key是什么样的？\r\n    OpenAI公司的API Key是以“sk-”开头的一串密钥，例如 sk-bkR8V4tjmD7lXq9aZheZVpc6DtR8vw9VTYFJ1iaohMPpT3Bl\r\n\r\n  • 如何获取官方的API Key？\r\n    注册成功后，打开官方接口页面免费获取即可，地址 https://platform.openai.com/account/api-keys   但是，国内IP无法直接注册OpenAI账号，网上有很多注册教程，其中最基础的条件是需要优质的魔法（"魔法"是一种可以让您的手机或电脑出趟国的技术，好的魔法会让OpenAI认为您的设备是真的在国外），满足这个条件就有机会免费注册账号并拥有API Key。';
						notifen += '\r\n\r\n  • API Key can be changed at any time.\r\n\r\n  • Q: What does API Key look like?\r\n    A: It starts with "sk-", like this: sk-bkR8V4tjmD7lXq9aZheZVpc6DtR8vw9VTYFJ1iaohMPpT3Bl ';
					}
					notifcn += '\r\n\r\n附 常用的官方网址：\r\n    OpenAI官网：https://openai.com \r\n    查看API余额：https://platform.openai.com/account/usage \r\n    官方版ChatGPT / GPT4：https://ai.com 或  https://chat.openai.com/auth/login \r\n';
					notifen += '\r\n\r\n  • OpenAI: https://openai.com \r\n    API Key: https://platform.openai.com/account/api-keys \r\n    API balance: https://platform.openai.com/account/usage \r\n    ChatGPT / GPT4: https://ai.com or https://chat.openai.com/auth/login \r\n';
					title = '';
					break;
				  case 'A-APISettings':
				  	notifcn = '  • 智能max_tokens(推荐开启): 启用“智能max_tokens”功能后，会出现小问号 [?] ，可以点击了解更多。\r\n\r\n  • temperature: 默认0.7，官方默认1.0。temperature ("温度") 用于控制GPT生成结果的随机性/多样性/创造力。过低 会导致生成的文本更加保守和重复。过高 会导致生成的文本更加随机和具有创造性 (约从1.2开始，就有几率出现无中生有的词或乱码) 。\r\n\r\n  • max_tokens: 生成结果时的最大token数，可随时调节。单轮对话 "上下文已消耗的token数量" 加上设置的 "max_tokens数量" 不能超过模型的上下文长度 (gpt3.5支持最高4096 tokens) 。\r\n\r\n • model: 模型，暂时仅支持gpt3.5模型。\r\n\r\n • 更多: 点击显示更多的API参数。';
					//含单引号
					notifen = "  • Smart max_tokens (recommended to enable): After enabling the 'Smart max_tokens' feature, a small question mark [?] will appear, which can be clicked to learn more.\r\n\r\n  • temperature: The 'temperature' setting controls how creative and diverse the text generated by GPT is. Lower values result in more repetitive and simpler text, while higher values result in more random and creative text. \r\n\r\n  • max_tokens: The maximum number of tokens to generate in the chat completion. The total length of input tokens and generated tokens is limited by the model's context length (gpt3.5 support 4096).\r\n\r\n  • model: Only supports GPT3.5 for now.\r\n\r\n  • More：Click to display more API parameter settings.\r\n\r\n  • API reference: \r\n    https://platform.openai.com/docs/api-reference/chat/create ";
				  	title = '';
					break;
				  case 'A-SmartMaxTokens':
				  	notifcn = '开启“智能max_tokens”后，全自动调节 max_tokens，无需手动调节。\r\n如果关闭“智能max_tokens”，需要手动调节 max_tokens，且可能需要多次调节，才能让上下文（记忆）达到接近 4096 tokens 的高使用率。\r\n\r\n  • 默认开启“智能max_tokens”\r\n  • 这是一个非精准调节的计算策略。长对话中，95%可以做到“智能”，5%遇到错误会自动关闭，并提示您手动调节。';
					notifen = 'When "Smart max_tokens" is enabled, max_tokens will be automatically adjusted without manual intervention. \r\nIf "Smart max_tokens" is disabled, you will need to manually adjust max_tokens, which may require multiple adjustments to get the context tokens close to the upper limit of 4096. \r\n\r\n  • "Smart max_tokens" is enabled by default.\r\n  • This is not an OpenAI algorithm, but it can be "smart" about 95% of the time for longer chats. If errors occur, it will automatically disable and prompt you to manually adjust the max_tokens.';
					if(!this.isSimpleMode){
						notifcn += '\r\n  • 如何做到精准调节？GPT-3.5 (ChatGPT) 与 GPT-4 模型均采用 cl100k_base 编码器，cl100k_base 可以精准计算 tokens 。您可以自己修改代码以达到完美的效果。\r\n  • 以下现象与OpenAI官方有关：发送的第一条消息，额外有增加 13 tokens，之后发送的消息，每条增加 10 tokens。';
						notifen += '\r\n  • How to achieve precise adjustments?  Both GPT-3.5 (ChatGPT) and GPT-4 models use the cl100k_base encoder, which can accurately calculate tokens. If you are familiar with this technology, you can modify the code to achieve perfect results.\r\n  • The following phenomenon is related to OpenAI: the first message sent will have an additional 13 tokens, and each subsequent message will have an additional 10 tokens added.';
					}
				  	title = '';
					break;
				  case 'A-ProfessionalAPISettings':
				  	notifcn = '  • 接口网址: 目前仅支持GPT-3.5或更新版本的GPT模型，对应的接口网址应以 "/v1/chat/completions" 结尾，如OpenAI官方接口网址 "https://api.openai.com/v1/chat/completions" ，但也不排除第三方接口的网址结构有所改动。\r\n  • 官方API接口需要魔法才能连接。第三方API有的需要魔法，有的不需要。\r\n  • 有魔法的情况下，推荐使用官方接口，实际体验更好 (连发3条不会报错) 。免费gpt账号目前都有每分钟3次的调用限制 (单key每分钟最多3次) ，但官方接口使用起来明显更流畅，报错几率会低点。\r\n  • 第三方接口无法保证隐私安全，请自辨。';
					if(!this.isSimpleMode){
						notifcn += '\r\n  • "魔法"是一种可以让您的手机或电脑出趟国的技术。';
					}
					notifcn += '\r\n\r\n  • 以下3个参数的说明见官网：\r\n    top_p: (默认为1)  https://platform.openai.com/docs/api-reference/chat/create \r\n    presence_penalty: (默认为0)  https://platform.openai.com/docs/api-reference/chat/create \r\n    frequency_penalty: (默认为0)  https://platform.openai.com/docs/api-reference/chat/create ';
					notifen = '  • API URL: API Endpoint. The code only supports GPT-3.5 or newer versions of the model, and the API ENDPOINT URL should end in "/v1/chat/completions", like the official one "https://api.openai.com/v1/chat/completions" \r\n\r\n  • top_p: (Defaults to 1)  https://platform.openai.com/docs/api-reference/chat/create \r\n\r\n  • presence_penalty: (Defaults to 0)  https://platform.openai.com/docs/api-reference/chat/create \r\n\r\n  • frequency_penalty: (Defaults to 0)  https://platform.openai.com/docs/api-reference/chat/create ';
				  	if(!this.isSimpleMode){
						//新用户模式
						notifcn += '\r\n\r\n####以下内容均引用自网络：\r\nhttps://zhuanlan.zhihu.com/p/606573556 \r\n\r\n';
						notifcn += '1) top_p:   0.0 ~ 1.0 \r\n- 指定生成文本的多样性。与参数 temperature (温度) 相似，它是一个可用于代替 temperature 的参数，可以控制生成文本的随机性。\r\n- 会根据生成文本的概率分布，只保留前面概率之和达到一定阈值的词语，然后再从中随机选择一个词语作为下一个生成的词语。较高的值会导致生成的文本更具有多样性，但是会牺牲一定的准确性和保真度。较低的值则会导致生成的文本更加保险和准确，但是可能会过于死板和缺乏新意。\r\n\r\n';
						notifcn += '2) presence_penalty:   -2.0 ~ 2.0 \r\n- 正值会根据新 tokens 在文本中的现有频率对其进行惩罚，从而降低模型逐字重复同一行的可能性。\r\n- 控制重复单词的惩罚力度。较大的惩罚力度会导致生成文本中不太可能出现相同的单词，而较小的惩罚力度则会容忍一定程度的重复。\r\n- 控制文本罕见词汇出现情况。当此参数值大于0时，将抑制模型生成频繁出现的单词，并鼓励生成罕见的单词。值越大，生成的文本中罕见单词的数量可能越多。如果值为0，则不会考虑单词的频率，并且每次生成的单词概率分布都是相同的。如果需要鼓励生成罕见的单词，可以增大参数值。\r\n\r\n';
						notifcn += '3) frequency_penalty:   -2.0 ~ 2.0 \r\n- 正值会根据到目前为止是否出现在文本中来惩罚新 tokens，从而增加模型谈论新主题的可能性。\r\n- 控制模型生成与文本样本中不同的单词的惩罚力度。较大的惩罚力度会导致生成文本中更多地包含文本样本中未出现的单词，而较小的惩罚力度则会限制生成文本的多样性。\r\n- 控制文本同一词汇重复情况。当此参数值大于0时，将鼓励模型生成不同的单词，并尽可能避免使用已经在之前生成的文本中出现过的单词。如果值越大，生成的文本中不同单词的数量可能越多。如果值为0，则不会考虑之前生成的单词，并且每次生成的单词概率分布都是相同的。 例如，在文本生成任务中，如果需要鼓励生成不同的单词，并且避免使用相同的单词，可以增大参考值。';
					}
					title = '';
					break;
				  case 'A-GeneralSettings':
				  	notifcn = '  • 关于头像设置：支持"上传图片"、"网络图片网址"、"本地图片路径"三种方式。\r\n\r\n  • 1) 如何上传图片？(推荐，支持手机和电脑)\r\n    点击 [设置] > 右侧头像，或者点击左侧下拉框选择上传图片。\r\n\r\n  • 2) 如何使用网络图片？\r\n    填入图片网址，并点击更新。\r\n\r\n  • 3) 电脑端如何使用"本地图片路径"？\r\n    需要把html文件下载到电脑中，在本地打开使用时，才支持本地图片路径（填入相对路径或绝对路径的方式，不明白的建议直接使用第一种方式上传本地图片）。\r\n    以下是本地图片路径的示范：\r\n    Mac/Windows上的相对路径例子：123.jpg （头像需要与html文件放在同一文件夹中）\r\n    Mac上的绝对路径例子：/Users/LinTongXue/Downloads/123.jpg \r\n    windows上的绝对路径例子：D:\\LinTongXue\\123.jpg ';
					notifen = '  • Regarding avatar settings: Upload image, Network image, and Local image (path).\r\n\r\n  • 1) How to upload an image as an avatar? (Recommended, supports both mobile and computer devices) \r\n    Click on "Settings" > Avatar on the right or select "upload an image" from the dropdown menu on the left.\r\n\r\n  • 2) How to use an online image?\r\n    Enter the URL of the image and click on update.\r\n\r\n  • 3) How to use a local image (path) as your avatar on Mac/PC?\r\n    You need to download the HTML file to your computer and open it locally to support local images (support relative or absolute paths). \r\n    Here are some examples of local image paths:\r\n    Mac/Windows relative path:   123.jpg   (the avatar needs to be placed in the same folder as the HTML file)\r\n    Mac absolute path:   /Users/LinTongXue/Downloads/123.jpg\r\n    Windows absolute path:   D:\\LinTongXue\\123.jpg';
				  	title = '';
					break;
				  case 'A-ExportChatHistory':
				  	notifcn = '  • 将当前对话的聊天记录导出为纯文本格式，可直接阅读。\r\n\r\n  • 导出聊天记录 · 单轮记忆：导出单轮聊天记录，即针对当前的上下文记忆进行导出，包含最新修改的系统提示词，不含发送失败的、撤回的、重问的记录。格式：Markdown。文件类型：.md 或 .txt\r\n\r\n  • 导出聊天记录 · 全部：将网页上的所有聊天记录（包含发送失败的、撤回的、重问的记录）和所有操作记录（包含系统提示词修改记录）导出并下载。格式：Markdown。文件类型：.md 或 .txt\r\n\r\n  • 附 两个Markdown在线编辑器网站：\r\n    https://stackedit.cn/app# \r\n    http://tool.pfan.cn/markdown ';
					notifen = '  • Export the chat history of the current chat as plain text format for easy reading.\r\n\r\n  • Export Chat History for a Single Round, which includes the current context and the most recent system prompt, but excluding failed messages, undo messages, and retry messages. Exported file format: Markdown. File type: .md | .txt\r\n\r\n  • Export All Chat History, export and download all chat history (including failed messages, undo messages, retry messages) and all operation records (including system prompt modification records) on the webpage. Exported file format: Markdown. File type: .md | .txt \r\n\r\n  • Websites for Markdown online editors:\r\n    https://dillinger.io \r\n    https://stackedit.io/app# ';
				  	title = '';
					break;
				  case 'C-ChatList':
					notifcn = '  • 单个对话的数据包含聊天历史记录 (含上下文记忆)、当前系统提示词 (单条)、聊天输入框内的草稿、以及与对话直接关联的其他数据。';
					notifcn += '\r\n  • 对话的数据不包括用户设置、用户头像、提示词模板、提示词编辑器草稿、密钥 (API-Key) 及API参数信息，切换不同对话时，这些数据不会发生改变。';
					notifcn += '\r\n  • 可导出单个对话数据，或一次导出所有对话的数据。可用于分享，对方导入后可恢复对话数据，完全一致。';
					notifcn += '\r\n\r\n  • 若浏览器支持本地存储 (localStorage) ，所有对话数据将会自动保存在浏览器缓存中。';
					notifcn += '\r\n  • 非隐私模式（无痕模式）下，会同步不同标签页间的数据，自动新增、修改、合并，数据冲突会自动创建副本。';
					notifcn += '\r\n  • 可随时通过 [删除数据] 功能或浏览器的清除历史记录 (清除缓存) 功能来删除所有数据。';
					if(!this.isSimpleMode){
						notifcn += '\r\n  • 对话列表按照最近活动时间排序，新的靠前。';
						notifcn += '\r\n  • #编号 和 #描述 可随意修改，仅有长度限制。';
						notifcn += '\r\n  • 手动或自动创建对话副本时，副本的创建时间会自动加1秒或更多。';
						notifcn += '\r\n\r\n  • 使用浏览器普通模式时：标签页或浏览器窗口可随时刷新或关闭，打开时均能恢复数据，且不同标签页的数据是共享的（同一浏览器打开相同网页的情况下）。';
						notifcn += '\r\n  • 使用浏览器隐私模式（无痕模式）时：大多数支持本地存储，标签页可刷新，标签页或窗口之间不互通数据，标签页关闭时，所有数据都会被销毁。';
					}
					notifen = '  • Each chat data includes chat history, the current system prompt, the draft in the chat input box, and other data directly associated with the chat.';
					notifen += '\r\n  • Chat data does not include user settings, avatars, prompt generator data, prompt editor drafts, API keys, and API parameter information. These data will not change when switching between different chats.';
					notifen += '\r\n  • You can export individual chat data or export all chats at once. This can be used for sharing, and the recipient can import and restore the chat data.';
					notifen += '\r\n\r\n  • If the browser supports local storage (localStorage), all data will be automatically saved in the browser cache.';
					notifen += '\r\n  • In non-private mode, data is synced between different tabs, automatically adding, modifying, and merging. In case of conflicts, copies are created automatically. ';
					notifen += "\r\n  • You can delete all data anytime through [Settings] > [Delete Data] (or by clearing the browser's browsing history).";
					if(!this.isSimpleMode){								
						notifen += '\r\n  • The chat list is sorted by last activity time with the newest at the top.';
						notifen += '\r\n  • #ID and #description can be freely modified, with length limitations.';
						notifen += '\r\n  • When manually or automatically creating a copy of a chat, the chat creation time of the copy will be incremented by 1 second or more.';
						notifen += '\r\n\r\n  • In the normal mode of the browser, Tabs or browser windows can be refreshed or closed at any time, and data will be restored upon reopening. Data is shared between different tabs (when opening the same webpage in the same browser).';
						notifen += '\r\n  • In private/incognito mode, Local storage is supported in most cases, tabs can be refreshed, but data is not shared between tabs or windows, and cache data is cleared when tabs are closed.';
				  	}
				  	title = '';
					break;
				  case 'A-DataPrivacyAndManagement':
					notifcn = '  • 所有数据仅存储于浏览器本地存储（localStorage）中，不会通过任何方式对外传输。\r\n';
					notifcn += '  • [删除数据] 可清空所有数据，或者通过浏览器的历史记录清除功能来清空数据 (清除缓存)。\r\n\r\n';
					
					notifcn += '  • LinGPT数据:  全自动保存\r\n';
					notifcn += '    数据分为4个部分，支持一键删除或导出，也可以单独删除或导出，同时支持分享和导入，导入时会自动分析包含的数据类型。\r\n\r\n';

					notifcn += '  • 1) Chat Data List:  对话数据，包含所有对话的数据。可导出单个对话或全部对话。\r\n';
					if(!this.isSimpleMode){
						notifcn += '    更新方式：自动合并数据\r\n    导入数据：自动合并数据\r\n    多标签页：实时同步数据\r\n\r\n';
					}
					notifcn += '  • 2) API Key Data:  密钥数据，包含 API-Key 数据  *多功能待开发中\r\n';
					if(!this.isSimpleMode){
						notifcn += '    更新方式：自动合并数据\r\n    导入数据：自动合并数据 *功能待开发中\r\n    多标签页：手动刷新可获取最新数据 \r\n\r\n';
					}
					notifcn += '  • 3) Prompts Data:  提示词数据，包含提示词窗口的数据 (不包括当前系统提示词)  *多功能待开发中\r\n';
					if(!this.isSimpleMode){
						notifcn += '    更新方式：自动合并数据\r\n    导入数据：自动合并数据 *功能待开发中\r\n    多标签页：手动刷新可获取最新数据 \r\n\r\n';
					}
					notifcn += '  • 4) User Settings:  用户设置类数据，包括设置、上传的头像和 API 参数设置\r\n';
					if(!this.isSimpleMode){
						notifcn += '    更新方式：覆盖旧数据\r\n    导入数据：覆盖旧数据\r\n    多标签页：\r\n';
						notifcn += '     - 每个刷新的页面，在刷新前都会自动保存 [设置数据]，刷新后又会读取 [设置数据] 。因此，设置不会发生变化。\r\n';
						notifcn += '     - 刷新、关闭、切换标签页等操作都会触发自动保存，所以最新的 [设置] 通常以最后一个操作的网页为准。\r\n\r\n';
					}
					notifen = "  • All data is stored only in the browser's local storage (localStorage) and is not transmitted externally.\r\n";
					notifen += "  • [Delete Data] can clear all data or use the browser's history clearing function to empty the data (clear cache).\r\n\r\n";

					notifen += '  • LinGPT Data: Fully automated saving\r\n';
					notifen += '    The data is divided into four parts, supporting one-click deletion or export. It also allows individual deletion or export, and supports sharing and importing. When importing, it automatically analyzes the included data types.\r\n\r\n';

					notifen += '  • 1) Chat Data List: Including data from all chats. Can export single or all chats.\r\n';
					if(!this.isSimpleMode){
						notifen += '    Update method: Automatically merge data\r\n    Import method: Automatically merge data\r\n    Multiple tabs: Real-time data synchronization\r\n\r\n';
					}
					notifen += '  • 2) API Key Data: Including API Key data *Functionality under development\r\n';
					if(!this.isSimpleMode){
						notifen += '    Update method: Automatically merge data\r\n    Import method: Automatically merge data *Functionality under development\r\n    Multiple tabs: Manually refresh to get the latest data\r\n\r\n';
					}
					notifen += '  • 3) Prompts Data: Including data from the prompt generator window (excluding current system prompt) *Functionality under development\r\n';
					if(!this.isSimpleMode){
						notifen += '    Update method: Automatically merge data\r\n    Import method: Automatically merge data *Functionality under development\r\n    Multiple tabs: Manually refresh to get the latest data\r\n\r\n';
					}
					notifen += '  • 4) User Settings: Including configurations, uploaded user avatar and API parameter settings\r\n';
					if(!this.isSimpleMode){
						notifen += '    Update method: Overwrite old data\r\n    Import method: Overwrite old data\r\n    Multiple tabs:\r\n';
						notifen += '     - Each refreshed page will automatically save settings data before refreshing, and then read settings data after refreshing. Therefore, settings will not change.\r\n';
						notifen += '     - Refreshing, closing, switching tabs, and other operations will trigger automatic saving. Therefore, the latest settings are usually based on the last operation on the webpage.';
					}
					
					//不支持本地存储时
					if(!this.isLocalStorageSupported){
						notifcn = '当前浏览器或浏览器模式不支持"浏览器本地存储"，已关闭保存功能，并不会存储任何数据。但是您仍然可以通过使用 [删除数据] 进行强制清空数据，即使当前浏览器本地存储中不应该存在有数据。\r\n\r\n';
						notifen = 'The browser or browser mode does not support "browser local storage". The save function has been disabled, and no data will be stored. However, you can still use the "Delete Data" option to forcefully clear any data, even though there should not be any data present in the browser local storage.';
					}
					
					title = '';
					break;
				  default:
					// 当expression的值都不等于以上值时执行的代码块
				  	notifcn = '';
					notifen = '';
				  	title = '';
				}	

				notif = this.settingsLanguage == 'cn' ? notifcn : notifen ;
				this.showNotification(notif, 'center', title);
			},
	
			// 设置窗口 - 打开设置窗口 弹窗
			openDialogTodo_Settings(){

				//打开弹窗前需要处理的：
				//1. API URL： 将当前api url恢复到input，无论是否有效，即打开弹窗时，默认显示当前使用的URL。 
				this.inputApiURL = this.apiURL;
				
				//2. API URL： 保存按钮不可用。url在修改前保持不可用状态
				this.btnDisabledState_SaveApiURL = true;
				
				//3. API URL： 如果当前是官方url，下拉框匹配官方
				if( this.inputApiURL == 'https://api.openai.com/v1/chat/completions' ){
					this.selectedApiURL = 'https://api.openai.com/v1/chat/completions'; //1 下拉框显示为“官方”/“GPT”
				}
				
				//4. img URL： 将当前头像地址img url恢复到输入框input，即打开弹窗时，默认显示当前使用的头像的URL。 
				const svgtips = this.settingsLanguage == 'cn' ? this.GPTGreenSVG_UrlText_cn : this.GPTGreenSVG_UrlText_en;
				this.inputGPTImageUrl = this.isgptGreenSvgShow ? svgtips : this.gptAvatarURL;
				this.inputUserImageUrl = this.userAvatarURL;
				
				//5. img URL： 更新头像按钮不可用。url在修改前保持不可用状态
				this.btnDisabledState_updateUserImageUrl = true;
				this.btnDisabledState_updateGPTImageUrl = true;
				
				//显示设置弹窗
				this.isShowDialog_Settings = true;
			},
			// 设置窗口 - 简约模式/默认模式 Normal Mode .  新用户模式/教程模式 User Onboarding
			changeSimpleMode(ischange){
				
				if ( ischange !== false ){
					let notif = '';
					if(this.isSimpleMode){
						notif = this.settingsLanguage == 'cn' ? '默认模式 (简约模式)' : 'Normal Mode (Simple Mode)' ;
					}else{
						notif = this.settingsLanguage == 'cn' ? '新用户模式 (此模式下会增加提示)' : 'User Onboarding (This mode offers more functionality prompts.)' ;
					}
					this.showNotification(notif, 'bottom', '',4000);
				}
				
				//一些CSS样式/布局
				//判断设备宽度 是否显示tokens 的文字 / 图标...
				if (document.documentElement.clientWidth < 414) {
					let isshow = Math.random() < 0.6  ; //概率 随机 
					if(this.isSimpleMode){ isshow = false; }
					this.isShowTotaltokensSVG = !isshow;
					this.isShowTotaltokensLabel = isshow;
				}else {
					this.isShowTotaltokensSVG = true;
					this.isShowTotaltokensLabel = !this.isSimpleMode ; // !this.isSimpleMode = ( true && this.isSimpleMode )
				}
				// 判断设备宽度 是否显示上下文/记忆 的文字 
				if (document.documentElement.clientWidth < 471 ){
					this.isShowQACountLabel = false;
				}else {
					this.isShowQACountLabel = !this.isSimpleMode ; // !this.isSimpleMode = ( true && this.isSimpleMode )
				}
			
			},
			// 设置窗口 - 显示专业级API设置 Pro 设置控制面板
			showProConfig(){
				let notif = '';
				if(this.isShowProConfig){
					this.isShowProConfig = false;
					notif = this.settingsLanguage == 'cn' ? '隐藏 API专业设置' : 'Hide Professional API Settings' ;
				}else{
					this.isShowProConfig = true;
					notif = this.settingsLanguage == 'cn' ? '显示 API专业设置' : 'Show Professional API Settings' ;
				}
				this.showNotification(notif, 'bottom');
			},
			// 设置窗口 - 开启/关闭智能max_tokens  Smart max_tokens 
			changeSmartMaxTokens(){ 
				const notif_cn =  this.openSmartMaxTokens ? '已启用 智能max_tokens' : '已关闭 智能max_tokens';
				const notif_en =  this.openSmartMaxTokens ? 'Smart max_tokens Enabled' : 'Smart max_tokens Disabled';
				const notif = this.settingsLanguage == 'cn' ? notif_cn : notif_en ;
				this.showNotification(notif, 'bottom');
			},
			// 设置窗口 Temperature 警告
			changeTemperature(){
			
			},
			// 设置窗口 MaxTokens  警告
			changeMaxTokens(){
			
			},

			//粗略的估算tokens。仅适合 GPT-3.5 & GPT4， 不适合GPT-3 ，tokens计算方式完全不同。有技术的可以直接实现100%精准计算，不需要估算。参考官网，或者：https://gpt-tokenizer.dev
			linTokenizer(message) {
				// tool ： https://gpt-tokenizer.dev
				// To support new languages ., 
				// 1). you should refer to the englishMixedArr and englishSingleArr to add new codes.  *Different languages are handled differently. The estimation for English is based on words or consecutive letters, while for Chinese, it is based on single characters.
				// 2). Test the new language on the website https://gpt-tokenizer.dev. If the spaces before the words are not counted as one token (1 token), you need to subtract the number of spaces in the "const _space = ..." code, just like how it is handled for English.
				// 3). To estimate the tokens for word groups (or characters) in a language, add the ratio calculation like the way it is handled for English: "const english_tokens = englishMixedArr.length / 0.75 ;".

				// 定义左右是空格的单独连续字符的正则表达式
				const englishSingleReg = /\s+[a-zA-Z]+/g; //左边是空格的连续英文，用于“空格计算”

				// 定义中文、数字、特殊符号的正则表达式
				const chineseReg = /[\u2E80-\u9FFF]/g;
				const englishReg = /[a-zA-Z]+/g;
				const numberReg = /\d+/g;
				const symbolReg = /[^\u2E80-\u9FFFa-zA-Z0-9\s]/g; //符号及其他语言文字

				// 匹配空格、制表符和换行符的正则表达式
				const spaceReg = /\s+/g;
				const otherSpaceReg = /\s{2,}/g; //两个或以上连续

				// 定义结果数组
				const chineseMixedArr = [];
				const numberMixedArr = [];
				const symbolMixedArr = [];
				let englishSingleArr = [];
				let englishMixedArr = [];
				const spaceArr = [];
				const otherSpaceArr = [];
				//const otherArr = [];

				// 提取中文
				const chineseMatch = message.match(chineseReg);
				if (chineseMatch) {
					chineseMixedArr.push(...chineseMatch);
				}
	
				// 提取数字
				const numberMatch = message.match(numberReg);
				if (numberMatch) {
					numberMatch.forEach(num => {
						if (num.length > 3) {
							// 超过3个字符的数字需要拆分
							for (let i = 0; i < num.length; i += 3) {
							  numberMixedArr.push(num.slice(i, i + 3));
							}
						} else {
							numberMixedArr.push(num);
						}
					});
				}

				// 提取特殊符号 *符号及其他语言文字
				const symbolMatch = message.match(symbolReg);
				if (symbolMatch) {
					symbolMixedArr.push(...symbolMatch);
				}

				// 提取英文  
				const englishMatch = message.match(englishReg);
				if (englishMatch) {
					englishMixedArr.push(...englishMatch);
				}
	
				// 提取英文（前面是空格的英文，用于计算空格所占的tokens）
				const englishMatch_Single = message.match(englishSingleReg);
				if (englishMatch_Single) {
					englishSingleArr.push(...englishMatch_Single);
				}
  
				// 提取空格、制表符和换行符
				const spaceMatch = message.match(spaceReg);
				if (spaceMatch) {
					spaceArr.push(...spaceMatch);//连续1个或以上
				}
				// const spaceMatch = message.match(spaceReg);
				const otherSpaceMatch = message.match(otherSpaceReg);
				// if (spaceMatch) {
				// 	spaceArr.push(...spaceMatch.filter((match) => !otherSpaceReg.test(match))); 
				// }
				if (otherSpaceMatch) {
				 	otherSpaceArr.push(...otherSpaceMatch);//连续2个或以上
				}

				// 提取剩余未匹配到的字符 *应该是不存在 =null
				//const otherMatch = message.replace(chineseReg, '').replace(englishReg, '').replace(numberReg, '').replace(symbolReg, '').replace(spaceReg, '');
				//if (otherMatch) {
				//	otherArr.push(...otherMatch);
				//}
				
				// 预估"英文等语言"的tokens  *English, etc. languages.  *测试准确度时，对比的条件要相同：不能有标点符号 不能换行 单词只能用1个空格隔开
				const english_tokens = englishMixedArr.length / 0.75 ;
				// 预估"中文等语言"的tokens  *Chinese, etc. languages.  *比例可以偏小，这样估算的tokens将偏大，计算的max_tokens将偏小，这样不容易因“max_tokens偏大”而报错。
				const chinese_tokens  = chineseMixedArr.length / 0.83 ;
				// 预估“数字”的tokens
				const numbers_tokens = numberMixedArr.length / 1;
				// 预估“符号及其他语言文字”的tokens  *Symbols and other languages
				const symbolMixed_tokens = symbolMixedArr.length / 1.3; //这里按照1个符号对应0.77个token计算。这部分差异可能较大。有单个符号就占用2～3个token的情况（symbolMixedArr.length / 0.33 ～ 0.5），如果数量多，会非常不准。
				// 预估“空格、制表符和换行符”的tokens
				const _space = spaceArr.length - englishSingleArr.length < 0 ? 0 : spaceArr.length - englishSingleArr.length; //首先排除英文前的空格，其他语言太多，无法判断。比如：俄语 法语 等，也可以同英文，计算排出。
				const _otherspace = otherSpaceArr.length / 2.5; //连续2个以上的空格，增加0.4token。  *连续2个以上的空格，连着非英文字母时，通常都会增加1个token。联系2个换行一般不增加。 
				const space_tokens = _space / 1.3 + _otherspace ; 
  
				let msgtokens = english_tokens + chinese_tokens + numbers_tokens + symbolMixed_tokens + space_tokens;
				
				msgtokens = msgtokens * 1.05; //增加5%  Increase by 5%. 
				return Math.ceil(msgtokens); //int. 返回预估的tokens ，向上取整数。
			},
			// 智能max_tokens / Smart max_tokens / 自动调节max_tokens。  预估最后一条信息的tokens，智能调节参数。是我自己想的一个预估策略，不准的。如果想要精准，请看下面的方法： （应该是要后台什么的，我不会，不学了）
			// Not precise. If you want to calculate tokens accurately, please refer to: 1)（GPT-3.5）：https://gpt-tokenizer.dev   2) OpenAI (GPT-3, not GPT-3.5）https://platform.openai.com/tokenizer
			// 算法中的数字除了特别说明的，其他都是我自己设定的值。 There are a lot of numbers in the algorithm, which do not have any special meaning, they are all values that I set up myself for the purpose of strategy.
			autoAdjustMaxTokens(sendMsg) {
			
				if (!this.openSmartMaxTokens){ 
					return;
				}
				if (this.isFixingMaxTokens_SmartMaxTokens){ //“正在修复MaxTokens”的状态，本次不自动调节max_tokens.
					return;
				}
				
				//重问时(成功过的/得到过回复后的重问) When retrying. (After receiving a reply from GPT)  *(4095 4096 4097  gpt-3.5 gpt-4 gpt3.5 gpt4)
				if( this.userMsgTokensForRetry != 0 ){
					this.apiMaxTokens = 4096 - this.totaltokens; // 此时this.totaltokens为精准的total tokens（如果提示词没有变动/变化不大的话）。 this.totaltokens = 上下文 + 本次重问的信息 
					//这里其实没必要减去一个值，tokens足够的情况下，减低点预防“因修改提示词而导致超额”的情况
					if ( this.apiMaxTokens > 3500 ){
						this.apiMaxTokens = this.apiMaxTokens - 350 ;
					}else if ( this.apiMaxTokens > 2600 ){
						this.apiMaxTokens = this.apiMaxTokens - 300 ;
					}else if ( this.apiMaxTokens > 1500 ){
						this.apiMaxTokens = this.apiMaxTokens - 200 ;
					}else if ( this.apiMaxTokens > 600 ){
						this.apiMaxTokens = this.apiMaxTokens - 100 ;
					}
					// 其余情况：不处理，发生错误则根据提示信息手动调整。
					return;
				}
				
				//以下：非重问时 & 失败后的重问。 The following code: Non-Retry operation && Retry operation performed after request failure.
				//:?: 单条发送问题的token数会比实际的高，疑似官方会添加隐藏的提示词。经过测试，1、当this.msgContent包含系统提示词这一项时（[0]，即使为空），首条会额外占用 13 token ； 2、之后每条发送的讯息额外占用 10 token 。
				//:?: The tokens for sending message are higher than the actual count, which is probably because OpenAI adds hidden prompt words. After testing, 1) when the "system prompt"  is included in the context of this.msgContent in the code (this.msgContent[0]), even if the system prompt is empty, the first message will have an extra 13 tokens; 2) each subsequent message will take up an additional 10 tokens.
				//截止2023-06-10，OpenAI规律没有变化。As of June 10th, 2023, there have been no changes in the policies of OpenAI.
				const firstsendmsg_openai = 13;  // tips：this.msgTokens[1]记录的是（提示词+首条）的tokens，且后续修改提示词并不会更新这里的tokens数量
				const sendmsg_openai = 10;
				
				
				// 预估当前消息的tokens数量
				let estimatedTokens = this.linTokenizer(sendMsg);
			//console.log("当前预估 原始的sendmsg: " + estimatedTokens);
				if ( this.msgContent.length < 2 ){ //如果是首条信息
					estimatedTokens = estimatedTokens + firstsendmsg_openai ;
					let sysprompt = this.msgContent[0]["content"] ;
					if ( sysprompt != '') { //如果存在系统提示词
						const syspromptTokens = this.linTokenizer(sysprompt); //预估系统提示词的tokens
			//console.log("首条 系统提示词 预估（未+13） : " + syspromptTokens);
						estimatedTokens = estimatedTokens + syspromptTokens;
					}
				}else { //非首条，不需要计算系统提示词，因为它的精准tokens数量会被包含在this.totaltokens当中
					estimatedTokens = estimatedTokens + sendmsg_openai ;
				}
				
	 		//console.log("当前预估（若是首条含提示词，含+13/+10） : " + estimatedTokens);
	
				
				// (4095 4096 4097  gpt-3.5 gpt-4 gpt3.5 gpt4) 如果升级为GPT4 GPT-4模型，这里的4096需要修改  If upgraded to the GPT-4 model, the value of 4096 here needs to be modified. 
				// 计算需要设置的max_tokens   
				// *linTokenizer中，预估estimatedTokens的结果会偏大点（多数时候）
				let remainingTokens = 4096 - this.totaltokens - estimatedTokens; //预估剩余的 可用于max_tokens的数量
			//console.log("max_tokens原本设为 : " + Math.ceil(remainingTokens));
				let n = 0 ;
				if ( estimatedTokens < 500 ){
					n = 200 - (estimatedTokens * 150 / 500); //估越少 n越大 允许max_tokens设置高一点；
				}
				// remainingTokens = Math.ceil(remainingTokens); //向上取整数
				if ( remainingTokens > 3500 ){
					remainingTokens = remainingTokens - 400 + n;
				}else if ( remainingTokens > 2500 ){
					remainingTokens = remainingTokens - 370 + n;
				}else if ( remainingTokens > 1500 ){
					remainingTokens = remainingTokens - 300 ;
				}else if ( remainingTokens > 1000 ){
					remainingTokens = remainingTokens - 250 ;
				}else if ( remainingTokens > 600 ){
					remainingTokens = remainingTokens - 200 ;
				}else if ( remainingTokens > 500 ){
					remainingTokens = remainingTokens - 100 ;
				}else if ( remainingTokens > 300 ){
					remainingTokens = remainingTokens - 80 ;
				}else if ( remainingTokens > 100 ){
					remainingTokens = remainingTokens - 35 ;
				}else if ( remainingTokens > 25 ){
					remainingTokens = remainingTokens - 10;
				}else if ( remainingTokens > 0 ){
					remainingTokens = (remainingTokens - 3) > 0 ? (remainingTokens - 3) : remainingTokens ;
				}else {
				//新增自动重问功能，计算错误 > max_tokens过高导致报错 > 从报错信息中得到精准tokens > 精准设置max_tokens > 自动重问 
				//this.apiMaxTokens保持不变。保持不变，可能会报错，也可能不会报错（遇到过很多这种情况）。两种不同的处理方式：1 不改变this.apiMaxTokens，会存在小概率不报错的情况，此时max_tokens的值可能大也可能小，如果太小会直接影响回复的质量。   2、把this.apiMaxTokens调高，比如调到4095故意报错，报错可以得到精准的max_tonkens上限并自动修复，然后自动重问。 唯一不足就是免费账号每分钟只能请求3次，经常会遇到429错误。
				//最终方案： this.apiMaxTokens + 200 。本身会报错的，不加也会报错。 其他情况，如果+200不报错，那就继续，+200等于是设立了max_tokens的最低值。
				// (4095 4096 4097  gpt-3.5 gpt-4 gpt3.5 gpt4)
				this.apiMaxTokens = this.apiMaxTokens + 200;
				remainingTokens = this.apiMaxTokens > 4000 ? 4000 : this.apiMaxTokens; //4000无特殊意义
				}
			//console.log("max_tokens最终设为 : " + Math.ceil(remainingTokens));
				this.apiMaxTokens = Math.ceil(remainingTokens);
			},
			
			// 设置窗口 - 保存接口网址 API URL
			saveApiURL() {
				if (this.checkBusyStatus()) {
					// 如果返回 true，正在发送或正在验证
					return;
				} 

				let notif = '' ;
	
				//不填写/保留空白，将恢复默认的官方接口
				if (this.inputApiURL.trim() == '') {
  
					this.inputApiURL = 'https://api.openai.com/v1/chat/completions' ;
					this.apiURL = this.inputApiURL;
	 
					//需要做些处理 改变当前状态 需要重新验证。
					this.selectedApiURL = this.inputApiURL; //1 下拉框显示为“官方”/“GPT”
					this.btnDisabledState_SaveApiURL = true; //2 保存按钮变为不可用
					this.inputapichange(true); // 3 重新验证api-key时 改变按钮等状态
					notif = this.settingsLanguage == 'cn' ? '已重置为OpenAI官方接口' : 'The API ENDPOINT URL has been restored to the OpenAI link.' ;
					this.showNotification(notif, 'bottom','',2500);
				}else{

					// 1. 验证网址 开头只允许http:// 和 https:// 两种。 
					// 允许http：不了解接口规范，不排除私人搭建的某些http也能成功。不提醒，默认通过。
					const urlRegex = /^(https?|http):\/\/[^\s/$.?#]+\.[^\s]*$/;
					if (!urlRegex.test(this.inputApiURL.trim())) {
						notif = this.settingsLanguage == 'cn' ? '非完整网址格式，请输入以 https:// 开头的完整网址后重新保存' : 'Please input a website address that starts with https:// and save again.' ;
						this.showNotification(notif, 'bottom','',3800);
						return;
					}

					// 2. 验证this.inputApiURL这个网址是否以/v1/chat/completions结尾，如果不是，则弹窗由用户确认是继续还是返回
					if (!this.inputApiURL.trim().endsWith('/v1/chat/completions')) {
						const msg = '\r\n\r\n';
						const notif_cn = '本代码仅支持GPT-3.5或更新版本的GPT模型，对应的接口地址应以“/v1/chat/completions”结尾，如官方接口“https://api.openai.com/v1/chat/completions”。\r\n但是不排除第三方接口可能未按规范配置，请确认是否继续保存并使用该接口网址。 ' ;
						const notif_en = 'The code only supports GPT-3.5 or newer versions of the model, and the API ENDPOINT URL should end in "/v1/chat/completions", like the official one "https://api.openai.com/v1/chat/completions". \r\nHowever, it is not ruled out that the current URL can be used, please confirm whether to continue saving?';
						notif = this.settingsLanguage == 'cn' ? notif_cn : notif_en ;
						if (!confirm(notif)) {
							return;
						}
					}

					// 3. 保存
					this.apiURL = this.inputApiURL.trim();
	  
					// 4. 需要做些处理 改变当前状态 需要重新验证
					this.btnDisabledState_SaveApiURL = true; //1 保存按钮变为不可用
					this.inputapichange(true); // 2 重新验证api-key时 改变按钮等状态
	  
					// 5. 提醒用户先验证API-key
					notif = this.settingsLanguage == 'cn' ? '保存成功' : 'Save successful' ;
					this.showNotification(notif, 'bottom');
				}
			},
			// 设置窗口 - API URL下拉框  更新
			updateInputApiURL(){
				this.inputApiURL = this.selectedApiURL;
				this.saveApiURL(); //保存操作
			}, 
			// 设置窗口 - API URL输入框 更新
			inputApiURLChange(){
				this.selectedApiURL = ''; //重置下拉框为空，显示下拉箭头
				this.btnDisabledState_SaveApiURL = false; //保存按钮变为可用
			}, 
		
			
			//当前状态为"发送中"或"验证key中"时，需要禁止一些操作 Some operations should be prohibited when the current state is "sending" or "checking api key."
			checkBusyStatus(mode) {
				let tip = '';
				if( this.isSendingNow || this.isSendingNow_ForSmartMaxTokens ){
					tip = this.settingsLanguage == 'cn' ? '正在发送消息，请等发送结束后再继续操作' : 'Sending message, please wait until finished before continuing.'  ;
					this.showNotification(tip, 'bottom','',2900);
					return true;
				}
				if( this.isCheckingApiKeyNow){
					tip = this.settingsLanguage == 'cn' ? '正在验证API-Key，请等验证结束后再继续操作' : 'Verifying API-Key, please wait until finished before continuing.'  ;
					this.showNotification(tip, 'bottom','',2900);
					return true;
				}
				if (mode === 'ForChat' && this.localStorageEvent_chatDataList_update_start ){
					tip = this.settingsLanguage == 'cn' ? '正在标签页之间同步数据，请1～2秒后再继续操作' : 'Synchronizing data between tabs, please wait 1 to 2 seconds before continuing.'  ;
					this.showNotification(tip, 'bottom','',3900);
					return true;
				}
				return false;
			},
			
			// 设置窗口 - 头像 URL输入框
			inputImageUrlChange(role) {
				if(role == 'user'){
					this.btnDisabledState_updateUserImageUrl = false;
				}else{
					this.btnDisabledState_updateGPTImageUrl = false;
				}
			},
			// 设置窗口 - 头像下拉框
			updateSelectedImage(role) {
				let imageurl = this.selectedImageUrl;
				this.selectedImageUrl = ''; //复原
 
 				//if (!imageurl.trim().startsWith('http://') && !imageurl.trim().startsWith('https://') && !imageurl.trim().startsWith('file://')) 
				//发现以上代码没有排除相对路径，当存在相对路径头像时，会产生无法切换头像的小bug。 目前SVG头像只有一种，也没必要判断。
				
				//当选择的是GPT的绿色SVG图像时
				if( imageurl == 'Change-GPT-Green-SVG' ){
					if(role == 'gpt'){ 
						this.inputGPTImageUrl = this.settingsLanguage == 'cn' ? this.GPTGreenSVG_UrlText_cn : this.GPTGreenSVG_UrlText_en;
					}
				}else if ( imageurl == 'uploadimage' ) {
					//上传图片 上传头像 upload image
					this.openFileDialog_Avatar(role);
					return;
				}else {
				 	if(role == 'user'){
						this.inputUserImageUrl = imageurl;
					}else {
						this.inputGPTImageUrl = imageurl;
					}
				}
				this.updateAvatar(role);//保存 更新 save update
			},		
			// 设置窗口 - 更新头像  shownotif：是否允许通知（当读取缓存时，不需要通知）
			updateAvatar(role, shownotif) {
				let imageUrl = '';
				let notif = '';
				let isShowNotif = shownotif === false ? shownotif : true ;
				
				if(role == 'user'){
					imageUrl = this.inputUserImageUrl.trim();
				}else {
					imageUrl = this.inputGPTImageUrl.trim();
				} 
	
				if(imageUrl == ''){
					notif = this.settingsLanguage == 'cn' ? '图片的网址为空' : 'Image URL is empty' ;
					if (isShowNotif){
						this.showNotification(notif, 'bottom');
					}
					return;
				}
	
				//如果是GPT绿色的SVG头像。手动更新
				if ( role != 'user' && (imageUrl == this.GPTGreenSVG_UrlText_cn || imageUrl == this.GPTGreenSVG_UrlText_en) ) {
					this.gptAvatarURL = "" ; //imgUrl清空
				  	this.isgptGreenSvgShow = true; //显示<svg> 并隐藏<img>
					this.btnDisabledState_updateGPTImageUrl = true;
					
					notif = this.settingsLanguage == 'cn' ? '已更换头像' : 'Avatar has been updated' ;
					if (isShowNotif){
						this.showNotification(notif, 'bottom');
					}
					return;
				}

				const img = new Image();
				notif = this.settingsLanguage == 'cn' ? '更换中...' : 'Updating...' ;
				if (isShowNotif){
					this.showNotification(notif, 'bottom','',2900);
				}
				
				
				img.onload = () => {
					// 图片加载成功，更新头像
					if(role == 'user'){
						this.userAvatarURL = this.inputUserImageUrl; 
						this.btnDisabledState_updateUserImageUrl = true; 
					}else {
						this.gptAvatarURL = this.inputGPTImageUrl;
						this.isgptGreenSvgShow = false; //隐藏<svg> 并显示<img>
						this.btnDisabledState_updateGPTImageUrl = true;
					}
					notif = this.settingsLanguage == 'cn' ? '已更换头像' : 'Avatar has been updated' ;

					if (isShowNotif){
						//必须延迟，否则当url不变时，瞬间激活onload事件，此时部分手机上会出现底部通知消息会出现横移/闪跳的情况。
						setTimeout(() => {
							this.showNotification(notif, 'bottom');
						}, 1250);
					}
				};
  
				img.onerror = () => {
					if(role == 'user'){
						this.btnDisabledState_updateUserImageUrl = false; 
					}else {
						this.btnDisabledState_updateGPTImageUrl = false;
					}
					// 图片加载失败，提示用户
					let message  = this.settingsLanguage == 'cn' ? '无法使用该图片作为头像，请选择其他图片' : 'Unable to use this image as an avatar. Please select another image.';
				
					if (isShowNotif){
						//清除定时器 然后手动提前隐藏通知
						clearTimeout(this.notificationTimeoutId);
						setTimeout(() => {
							this.isShowNotification = false;
							this.notificationTimeoutId = -1;
						}, 600); // 延迟，先确保第一个通知顺利的弹出，然后再控制手动关闭通知。 不延迟的话，此时this.isShowNotification还可能为false（尚未弹出）。
					
						//延迟0.8秒，目的：控制顺序，先确保第一个通知顺利的弹出，然后定时手动隐藏通知，最后再弹窗警告。
						setTimeout(() => {
							alert(message);
						}, 800);
					}else {
						if ( !(role == 'user' && this.userAvatarURL === 'https://lin2025.github.io/img/me-bili.jpg') ){ //在国内，未打开V. P_N，默认的"bili头像"大概率会加载失败，所以排除
							// 恢复本地存储的头像（网址、路径、上传的头像），遇到错误时
							const rolestr = this.settingsLanguage == 'cn' ? (role == 'user' ? '[用户头像]' : '[GPT头像]') : (role == 'user' ? '[User Avatar]' : '[GPT Avatar]');
							notif = this.settingsLanguage == 'cn' ?  rolestr + ' 未能加载' : rolestr + ' failed to load' ;
							const delaytime = this.isShowNotification ? 5000 : 200;
							setTimeout(() => {
								this.showNotification(notif, 'bottom', '', 2000);
							}, delaytime);
						}
					}
				};
  
				img.src = imageUrl;
			},
			
			//添加上传头像的input控件（删除 > 添加 > 加事件）
			addInput_FileDialog_Avatar(role) {
				const isInputExit = role == 'user' ? document.getElementById('inputFileAvatar-user') : document.getElementById('inputFileAvatar-gpt'); 
				const dialogSettings = document.getElementById("dialog-settings");
				const div_userAvataror = document.getElementById("div-upload-userAvataror");
				const div_gptAvataror = document.getElementById("div-upload-gptAvataror");
				const div_gptAvataror_SVG = document.getElementById("div-upload-gptAvataror-SVG");
				
				//删除
				if (isInputExit){ //input已存在。目前的逻辑，应该每次都应该要存在
					if(role == 'user'){
						div_userAvataror.onclick = null; // 移除之前的点击事件
					}else {
						div_gptAvataror.onclick = null; // 移除之前的点击事件
						div_gptAvataror_SVG.onclick = null; // 移除之前的点击事件
					}
					isInputExit.onchange = null;
					dialogSettings.removeChild(isInputExit);//每次都移除
				}
				
				//添加
				const input = document.createElement('input'); 
				input.type = 'file';
				input.accept = 'image/*';
				input.style.display = 'none'; //隐藏的，只有通过下拉框选项或点击设置中的头像才能打开选择图片的对话框。
				//input.style.zIndex = 999999; //调试的时候需要
				input.id = role == 'user' ? 'inputFileAvatar-user' : 'inputFileAvatar-gpt';
				
				dialogSettings.appendChild(input);
				
				//DIV事件
				if(role == 'user'){
					div_userAvataror.onclick = () => input.click();  // 修改div的点击事件
				}else {
					div_gptAvataror.onclick = () => input.click(); // 修改div的点击事件 
					div_gptAvataror_SVG.onclick = () => input.click(); // 修改div的点击事件 
				}
				
				
				//事件 onchange
				input.onchange = (event) => {
					let notif = '';
					let notiftype = 'bottom';
 					if ( !event.target || !event.target.files || event.target.files.length == 0) {
						return;
					}

					const file = event.target.files[0]; //blob
					const filesize = file.size / 1024 ;
					const url = URL.createObjectURL(file); //blob url
					if(role == 'user'){
						//判断图片大小。 若大于350k，提醒不存到浏览器缓存，刷新后头像将被清除
						if (filesize > 350) {
							// 图片大小超过了350k
							const notif_cn = '上传的图片大小超过了 350KB (0.35MB)，因此无法保存到浏览器本地存储（localStorage）中。这不会影响使用，只是在刷新或重新打开网页后，[用户头像]会失效，需要重新上传。\r\n\r\n  • localStorage容量有限，所以限制只存储大小在 350KB (0.35MB) 以内的1张图片，且只能是[用户头像]。\r\n  • 上传的图片仅会缓存在您的浏览器中，并不会通过任何方式对外传输。';
							const notif_en = "The image you uploaded exceeds 350KB (0.35MB) in size and cannot be stored in the browser's local storage (localStorage). This will not affect usage, but the [User Avatar] will need to be re-uploaded when the page is reopened or refreshed.\r\n\r\n  • Due to limited capacity, localStorage restricts the storage of only one image under 350KB (0.35MB) and it can only be the user avatar. \r\n  • The uploaded images will only be stored in your browser cache and will not be transmitted over the network.";
							notif = this.settingsLanguage == 'cn' ? notif_cn : notif_en ;
							notiftype = 'center';
						}else {
							//将头像存储到localStorage只有一种方法，就是点击用户的“下拉框”或“头像”，然后上传。  如果是通过点击gpt的“下拉框”或“头像”上传，然后复制blob url保存到用户头像的，这种情况不会存储到localStorage，刷新后失效。
							
							// 图片大小在350k以内
							this.userAvatarUp_blobUrl = url; //(user & blob <= 350)
							this.userAvatarUp_blob = file; //(user & blob <= 350)
							// 文件符合要求，将图片保存到LocalStorage
							const reader = new FileReader();
							reader.readAsDataURL(file);
							reader.onload = () => {
								this.userAvatarUp_base64 = reader.result; //(user & blob <= 350)
							};
						
							//提示
							notif = this.settingsLanguage == 'cn' ? '上传成功（图片仅会缓存在您的浏览器中，并不会通过任何方式对外传输）' : 'Upload successful (the image will only be stored in the browser cache and will not be transmitted over the network).' ;
							notiftype = 'bottom';
						}
					}else {
						const notif_cn = '上传的[GPT头像]，不会存储到浏览器本地存储（localStorage）中，在刷新或重新打开网页后，上传的[GPT头像]将会失效，需要重新上传。\r\n\r\n  • localStorage容量有限，所以限制只存储大小在 350KB (0.35MB) 以内的1张图片，且只能是[用户头像]。\r\n  • 上传的图片仅会缓存在您的浏览器中，并不会通过任何方式对外传输。';
						const notif_en = "The uploaded [GPT Avatar] will not be stored in the browser's local storage (localStorage). After reopening or refreshing the page, the uploaded [GPT Avatar] will become invalid and need to be re-uploaded.\r\n\r\n  • Due to limited capacity, localStorage restricts the storage of only one image under 350KB (0.35MB) and it can only be the [User Avatar]. \r\n  • The uploaded images will only be stored in your browser cache and will not be transmitted over the network.";
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       							notif = this.settingsLanguage == 'cn' ? '列表空，已自动添加一个新的对话' : 'The list is empty. A new chat has been automatically added.' ;
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          				// 0 subscriptionData.account_name [账号归属/Account_Name]  
				// 1 is_subsrcibed  即subscriptionData.has_payment_method [是否绑卡/has_payment_method]  ？绑卡和购买Plus应该是两回事，绑卡使用API 不一定有订阅Plus 
				// 2 totalAmount  即subscriptionData.hard_limit_usd  [账号总额度/Total Amount] 
				// 3 totalUsage  即usageData.total_usage(需要除以100)  [已消耗金额/Total Usage] //绑卡用户为本月用量  非绑卡用户为历史累计用量
				// 4 remaining (通过计算得出) [可用额度/Remaining]
				// 5 timestamp_expire  即subscriptionData.access_until  [截止时间/Expiration Date] *时间戳格式
				// 6 subscriptionData.plan["title"]  plan-title 可能是账号分类/用途
				// 7 subscriptionData.plan["id"]   Plan-id [订阅情况/Subscription]
				// 8 totalUsageCurr 未绑卡用户的本月用量
				// 以上 数据说明
				
				//返回通过官网接口获取到的9个数据
		  		return [subscriptionData.account_name, is_subsrcibed, totalAmount, totalUsage, remaining, timestamp_expire, subscriptionData.plan["title"], subscriptionData.plan["id"], totalUsageCurr ];
		  
			} catch (error) {
				isError = true;
				isCheckAPIKey = false;
				console.log(error);
				// Notification: Failed to check the balance. The reasons for the failure are not clear, and the possibility of "code malfunction" cannot be ruled out.(No impact on ChatGPT usage).
				const msg_cn = '!! 查询余额失败，存在多种可能，检查网络后重试，仍失败的话，请放弃查余额～ \r\n\r\nAPI-Key已验证成功，查询余额却失败，不排除是查询余额代码失效的原因（不影响GPT的使用）。\r\n\r\n可查看代码是否有更新：\r\nhttps://gitee.com/lin2025/gpt3.5/ \r\nhttps://github.com/lin2025/gpt3.5/';
				const msg_en = "!! Failed to check the balance. The reasons for the failure are not clear, and the possibility of 'code malfunction' cannot be ruled out.(No impact on GPT usage) \r\n\r\nCheck for code updates:\r\nhttps://github.com/lin2025/gpt3.5/";
				const msg = window.currentlang == 'cn' ? msg_cn : msg_en ;
				alert(msg);
				return [null, null, null, null, null, null, null, null, null]; //出错则返回9个空值
			}
		}
	  

		//格式化日期
		function formatDate(date) {
			const year = date.getFullYear();
			const month = (date.getMonth() + 1).toString().padStart(2, '0');
			const day = date.getDate().toString().padStart(2, '0');
			//ES6写法： return `${year}-${month}-${day}`;
			return year + '-' + month + '-' + day;  // 兼容性更好。 Support more browsers.
		}


		//查询API-Key余额
		function sendRequest() {
		
			let msg_cn, msg_en, msg;
			//如果后台正在查询，那么提醒后返回，防止重复查询
			if(isCheckAPIKey){
				msg_cn = '已在为您查询OpenAI API的余额，请关闭弹窗后耐心等待。\r\n等待期间可进行其他操作，正常情况下数秒内完成，如等待时间过长，请检查下网络状态。';
				msg_en = "Your request is currently being processed. Please close the pop-up window and wait patiently.";
				msg = window.currentlang == 'cn' ? msg_cn : msg_en ;
				alert(msg);
				return;
			}
		  
			isCheckAPIKey = true;
			
			msg_cn = '将为您查询OpenAI API的账号余额，请先关闭本弹窗，待查询结果出来后会自动弹出。';
			msg_en = "After closing this pop-up window, the account balance of the API will be checked. The query result will automatically pop up when it is available.";
			msg = window.currentlang == 'cn' ? msg_cn : msg_en ;
			alert(msg);
		 
			//因为是在api-key验证成功后才能查询余额，所以此处无需判断api-key的有效性、格式是否正确等情况


		  	//连官网接口查询账号信息  传入网页上API-Key后开始查询
			checkBilling(document.querySelector('.inputapikey').value.trim()).then((data) => {
	  
	  			//如果checkBilling已出错，就返回，避免重复报错。
				if ( isError && data[0] == null && data[1] == null){
					isCheckAPIKey = false; 
					return;
				}
				// 数据说明：共9个参数，均为官方接口返回的信息，不必担心安全问题，无任何泄漏风险，不会以任何方式存储数据
				//  	来源官方接口1： https://api.openai.com/v1/dashboard/billing/subscription
				//  	来源官方接口2： https://api.openai.com/v1/dashboard/billing/usage?start_date=查询消耗金额的起始时间&end_date=查询消耗金额的结束时间
				// 数组序列如下：
				// 0 subscriptionData.account_name [账号归属/Account_Name]  
				// 1 is_subsrcibed  即subscriptionData.has_payment_method [是否绑卡/has_payment_method]  
				// 2 totalAmount  即subscriptionData.hard_limit_usd  [账号总额度/Total Amount] 
				// 3 totalUsage  即usageData.total_usage(需要除以100)  [已消耗金额/Total Usage] //绑卡用户为本月用量  非绑卡用户为历史累计用量
				// 4 remaining (通过计算得出) [可用额度/Remaining]
				// 5 timestamp_expire  即subscriptionData.access_until  [截止时间/Expiration Date] *时间戳格式
				// 6 subscriptionData.plan["title"]  plan-title 可能是账号分类/用途
				// 7 subscriptionData.plan["id"]   Plan-id [订阅情况/Subscription]
				// 8 totalUsageCurr 未绑卡用户的本月用量
				// 以上 数据说明


				// 5-日期格式需要转换  5-到期时间/有效期/Expiration Date
				let date = new Date(data[5]* 1000);// data[5]为秒级时间戳，需要*1000转换为毫秒数
				let Y = date.getFullYear() + '-'; // 获取年份
				let M = String(date.getMonth() + 1).replace(/^(\d)$/, '0$1') + '-'; // 获取月份，注意月份是从 0 开始计数的，所以需要加 1
				let D = String(date.getDate()).replace(/^(\d)$/, '0$1') + ' '; // 获取日期
				let h = String(date.getHours()).replace(/^(\d)$/, '0$1') + ':'; // 获取小时
				let m = String(date.getMinutes()).replace(/^(\d)$/, '0$1') + ':'; // 获取分钟
				let s = String(date.getSeconds()).replace(/^(\d)$/, '0$1');  // 获取秒数
				data[5] = Y+M+D+h+m+s ;  // Y+M+D+h+m+s 样式：2023-04-26 10:58:30

				// 定义金额向右对齐后的字符串长度  chatgpt推荐使用padStart函数，为了兼容更多浏览器，让gpt换了方法
				let alignLength = 10;

				//声明变量
				let msgTop, msg0, msg1, msg2, msg3, msg4, msg5, msg6, msg7, msg8, msgBottom;

				//绑卡用户与非绑卡用户的不同  绑卡和购买Plus应该是两回事，绑卡使用API 不一定有订阅Plus 
				// * I don't have a payment account, so I can't verify the time range of data for payment users. However, hope the label is not wrong.
				if(data[1]) {
					//绑卡用户：后台绑定信用卡按量扣费的用户，不是每月固定扣费的Plus会员
					//  *根据网友的说法，绑卡后按月统计，根据API使用量扣费，理解如有误，请自行更改文本内容
					msg2 = window.currentlang == 'cn' ? '\r\n本月上限：  $' : '\r\nTotal Amount (M): $';  //TotalAmount per month
					msg3 = window.currentlang == 'cn' ? '\r\n实际消费：  $' : '\r\nTotal Usage (M): $'; //TotalUsage per month
					msg4 = window.currentlang == 'cn' ? '\r\n剩余限额：  $' : '\r\nRemaining (M): $'; //Remaining per month
					msg5 = window.currentlang == 'cn' ? '\r\n到期时间(?)：' : '\r\nExpiration Date(?): '; //ExpirationDate  绑卡用户是否有截止日期？ 月底？ per month??
					msg8 = window.currentlang == 'cn' ? '\r\n无' : '\r\nNone';  //null
				}else{
					//非绑卡用户：使用免费体验金的用户，历史统计数据
					msg2 = window.currentlang == 'cn' ? '\r\n账号总额：  $' : '\r\nTotal Amount: $';  //TotalAmount
					msg3 = window.currentlang == 'cn' ? '\r\n累计消耗：  $' : '\r\nTotal Usage: $'; //TotalUsage
					msg4 = window.currentlang == 'cn' ? '\r\n剩余额度：  $' : '\r\nRemaining: $'; //Remaining
					msg5 = window.currentlang == 'cn' ? '\r\n到期时间：  ' : '\r\nExpiration Date: ';  //ExpirationDate
					msg8 = (window.currentlang == 'cn' ? '\r\n本月消耗：  $' : '\r\nMonthly Usage: $')  + " ".repeat(alignLength - data[8].toFixed(4).length) + data[8].toFixed(4); //MonthlyUsage 仅未绑卡用户 取4位小数点，并向右对齐
				}

				//组合需要展示的数据
				msgTop = window.currentlang == 'cn' ? 'OpenAI API 账号余额查询结果\r\n\r\n' : 'OpenAI API Balance Query Result\r\n\r\n' ;  // OpenAI API account balance query result
				msg0 = (window.currentlang == 'cn' ? '账号归属：  ' : 'Account Name: ') + data[0]; // 注册OpenAI账号时填写的姓名  //AccountName
				msg1 = (window.currentlang == 'cn' ? '\r\n是否绑卡：  ' : '\r\nHas Payment: ') + (data[1] ? 'Yes' : 'No') ; //has_payment  绑卡和购买Plus应该是两回事，绑卡使用API 不一定有订阅Plus 
				msg2 = msg2 + " ".repeat(alignLength - data[2].toFixed(4).length) + data[2].toFixed(4); //取4位小数点，并向右对齐（计算需要补充的空格数量，在字符串前面添加空格）
				msg3 = msg3 + " ".repeat(alignLength - data[3].toFixed(4).length) + data[3].toFixed(4); //取4位小数点，并向右对齐 
				msg4 = msg4 + " ".repeat(alignLength - data[4].toFixed(4).length) + data[4].toFixed(4); //取4位小数点，并向右对齐
				msg5 = msg5 + data[5];
				msg6 = (window.currentlang == 'cn' ? '\r\n账号用途：  ' : '\r\nAbout Plan(?): ') + data[6]; // Plan-title 应该是注册时选择的注册目的、用途
				const freetext = window.currentlang == 'cn' ? '免费' : 'Free' ;
				msg7 = (window.currentlang == 'cn' ? '\r\n订阅情况：  ' : '\r\nSubscribe: ') + ( data[7] == 'free' ? freetext : data[7] );  //Plan-id  id等于free，则显示免费。 其他情况未知，显示原始值
				msg8 = msg8; 
				
				const str1 = window.currentlang == 'cn' ? '\r\n*非绑卡用户默认统计范围为90天。' : '\r\n*Default query for 90 days usage.(For Non-Payment users)' ;
				const str2 = window.currentlang == 'cn' ? "\r\n*绑卡用户返回的数据应该都只是当月的，但我没绑过卡无法验证统计范围。" : "\r\n*I don't have a payment account, so I can't verify the time range of data for payment users. However, hope the label is not wrong." ;
				const msg9 =  data[1] ? str2 : str1;
				
				
				const msgBottom_cn = '\r\n\r\n余额查询代码版本v4.27  \r\n以上信息均由官方接口返回，无泄漏风险，对当前已验证的API-Key实时查询，不会存储数据，API-Key随时可改。原理见代码，注释详尽。';
	  			const msgBottom_en = '\r\n\r\nBalance Inquiry Code Version v4.27  \r\nUse OpenAI API, real-time query, your data will not be saved, API-Key can be changed at any time. ';
				msgBottom = window.currentlang == 'cn' ? msgBottom_cn : msgBottom_en;
				
				isCheckAPIKey = false;

				//查询结果 弹窗
				if(data[1]){
					//绑卡用户的查询结果  后台绑定信用卡按量扣费的用户
					alert( msgTop + msg0 + msg1 + msg2 + msg3 + msg4 + msg5 + msg6 + msg7 + msgBottom + msg9 );
				}else{
					//非绑卡用户的查询结果  比绑卡用户多一行数据：msg8
					alert( msgTop + msg0 + msg1 + msg2  + msg8 + msg3 + msg4 + msg5 + msg6 + msg7 + msgBottom + msg9 );
				}			  

			}).catch((error) => {
				isCheckAPIKey = false;
				console.log(error);
				// Notification: Failed to check the balance. The reasons for the failure are not clear, and the possibility of "code malfunction" cannot be ruled out.(No impact on ChatGPT usage).
				const msg_cn = '!! 查询余额失败，存在多种可能，检查网络后重试，仍失败的话，请放弃查余额～ \r\n\r\nAPI-Key已验证成功，查询余额却失败，不排除是查询余额代码失效的原因（不影响GPT的使用）。\r\n\r\n可查看代码是否有更新：\r\nhttps://gitee.com/lin2025/gpt3.5/ \r\nhttps://github.com/lin2025/gpt3.5/';
				const msg_en = "!! Failed to check the balance. The reasons for the failure are not clear, and the possibility of 'code malfunction' cannot be ruled out.(No impact on GPT usage) \r\n\r\nCheck for code updates:\r\nhttps://github.com/lin2025/gpt3.5/";
				const msg = window.currentlang == 'cn' ? msg_cn : msg_en ;
				alert(msg);
			});
		}

//以上为[查询OpenAI API余额]的代码  Javascript code to check OpenAI API balances
</script>

<!-- 可修改 - 以下这两行是流量统计代码。请删除掉。 [Delete] Website traffic analysis. Please delete the following code  -->
<script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?45a1ecbb10a44dd4e1c1c1907eff38c0";var s=document.getElementsByTagName("script")[0];s.parentNode.appendChild(hm)})();</script>
<script>!function(p){"use strict";!function(t){var s=window,e=document,i=p,c="".concat("https:"===e.location.protocol?"https://":"http://","sdk.51.la/js-sdk-pro.min.js"),n=e.createElement("script"),r=e.getElementsByTagName("script")[0];n.type="text/javascript",n.setAttribute("charset","UTF-8"),n.async=!0,n.src=c,n.id="LA_COLLECT",i.d=n;var o=function(){s.LA.ids.push(i)};s.LA?s.LA.ids&&o():(s.LA=p,s.LA.ids=[],o()),r.parentNode.appendChild(n)}()}({id:"K1dyobSMgn13W0ov",ck:"K1dyobSMgn13W0ov"});</script>
<!-- 可修改 - 以上这两行是流量统计代码。请删除掉。 [Delete] Website traffic analysis. Please delete the above code  -->

</body>
</html>
